<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>Deno学习记录 | aoaYaoa</title><meta name="author" content="aoaYaoa"><meta name="copyright" content="aoaYaoa"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="Deno学习记录 📘   📋 目录一、Deno基础技术 项目概述 技术栈 Deno基础用法 权限管理 常用命令 环境变量 第三方库和依赖管理 Deno部署指南  二、项目具体实现 项目结构 API路由 数据模型 MongoDB数据库操作 MBTI测试实现细节  三、最佳实践和扩展 注意事项和最佳实践 前端展示与UI优化 常见问题排查 代码规范 扩展和改进 资源链接   🚀 项目概述这是一个基">
<meta property="og:type" content="article">
<meta property="og:title" content="Deno学习记录">
<meta property="og:url" content="https://aoayaoa.github.io/2025/04/15/deno%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/index.html">
<meta property="og:site_name" content="aoaYaoa">
<meta property="og:description" content="Deno学习记录 📘   📋 目录一、Deno基础技术 项目概述 技术栈 Deno基础用法 权限管理 常用命令 环境变量 第三方库和依赖管理 Deno部署指南  二、项目具体实现 项目结构 API路由 数据模型 MongoDB数据库操作 MBTI测试实现细节  三、最佳实践和扩展 注意事项和最佳实践 前端展示与UI优化 常见问题排查 代码规范 扩展和改进 资源链接   🚀 项目概述这是一个基">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://aoayaoa.github.io/img/deno.jpeg">
<meta property="article:published_time" content="2025-04-14T16:00:00.000Z">
<meta property="article:modified_time" content="2025-04-16T02:50:03.343Z">
<meta property="article:author" content="aoaYaoa">
<meta property="article:tag" content="Deno">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://aoayaoa.github.io/img/deno.jpeg"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Deno学习记录",
  "url": "https://aoayaoa.github.io/2025/04/15/deno%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/",
  "image": "https://aoayaoa.github.io/img/deno.jpeg",
  "datePublished": "2025-04-14T16:00:00.000Z",
  "dateModified": "2025-04-16T02:50:03.343Z",
  "author": [
    {
      "@type": "Person",
      "name": "aoaYaoa",
      "url": "https://aoayaoa.github.io/"
    }
  ]
}</script><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://aoayaoa.github.io/2025/04/15/deno%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!true && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', 'undefined')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', 'undefined')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"top_n_per_article":1,"unescape":false,"languages":{"hits_empty":"未找到符合您查询的内容：${query}","hits_stats":"共找到 ${hits} 篇文章"}},
  translate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":false},
  copy: {
    success: '复制成功',
    error: '复制失败',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"limitCount":150,"languages":{"author":"作者: aoaYaoa","link":"链接: ","source":"来源: aoaYaoa","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},
  lightbox: 'null',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: true,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Deno学习记录',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><link rel="stylesheet" href="/css/base.css"><script src="/js/resources.js"></script><link rel="alternate" href="/atom.xml" title="aoaYaoa" type="application/atom+xml">
</head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="/img/avatar.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">13</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">15</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">1</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-book-open"></i><span> 文章</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-calendar-alt"></i><span> 日常</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/shuoshuo/"><i class="fa-fw fas fa-comment-dots"></i><span> 说说</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/resources/"><i class="fa-fw fas fa-compass"></i><span> 资源</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-user"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg fixed" id="page-header" style="background-image: url(/img/deno.jpeg);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><img class="site-icon" src="/img/avatar.jpg" alt="Logo"><span class="site-name">aoaYaoa</span></a><a class="nav-page-title" href="/"><span class="site-name">Deno学习记录</span></a></span><div id="menus"><div id="search-button"><span class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></span></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-book-open"></i><span> 文章</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-calendar-alt"></i><span> 日常</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/shuoshuo/"><i class="fa-fw fas fa-comment-dots"></i><span> 说说</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/resources/"><i class="fa-fw fas fa-compass"></i><span> 资源</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-user"></i><span> 关于</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">Deno学习记录</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2025-04-14T16:00:00.000Z" title="发表于 2025-04-15 00:00:00">2025-04-15</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2025-04-16T02:50:03.343Z" title="更新于 2025-04-16 10:50:03">2025-04-16</time></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">总字数:</span><span class="word-count">7k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>31分钟</span></span><span class="post-meta-separator">|</span><span id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">浏览量:</span><span id="twikoo_visitors"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><h1 id="Deno学习记录-📘"><a href="#Deno学习记录-📘" class="headerlink" title="Deno学习记录 📘"></a>Deno学习记录 📘</h1><div align="left">

<p><img src= "/img/loading.gif" data-lazy-src="https://img.shields.io/badge/Deno-v1.x-black?logo=deno" alt="Deno"><br><img src= "/img/loading.gif" data-lazy-src="https://img.shields.io/badge/TypeScript-v5.x-blue?logo=typescript" alt="TypeScript"><br><img src= "/img/loading.gif" data-lazy-src="https://img.shields.io/badge/MongoDB-v6.x-green?logo=mongodb" alt="MongoDB"><br><img src= "/img/loading.gif" data-lazy-src="https://img.shields.io/badge/Oak-v12.x-lightgrey" alt="Oak"></p>
<h2 id="📋-目录"><a href="#📋-目录" class="headerlink" title="📋 目录"></a>📋 目录</h2><h3 id="一、Deno基础技术"><a href="#一、Deno基础技术" class="headerlink" title="一、Deno基础技术"></a>一、Deno基础技术</h3><ul>
<li><a href="#%E9%A1%B9%E7%9B%AE%E6%A6%82%E8%BF%B0">项目概述</a></li>
<li><a href="#%E6%8A%80%E6%9C%AF%E6%A0%88">技术栈</a></li>
<li><a href="#deno%E5%9F%BA%E7%A1%80%E7%94%A8%E6%B3%95">Deno基础用法</a></li>
<li><a href="#%E6%9D%83%E9%99%90%E7%AE%A1%E7%90%86">权限管理</a></li>
<li><a href="#%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4">常用命令</a></li>
<li><a href="#%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F">环境变量</a></li>
<li><a href="#%E7%AC%AC%E4%B8%89%E6%96%B9%E5%BA%93%E5%92%8C%E4%BE%9D%E8%B5%96%E7%AE%A1%E7%90%86">第三方库和依赖管理</a></li>
<li><a href="#deno%E9%83%A8%E7%BD%B2%E6%8C%87%E5%8D%97">Deno部署指南</a></li>
</ul>
<h3 id="二、项目具体实现"><a href="#二、项目具体实现" class="headerlink" title="二、项目具体实现"></a>二、项目具体实现</h3><ul>
<li><a href="#%E9%A1%B9%E7%9B%AE%E7%BB%93%E6%9E%84">项目结构</a></li>
<li><a href="#api%E8%B7%AF%E7%94%B1">API路由</a></li>
<li><a href="#%E6%95%B0%E6%8D%AE%E6%A8%A1%E5%9E%8B">数据模型</a></li>
<li><a href="#mongodb%E6%95%B0%E6%8D%AE%E5%BA%93%E6%93%8D%E4%BD%9C">MongoDB数据库操作</a></li>
<li><a href="#mbti%E6%B5%8B%E8%AF%95%E5%AE%9E%E7%8E%B0%E7%BB%86%E8%8A%82">MBTI测试实现细节</a></li>
</ul>
<h3 id="三、最佳实践和扩展"><a href="#三、最佳实践和扩展" class="headerlink" title="三、最佳实践和扩展"></a>三、最佳实践和扩展</h3><ul>
<li><a href="#%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9%E5%92%8C%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5">注意事项和最佳实践</a></li>
<li><a href="#%E5%89%8D%E7%AB%AF%E5%B1%95%E7%A4%BA%E4%B8%8Eui%E4%BC%98%E5%8C%96">前端展示与UI优化</a></li>
<li><a href="#%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98%E6%8E%92%E6%9F%A5">常见问题排查</a></li>
<li><a href="#%E4%BB%A3%E7%A0%81%E8%A7%84%E8%8C%83">代码规范</a></li>
<li><a href="#%E6%89%A9%E5%B1%95%E5%92%8C%E6%94%B9%E8%BF%9B">扩展和改进</a></li>
<li><a href="#%E8%B5%84%E6%BA%90%E9%93%BE%E6%8E%A5">资源链接</a></li>
</ul>
<hr>
<h2 id="🚀-项目概述"><a href="#🚀-项目概述" class="headerlink" title="🚀 项目概述"></a>🚀 项目概述</h2><p>这是一个基于Deno运行时的后端服务项目，主要功能包括MBTI人格测试系统。项目采用TypeScript语言开发，使用Oak HTTP服务器框架处理HTTP请求，MongoDB作为数据存储解决方案。</p>
<hr>
<h2 id="💻-技术栈"><a href="#💻-技术栈" class="headerlink" title="💻 技术栈"></a>💻 技术栈</h2><table>
<thead>
<tr>
<th>分类</th>
<th>技术</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td><strong>运行时环境</strong></td>
<td>Deno</td>
<td>安全的JavaScript和TypeScript运行时</td>
</tr>
<tr>
<td><strong>语言</strong></td>
<td>TypeScript</td>
<td>带有类型系统的JavaScript超集</td>
</tr>
<tr>
<td><strong>HTTP服务器框架</strong></td>
<td>Oak</td>
<td>受Koa启发的Deno中间件框架</td>
</tr>
<tr>
<td><strong>数据库</strong></td>
<td>MongoDB</td>
<td>NoSQL文档数据库</td>
</tr>
<tr>
<td><strong>ODM</strong></td>
<td>Mongoose</td>
<td>MongoDB对象模型工具</td>
</tr>
<tr>
<td><strong>API文档</strong></td>
<td>暂无</td>
<td>可考虑添加Swagger</td>
</tr>
<tr>
<td><strong>测试框架</strong></td>
<td>Deno内置测试工具</td>
<td>Deno自带的测试功能</td>
</tr>
</tbody></table>
<hr>
<h2 id="🛠️-环境准备"><a href="#🛠️-环境准备" class="headerlink" title="🛠️ 环境准备"></a>🛠️ 环境准备</h2><p>在开始项目之前，请准备以下环境：</p>
<h3 id="1-安装Deno"><a href="#1-安装Deno" class="headerlink" title="1. 安装Deno"></a>1. 安装Deno</h3><p>Deno 是一个现代的JavaScript和TypeScript运行时环境。推荐使用以下命令安装：</p>
<table>
<thead>
<tr>
<th>操作系统</th>
<th>命令</th>
</tr>
</thead>
<tbody><tr>
<td>macOS &#x2F; Linux</td>
<td>`curl -fsSL <a target="_blank" rel="noopener external nofollow noreferrer" href="https://deno.land/install.sh">https://deno.land/install.sh</a></td>
</tr>
<tr>
<td>Windows</td>
<td>`irm <a target="_blank" rel="noopener external nofollow noreferrer" href="https://deno.land/install.ps1">https://deno.land/install.ps1</a></td>
</tr>
</tbody></table>
<p>验证安装：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">deno --version</span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>注</strong>：更多安装选项（如Homebrew）请参考 Deno安装指南。</p>
</blockquote>
<h3 id="2-安装MongoDB"><a href="#2-安装MongoDB" class="headerlink" title="2. 安装MongoDB"></a>2. 安装MongoDB</h3><p>项目使用 MongoDB 作为数据库。您可以选择本地安装或使用Docker。</p>
<h4 id="2-1-本地安装MongoDB"><a href="#2-1-本地安装MongoDB" class="headerlink" title="2.1 本地安装MongoDB"></a>2.1 本地安装MongoDB</h4><p>请访问 MongoDB安装指南 安装。启动服务：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mongod</span><br></pre></td></tr></table></figure>

<h4 id="2-2-使用Docker运行MongoDB"><a href="#2-2-使用Docker运行MongoDB" class="headerlink" title="2.2 使用Docker运行MongoDB"></a>2.2 使用Docker运行MongoDB</h4><p>运行以下命令：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -d -p 27017:27017 --name mongodb mongo:latest</span><br></pre></td></tr></table></figure>

<h2 id="🦕-Deno基础用法"><a href="#🦕-Deno基础用法" class="headerlink" title="🦕 Deno基础用法"></a>🦕 Deno基础用法</h2><h2 id="⚡-常用命令"><a href="#⚡-常用命令" class="headerlink" title="⚡ 常用命令"></a>⚡ 常用命令</h2><p>项目中定义了多个Deno任务，可以通过<code>deno task &lt;task_name&gt;</code>执行：</p>
<table>
<thead>
<tr>
<th>命令</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td><code>deno task dev</code></td>
<td>开发模式启动</td>
</tr>
<tr>
<td><code>deno task start</code></td>
<td>生产模式启动</td>
</tr>
<tr>
<td><code>deno task hot-reload</code></td>
<td>热重载模式</td>
</tr>
<tr>
<td><code>deno task test</code></td>
<td>运行测试</td>
</tr>
<tr>
<td><code>deno task mongo:init</code></td>
<td>初始化MongoDB</td>
</tr>
<tr>
<td><code>deno task mongo:generate-mbti</code></td>
<td>生成MBTI测试数据</td>
</tr>
<tr>
<td><code>deno run task -- watch</code></td>
<td>监听文件变化</td>
</tr>
</tbody></table>
<h3 id="文件操作"><a href="#文件操作" class="headerlink" title="文件操作"></a>文件操作</h3><h4 id="读取文件"><a href="#读取文件" class="headerlink" title="读取文件"></a>读取文件</h4><p>Deno提供了简单直观的文件API：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 同步读取文件</span></span><br><span class="line"><span class="keyword">const</span> text = <span class="title class_">Deno</span>.<span class="title function_">readTextFileSync</span>(<span class="string">&quot;./data/config.json&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> data = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(text);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 异步读取文件</span></span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> text = <span class="keyword">await</span> <span class="title class_">Deno</span>.<span class="title function_">readTextFile</span>(<span class="string">&quot;./data/users.json&quot;</span>);</span><br><span class="line">  <span class="keyword">const</span> users = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(text);</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(users);</span><br><span class="line">&#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&quot;读取文件失败:&quot;</span>, error);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 读取二进制文件</span></span><br><span class="line"><span class="keyword">const</span> data = <span class="keyword">await</span> <span class="title class_">Deno</span>.<span class="title function_">readFile</span>(<span class="string">&quot;./assets/image.png&quot;</span>);</span><br></pre></td></tr></table></figure>

<h4 id="写入文件"><a href="#写入文件" class="headerlink" title="写入文件"></a>写入文件</h4><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 同步写入文本文件</span></span><br><span class="line"><span class="keyword">const</span> data = &#123; <span class="attr">name</span>: <span class="string">&quot;Test User&quot;</span>, <span class="attr">email</span>: <span class="string">&quot;test@example.com&quot;</span> &#125;;</span><br><span class="line"><span class="title class_">Deno</span>.<span class="title function_">writeTextFileSync</span>(<span class="string">&quot;./data/user.json&quot;</span>, <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(data, <span class="literal">null</span>, <span class="number">2</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">// 异步写入文件</span></span><br><span class="line"><span class="keyword">await</span> <span class="title class_">Deno</span>.<span class="title function_">writeTextFile</span>(<span class="string">&quot;./logs/app.log&quot;</span>, <span class="string">`[<span class="subst">$&#123;<span class="keyword">new</span> <span class="built_in">Date</span>().toISOString()&#125;</span>] Server started\n`</span>, &#123; <span class="attr">append</span>: <span class="literal">true</span> &#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 写入二进制文件</span></span><br><span class="line"><span class="keyword">await</span> <span class="title class_">Deno</span>.<span class="title function_">writeFile</span>(<span class="string">&quot;./output/data.bin&quot;</span>, <span class="keyword">new</span> <span class="title class_">Uint8Array</span>([<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>]));</span><br></pre></td></tr></table></figure>

<h4 id="文件操作工具函数"><a href="#文件操作工具函数" class="headerlink" title="文件操作工具函数"></a>文件操作工具函数</h4><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 判断文件是否存在</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">fileExists</span>(<span class="params"><span class="attr">path</span>: <span class="built_in">string</span></span>): <span class="title class_">Promise</span>&lt;<span class="built_in">boolean</span>&gt; &#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">await</span> <span class="title class_">Deno</span>.<span class="title function_">stat</span>(path);</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">  &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">    <span class="keyword">if</span> (error <span class="keyword">instanceof</span> <span class="title class_">Deno</span>.<span class="property">errors</span>.<span class="property">NotFound</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">throw</span> error;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建目录（如果不存在）</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">ensureDir</span>(<span class="params"><span class="attr">dir</span>: <span class="built_in">string</span></span>): <span class="title class_">Promise</span>&lt;<span class="built_in">void</span>&gt; &#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> fileInfo = <span class="keyword">await</span> <span class="title class_">Deno</span>.<span class="title function_">stat</span>(dir);</span><br><span class="line">    <span class="keyword">if</span> (!fileInfo.<span class="property">isDirectory</span>) &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">`路径存在但不是目录: <span class="subst">$&#123;dir&#125;</span>`</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">    <span class="keyword">if</span> (error <span class="keyword">instanceof</span> <span class="title class_">Deno</span>.<span class="property">errors</span>.<span class="property">NotFound</span>) &#123;</span><br><span class="line">      <span class="keyword">await</span> <span class="title class_">Deno</span>.<span class="title function_">mkdir</span>(dir, &#123; <span class="attr">recursive</span>: <span class="literal">true</span> &#125;);</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">throw</span> error;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="处理静态资源"><a href="#处理静态资源" class="headerlink" title="处理静态资源"></a>处理静态资源</h3><p>在Oak HTTP服务器框架中使用静态文件中间件：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Application</span>, <span class="title class_">Router</span> &#125; <span class="keyword">from</span> <span class="string">&quot;oak&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; send &#125; <span class="keyword">from</span> <span class="string">&quot;https://deno.land/x/oak@v12.6.1/send.ts&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> app = <span class="keyword">new</span> <span class="title class_">Application</span>();</span><br><span class="line"><span class="keyword">const</span> router = <span class="keyword">new</span> <span class="title class_">Router</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 静态文件处理中间件</span></span><br><span class="line">app.<span class="title function_">use</span>(<span class="title function_">async</span> (ctx, next) =&gt; &#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="comment">// 处理静态文件请求</span></span><br><span class="line">    <span class="keyword">if</span> (ctx.<span class="property">request</span>.<span class="property">url</span>.<span class="property">pathname</span>.<span class="title function_">startsWith</span>(<span class="string">&quot;/static&quot;</span>)) &#123;</span><br><span class="line">      <span class="keyword">const</span> path = ctx.<span class="property">request</span>.<span class="property">url</span>.<span class="property">pathname</span>.<span class="title function_">replace</span>(<span class="string">&quot;/static&quot;</span>, <span class="string">&quot;&quot;</span>);</span><br><span class="line">      <span class="keyword">await</span> <span class="title function_">send</span>(ctx, path, &#123;</span><br><span class="line">        <span class="attr">root</span>: <span class="string">`<span class="subst">$&#123;Deno.cwd()&#125;</span>/public`</span>,</span><br><span class="line">        <span class="attr">index</span>: <span class="string">&quot;index.html&quot;</span>,</span><br><span class="line">      &#125;);</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">await</span> <span class="title function_">next</span>();</span><br><span class="line">  &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">    <span class="keyword">if</span> (err.<span class="property">status</span> !== <span class="number">404</span>) &#123;</span><br><span class="line">      <span class="keyword">throw</span> err;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">await</span> <span class="title function_">next</span>();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 自定义静态文件服务函数</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">serveStaticFile</span>(<span class="params"><span class="attr">ctx</span>: <span class="title class_">Context</span>, <span class="attr">filePath</span>: <span class="built_in">string</span></span>): <span class="title class_">Promise</span>&lt;<span class="built_in">void</span>&gt; &#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> fullPath = <span class="string">`<span class="subst">$&#123;Deno.cwd()&#125;</span>/public/<span class="subst">$&#123;filePath&#125;</span>`</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 检查文件是否存在</span></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">await</span> <span class="title class_">Deno</span>.<span class="title function_">stat</span>(fullPath);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">      <span class="keyword">if</span> (error <span class="keyword">instanceof</span> <span class="title class_">Deno</span>.<span class="property">errors</span>.<span class="property">NotFound</span>) &#123;</span><br><span class="line">        ctx.<span class="property">response</span>.<span class="property">status</span> = <span class="number">404</span>;</span><br><span class="line">        ctx.<span class="property">response</span>.<span class="property">body</span> = &#123; <span class="attr">error</span>: <span class="string">&quot;File not found&quot;</span> &#125;;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">throw</span> error;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 设置内容类型</span></span><br><span class="line">    <span class="keyword">let</span> contentType = <span class="string">&quot;application/octet-stream&quot;</span>;</span><br><span class="line">    <span class="keyword">if</span> (filePath.<span class="title function_">endsWith</span>(<span class="string">&quot;.html&quot;</span>)) contentType = <span class="string">&quot;text/html&quot;</span>;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (filePath.<span class="title function_">endsWith</span>(<span class="string">&quot;.css&quot;</span>)) contentType = <span class="string">&quot;text/css&quot;</span>;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (filePath.<span class="title function_">endsWith</span>(<span class="string">&quot;.js&quot;</span>)) contentType = <span class="string">&quot;text/javascript&quot;</span>;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (filePath.<span class="title function_">endsWith</span>(<span class="string">&quot;.json&quot;</span>)) contentType = <span class="string">&quot;application/json&quot;</span>;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (filePath.<span class="title function_">endsWith</span>(<span class="string">&quot;.png&quot;</span>)) contentType = <span class="string">&quot;image/png&quot;</span>;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (filePath.<span class="title function_">endsWith</span>(<span class="string">&quot;.jpg&quot;</span>) || filePath.<span class="title function_">endsWith</span>(<span class="string">&quot;.jpeg&quot;</span>)) contentType = <span class="string">&quot;image/jpeg&quot;</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 读取并发送文件</span></span><br><span class="line">    <span class="keyword">const</span> content = <span class="keyword">await</span> <span class="title class_">Deno</span>.<span class="title function_">readFile</span>(fullPath);</span><br><span class="line">    ctx.<span class="property">response</span>.<span class="property">headers</span>.<span class="title function_">set</span>(<span class="string">&quot;Content-Type&quot;</span>, contentType);</span><br><span class="line">    ctx.<span class="property">response</span>.<span class="property">body</span> = content;</span><br><span class="line">  &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">`提供静态文件失败: <span class="subst">$&#123;filePath&#125;</span>`</span>, error);</span><br><span class="line">    ctx.<span class="property">response</span>.<span class="property">status</span> = <span class="number">500</span>;</span><br><span class="line">    ctx.<span class="property">response</span>.<span class="property">body</span> = &#123; <span class="attr">error</span>: <span class="string">&quot;Internal server error&quot;</span> &#125;;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用示例</span></span><br><span class="line">router.<span class="title function_">get</span>(<span class="string">&quot;/images/:filename&quot;</span>, <span class="title function_">async</span> (ctx) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> filename = ctx.<span class="property">params</span>.<span class="property">filename</span>;</span><br><span class="line">  <span class="keyword">await</span> <span class="title function_">serveStaticFile</span>(ctx, <span class="string">`images/<span class="subst">$&#123;filename&#125;</span>`</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="使用Web标准API"><a href="#使用Web标准API" class="headerlink" title="使用Web标准API"></a>使用Web标准API</h3><p>Deno使用Web标准API进行开发，无需额外的库：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 使用fetch API发起网络请求</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">fetchData</span>(<span class="params"><span class="attr">url</span>: <span class="built_in">string</span></span>) &#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> response = <span class="keyword">await</span> <span class="title function_">fetch</span>(url);</span><br><span class="line">    <span class="keyword">if</span> (!response.<span class="property">ok</span>) &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">`HTTP错误: <span class="subst">$&#123;response.status&#125;</span>`</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">await</span> response.<span class="title function_">json</span>();</span><br><span class="line">  &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&quot;请求失败:&quot;</span>, error);</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用URL API解析URL</span></span><br><span class="line"><span class="keyword">const</span> url = <span class="keyword">new</span> <span class="title function_">URL</span>(<span class="string">&quot;https://example.com/api/users?page=1&amp;limit=10&quot;</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(url.<span class="property">searchParams</span>.<span class="title function_">get</span>(<span class="string">&quot;page&quot;</span>)); <span class="comment">// &quot;1&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用EventTarget</span></span><br><span class="line"><span class="keyword">const</span> target = <span class="keyword">new</span> <span class="title class_">EventTarget</span>();</span><br><span class="line">target.<span class="title function_">addEventListener</span>(<span class="string">&quot;message&quot;</span>, <span class="function">(<span class="params">event</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;收到消息:&quot;</span>, event.<span class="property">detail</span>);</span><br><span class="line">&#125;);</span><br><span class="line">target.<span class="title function_">dispatchEvent</span>(<span class="keyword">new</span> <span class="title class_">CustomEvent</span>(<span class="string">&quot;message&quot;</span>, &#123; <span class="attr">detail</span>: <span class="string">&quot;Hello Deno!&quot;</span> &#125;));</span><br></pre></td></tr></table></figure>

<h3 id="使用Web-Worker"><a href="#使用Web-Worker" class="headerlink" title="使用Web Worker"></a>使用Web Worker</h3><p>Deno支持多线程处理：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// main.ts</span></span><br><span class="line"><span class="comment">// 创建Web Worker</span></span><br><span class="line"><span class="keyword">const</span> worker = <span class="keyword">new</span> <span class="title class_">Worker</span>(<span class="keyword">new</span> <span class="title function_">URL</span>(<span class="string">&quot;./worker.ts&quot;</span>, <span class="keyword">import</span>.<span class="property">meta</span>.<span class="property">url</span>).<span class="property">href</span>, &#123; <span class="attr">type</span>: <span class="string">&quot;module&quot;</span> &#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 发送消息到Worker</span></span><br><span class="line">worker.<span class="title function_">postMessage</span>(&#123; <span class="attr">type</span>: <span class="string">&quot;process&quot;</span>, <span class="attr">data</span>: [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>] &#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 处理Worker返回的消息</span></span><br><span class="line">worker.<span class="property">onmessage</span> = <span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Worker结果:&quot;</span>, e.<span class="property">data</span>);</span><br><span class="line">  <span class="comment">// 完成后终止Worker</span></span><br><span class="line">  worker.<span class="title function_">terminate</span>();</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// worker.ts</span></span><br><span class="line"><span class="comment">// 接收并处理主线程消息</span></span><br><span class="line">self.<span class="property">onmessage</span> = <span class="title function_">async</span> (e) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; <span class="keyword">type</span>, data &#125; = e.<span class="property">data</span>;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">type</span> === <span class="string">&quot;process&quot;</span>) &#123;</span><br><span class="line">    <span class="comment">// 执行耗时操作</span></span><br><span class="line">    <span class="keyword">const</span> result = <span class="keyword">await</span> <span class="title function_">processData</span>(data);</span><br><span class="line">    <span class="comment">// 返回结果给主线程</span></span><br><span class="line">    self.<span class="title function_">postMessage</span>(result);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">processData</span>(<span class="params"><span class="attr">numbers</span>: <span class="built_in">number</span>[]</span>): <span class="title class_">Promise</span>&lt;<span class="built_in">number</span>&gt; &#123;</span><br><span class="line">  <span class="comment">// 模拟耗时计算</span></span><br><span class="line">  <span class="keyword">await</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function"><span class="params">resolve</span> =&gt;</span> <span class="built_in">setTimeout</span>(resolve, <span class="number">1000</span>));</span><br><span class="line">  <span class="keyword">return</span> numbers.<span class="title function_">reduce</span>(<span class="function">(<span class="params">sum, num</span>) =&gt;</span> sum + num, <span class="number">0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="执行Shell命令"><a href="#执行Shell命令" class="headerlink" title="执行Shell命令"></a>执行Shell命令</h3><p>Deno提供API执行子进程：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 简单命令执行</span></span><br><span class="line"><span class="keyword">const</span> process = <span class="title class_">Deno</span>.<span class="title function_">run</span>(&#123;</span><br><span class="line">  <span class="attr">cmd</span>: [<span class="string">&quot;ls&quot;</span>, <span class="string">&quot;-la&quot;</span>],</span><br><span class="line">  <span class="attr">stdout</span>: <span class="string">&quot;piped&quot;</span>,</span><br><span class="line">  <span class="attr">stderr</span>: <span class="string">&quot;piped&quot;</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 等待命令完成并获取输出</span></span><br><span class="line"><span class="keyword">const</span> &#123; code &#125; = <span class="keyword">await</span> process.<span class="title function_">status</span>();</span><br><span class="line"><span class="keyword">if</span> (code === <span class="number">0</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> output = <span class="keyword">await</span> process.<span class="title function_">output</span>();</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="keyword">new</span> <span class="title class_">TextDecoder</span>().<span class="title function_">decode</span>(output));</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> errorOutput = <span class="keyword">await</span> process.<span class="title function_">stderrOutput</span>();</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="keyword">new</span> <span class="title class_">TextDecoder</span>().<span class="title function_">decode</span>(errorOutput));</span><br><span class="line">&#125;</span><br><span class="line">process.<span class="title function_">close</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 传递环境变量</span></span><br><span class="line"><span class="keyword">const</span> process = <span class="title class_">Deno</span>.<span class="title function_">run</span>(&#123;</span><br><span class="line">  <span class="attr">cmd</span>: [<span class="string">&quot;printenv&quot;</span>, <span class="string">&quot;MY_VARIABLE&quot;</span>],</span><br><span class="line">  <span class="attr">env</span>: &#123; <span class="string">&quot;MY_VARIABLE&quot;</span>: <span class="string">&quot;Hello Deno!&quot;</span> &#125;,</span><br><span class="line">  <span class="attr">stdout</span>: <span class="string">&quot;piped&quot;</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="使用WebSocket"><a href="#使用WebSocket" class="headerlink" title="使用WebSocket"></a>使用WebSocket</h3><p>Deno支持WebSocket进行实时通信：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 服务端WebSocket</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Application</span> &#125; <span class="keyword">from</span> <span class="string">&quot;oak&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Server</span> &#125; <span class="keyword">from</span> <span class="string">&quot;https://deno.land/std@0.196.0/http/server.ts&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">WebSocketServer</span> &#125; <span class="keyword">from</span> <span class="string">&quot;https://deno.land/x/websocket@v0.1.4/mod.ts&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建WebSocket服务器</span></span><br><span class="line"><span class="keyword">const</span> wss = <span class="keyword">new</span> <span class="title class_">WebSocketServer</span>(&#123; <span class="attr">port</span>: <span class="number">8080</span> &#125;);</span><br><span class="line"></span><br><span class="line">wss.<span class="title function_">on</span>(<span class="string">&quot;connection&quot;</span>, <span class="function">(<span class="params">ws</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;新客户端连接&quot;</span>);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 处理消息</span></span><br><span class="line">  ws.<span class="title function_">on</span>(<span class="string">&quot;message&quot;</span>, <span class="function">(<span class="params">message</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;收到消息:&quot;</span>, message);</span><br><span class="line">    <span class="comment">// 广播消息给所有客户端</span></span><br><span class="line">    wss.<span class="property">clients</span>.<span class="title function_">forEach</span>(<span class="function">(<span class="params">client</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (client.<span class="property">readyState</span> === <span class="title class_">WebSocket</span>.<span class="property">OPEN</span>) &#123;</span><br><span class="line">        client.<span class="title function_">send</span>(<span class="string">`服务器时间: <span class="subst">$&#123;<span class="keyword">new</span> <span class="built_in">Date</span>().toISOString()&#125;</span>, 消息: <span class="subst">$&#123;message&#125;</span>`</span>);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 处理连接关闭</span></span><br><span class="line">  ws.<span class="title function_">on</span>(<span class="string">&quot;close&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;客户端断开连接&quot;</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 客户端WebSocket</span></span><br><span class="line"><span class="keyword">const</span> socket = <span class="keyword">new</span> <span class="title class_">WebSocket</span>(<span class="string">&quot;ws://localhost:8080&quot;</span>);</span><br><span class="line"></span><br><span class="line">socket.<span class="property">onopen</span> = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;连接已建立&quot;</span>);</span><br><span class="line">  socket.<span class="title function_">send</span>(<span class="string">&quot;Hello Server!&quot;</span>);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">socket.<span class="property">onmessage</span> = <span class="function">(<span class="params">event</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;收到消息:&quot;</span>, event.<span class="property">data</span>);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">socket.<span class="property">onclose</span> = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;连接已关闭&quot;</span>);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="🔐-环境变量"><a href="#🔐-环境变量" class="headerlink" title="🔐 环境变量"></a>🔐 环境变量</h2><p>项目通过<code>.env</code>文件和<code>Deno.env.get()</code>方法管理环境变量：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">MONGODB_URI=mongodb://[username]:[password]@[host]/</span><br><span class="line">MONGODB_DATABASE=database_name</span><br></pre></td></tr></table></figure>

<blockquote>
<p>⚠️ <strong>警告</strong>: 切勿将包含敏感信息的.env文件提交到版本控制系统。</p>
</blockquote>
<hr>
<h2 id="🛡️-权限管理"><a href="#🛡️-权限管理" class="headerlink" title="🛡️ 权限管理"></a>🛡️ 权限管理</h2><p>Deno需要明确的权限才能访问系统资源：</p>
<table>
<thead>
<tr>
<th>权限标志</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td><code>--allow-net</code></td>
<td>网络访问权限</td>
</tr>
<tr>
<td><code>--allow-env</code></td>
<td>环境变量访问权限</td>
</tr>
<tr>
<td><code>--allow-read</code></td>
<td>文件读取权限</td>
</tr>
<tr>
<td><code>--allow-write</code></td>
<td>文件写入权限</td>
</tr>
<tr>
<td><code>--allow-sys</code></td>
<td>系统信息访问权限</td>
</tr>
</tbody></table>
<p>在<code>deno.json</code>中，这些权限已通过task配置进行预设。</p>
<hr>
<h2 id="📦-第三方库和依赖管理"><a href="#📦-第三方库和依赖管理" class="headerlink" title="📦 第三方库和依赖管理"></a>📦 第三方库和依赖管理</h2><h3 id="常用第三方库"><a href="#常用第三方库" class="headerlink" title="常用第三方库"></a>常用第三方库</h3><table>
<thead>
<tr>
<th>库名</th>
<th>来源</th>
<th>作用</th>
<th>用法示例</th>
</tr>
</thead>
<tbody><tr>
<td><strong>Oak</strong></td>
<td>JSR</td>
<td>HTTP服务器框架</td>
<td><code>import &#123; Application &#125; from &quot;oak&quot;;</code></td>
</tr>
<tr>
<td><strong>Mongoose</strong></td>
<td>npm</td>
<td>MongoDB对象建模工具</td>
<td><code>import mongoose from &quot;mongoose&quot;;</code></td>
</tr>
<tr>
<td><strong>Zod</strong></td>
<td>npm</td>
<td>类型验证库</td>
<td><code>import &#123; z &#125; from &quot;zod&quot;;</code></td>
</tr>
<tr>
<td><strong>std&#x2F;assert</strong></td>
<td>JSR</td>
<td>断言库</td>
<td><code>import &#123; assertEquals &#125; from &quot;@std/assert&quot;;</code></td>
</tr>
<tr>
<td><strong>cliffy</strong></td>
<td>deno.land</td>
<td>CLI框架和工具</td>
<td><code>import &#123; Command &#125; from &quot;cliffy&quot;;</code></td>
</tr>
<tr>
<td><strong>Fresh</strong></td>
<td>JSR</td>
<td>Web框架</td>
<td><code>import &#123; defineConfig &#125; from &quot;fresh&quot;;</code></td>
</tr>
<tr>
<td><strong>MD5</strong></td>
<td>npm</td>
<td>哈希加密算法</td>
<td><code>import md5 from &quot;md5&quot;;</code></td>
</tr>
<tr>
<td><strong>AJV</strong></td>
<td>esm.sh</td>
<td>JSON Schema验证器</td>
<td><code>import Ajv from &quot;ajv&quot;;</code></td>
</tr>
<tr>
<td><strong>JWT</strong></td>
<td>deno.land</td>
<td>JSON Web Token处理</td>
<td><code>import &#123; create, verify &#125; from &quot;djwt&quot;;</code></td>
</tr>
</tbody></table>
<h3 id="数据验证与安全相关库"><a href="#数据验证与安全相关库" class="headerlink" title="数据验证与安全相关库"></a>数据验证与安全相关库</h3><h4 id="1-AJV-和-JSON-Schema"><a href="#1-AJV-和-JSON-Schema" class="headerlink" title="1. AJV 和 JSON Schema"></a>1. AJV 和 JSON Schema</h4><p><a target="_blank" rel="noopener external nofollow noreferrer" href="https://ajv.js.org/">AJV</a>是一个高性能的JSON Schema验证器，用于验证数据结构是否符合预定义的模式：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">Ajv</span> <span class="keyword">from</span> <span class="string">&quot;ajv&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> addFormats <span class="keyword">from</span> <span class="string">&quot;ajv-formats&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 初始化AJV</span></span><br><span class="line"><span class="keyword">const</span> ajv = <span class="keyword">new</span> <span class="title class_">Ajv</span>(&#123;</span><br><span class="line">  <span class="attr">allErrors</span>: <span class="literal">true</span>,      <span class="comment">// 报告所有错误（而不是第一个）</span></span><br><span class="line">  <span class="attr">removeAdditional</span>: <span class="literal">true</span>, <span class="comment">// 删除schema中未定义的属性</span></span><br><span class="line">  <span class="attr">useDefaults</span>: <span class="literal">true</span>     <span class="comment">// 使用模式中定义的默认值</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 添加格式验证</span></span><br><span class="line"><span class="title function_">addFormats</span>(ajv);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义JSON Schema</span></span><br><span class="line"><span class="keyword">const</span> userSchema = &#123;</span><br><span class="line">  <span class="attr">type</span>: <span class="string">&quot;object&quot;</span>,</span><br><span class="line">  <span class="attr">properties</span>: &#123;</span><br><span class="line">    <span class="attr">id</span>: &#123; <span class="attr">type</span>: <span class="string">&quot;string&quot;</span> &#125;,</span><br><span class="line">    <span class="attr">name</span>: &#123; <span class="attr">type</span>: <span class="string">&quot;string&quot;</span>, <span class="attr">minLength</span>: <span class="number">2</span> &#125;,</span><br><span class="line">    <span class="attr">email</span>: &#123; <span class="attr">type</span>: <span class="string">&quot;string&quot;</span>, <span class="attr">format</span>: <span class="string">&quot;email&quot;</span> &#125;,</span><br><span class="line">    <span class="attr">age</span>: &#123; <span class="attr">type</span>: <span class="string">&quot;number&quot;</span>, <span class="attr">minimum</span>: <span class="number">0</span> &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">required</span>: [<span class="string">&quot;id&quot;</span>, <span class="string">&quot;name&quot;</span>, <span class="string">&quot;email&quot;</span>],</span><br><span class="line">  <span class="attr">additionalProperties</span>: <span class="literal">false</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 编译schema以便重复使用</span></span><br><span class="line"><span class="keyword">const</span> validateUser = ajv.<span class="title function_">compile</span>(userSchema);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用封装的验证工具</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">validateData</span>(<span class="params"><span class="attr">data</span>: <span class="built_in">unknown</span>, <span class="attr">schema</span>: <span class="built_in">object</span></span>): &#123; <span class="attr">isValid</span>: <span class="built_in">boolean</span>; <span class="attr">errors</span>: <span class="built_in">any</span>[] &#125; &#123;</span><br><span class="line">  <span class="keyword">const</span> validate = ajv.<span class="title function_">compile</span>(schema);</span><br><span class="line">  <span class="keyword">const</span> isValid = <span class="title function_">validate</span>(data);</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    isValid,</span><br><span class="line">    <span class="attr">errors</span>: isValid ? [] : (validate.<span class="property">errors</span> || [])</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 示例使用</span></span><br><span class="line"><span class="keyword">const</span> result = <span class="title function_">validateData</span>(userData, userSchema);</span><br><span class="line"><span class="keyword">if</span> (!result.<span class="property">isValid</span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&quot;数据验证失败:&quot;</span>, result.<span class="property">errors</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>最佳实践：</strong></p>
<ul>
<li>集中管理所有JSON Schema定义</li>
<li>为复杂API创建可重用的验证函数</li>
<li>使用AJV的自定义关键字和格式拓展特定需求</li>
<li>在API端点处理前验证请求数据</li>
</ul>
<h4 id="2-MD5"><a href="#2-MD5" class="headerlink" title="2. MD5"></a>2. MD5</h4><p>MD5是一种广泛使用的哈希算法，在项目中常用于密码加密或生成唯一标识符：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> md5 <span class="keyword">from</span> <span class="string">&quot;md5&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 基本使用</span></span><br><span class="line"><span class="keyword">const</span> hash = <span class="title function_">md5</span>(<span class="string">&quot;some-string&quot;</span>); <span class="comment">// 返回32字符的哈希字符串</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 用于密码加密（推荐添加盐值）</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">hashPassword</span>(<span class="params"><span class="attr">password</span>: <span class="built_in">string</span>, <span class="attr">salt</span>: <span class="built_in">string</span></span>): <span class="built_in">string</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">md5</span>(password + salt);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 用于生成API请求签名</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">generateSignature</span>(<span class="params"><span class="attr">params</span>: <span class="title class_">Record</span>&lt;<span class="built_in">string</span>, <span class="built_in">string</span>&gt;, <span class="attr">secretKey</span>: <span class="built_in">string</span></span>): <span class="built_in">string</span> &#123;</span><br><span class="line">  <span class="comment">// 按字母顺序排序参数</span></span><br><span class="line">  <span class="keyword">const</span> sortedKeys = <span class="title class_">Object</span>.<span class="title function_">keys</span>(params).<span class="title function_">sort</span>();</span><br><span class="line">  <span class="keyword">let</span> signStr = <span class="string">&quot;&quot;</span>;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 构建签名字符串</span></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">const</span> key <span class="keyword">of</span> sortedKeys) &#123;</span><br><span class="line">    signStr += <span class="string">`<span class="subst">$&#123;key&#125;</span>=<span class="subst">$&#123;params[key]&#125;</span>&amp;`</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 添加密钥并生成最终签名</span></span><br><span class="line">  signStr += secretKey;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">md5</span>(signStr);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>安全提示：</strong></p>
<ul>
<li>⚠️ MD5不再被认为是安全的密码哈希算法</li>
<li>对于密码存储，推荐使用更安全的算法如bcrypt或Argon2</li>
<li>MD5适用于非安全场景如缓存键生成、内容完整性校验等</li>
</ul>
<h4 id="3-JWT-JSON-Web-Token"><a href="#3-JWT-JSON-Web-Token" class="headerlink" title="3. JWT (JSON Web Token)"></a>3. JWT (JSON Web Token)</h4><p>JWT用于创建和验证令牌，常用于身份验证和授权：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; create, verify, decode &#125; <span class="keyword">from</span> <span class="string">&quot;djwt&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; crypto &#125; <span class="keyword">from</span> <span class="string">&quot;std/crypto&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 生成密钥</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">generateKey</span>(<span class="params"></span>): <span class="title class_">Promise</span>&lt;<span class="title class_">CryptoKey</span>&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">await</span> crypto.<span class="property">subtle</span>.<span class="title function_">generateKey</span>(</span><br><span class="line">    &#123; <span class="attr">name</span>: <span class="string">&quot;HMAC&quot;</span>, <span class="attr">hash</span>: <span class="string">&quot;SHA-512&quot;</span> &#125;,</span><br><span class="line">    <span class="literal">true</span>,</span><br><span class="line">    [<span class="string">&quot;sign&quot;</span>, <span class="string">&quot;verify&quot;</span>]</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建JWT令牌</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">createToken</span>(<span class="params"></span></span><br><span class="line"><span class="params">  <span class="attr">payload</span>: <span class="title class_">Record</span>&lt;<span class="built_in">string</span>, <span class="built_in">unknown</span>&gt;, </span></span><br><span class="line"><span class="params">  <span class="attr">expiresIn</span>: <span class="built_in">number</span> = <span class="number">60</span> * <span class="number">60</span> <span class="comment">// 1小时，以秒为单位</span></span></span><br><span class="line"><span class="params"></span>): <span class="title class_">Promise</span>&lt;<span class="built_in">string</span>&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> key = <span class="keyword">await</span> <span class="title function_">generateKey</span>();</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">const</span> jwt = <span class="keyword">await</span> <span class="title function_">create</span>(</span><br><span class="line">    &#123; <span class="attr">alg</span>: <span class="string">&quot;HS512&quot;</span>, <span class="attr">typ</span>: <span class="string">&quot;JWT&quot;</span> &#125;,</span><br><span class="line">    &#123; </span><br><span class="line">      ...payload, </span><br><span class="line">      <span class="attr">exp</span>: <span class="title class_">Math</span>.<span class="title function_">floor</span>(<span class="title class_">Date</span>.<span class="title function_">now</span>() / <span class="number">1000</span>) + expiresIn </span><br><span class="line">    &#125;,</span><br><span class="line">    key</span><br><span class="line">  );</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">return</span> jwt;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 验证JWT令牌</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">verifyToken</span>(<span class="params"><span class="attr">token</span>: <span class="built_in">string</span></span>): <span class="title class_">Promise</span>&lt;<span class="title class_">Record</span>&lt;<span class="built_in">string</span>, <span class="built_in">unknown</span>&gt; | <span class="literal">null</span>&gt; &#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> key = <span class="keyword">await</span> <span class="title function_">generateKey</span>(); <span class="comment">// 生产环境中应该重用密钥</span></span><br><span class="line">    <span class="keyword">const</span> payload = <span class="keyword">await</span> <span class="title function_">verify</span>(token, key);</span><br><span class="line">    <span class="keyword">return</span> payload;</span><br><span class="line">  &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&quot;JWT验证失败:&quot;</span>, err);</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用示例</span></span><br><span class="line"><span class="keyword">const</span> userToken = <span class="keyword">await</span> <span class="title function_">createToken</span>(&#123; <span class="attr">userId</span>: <span class="string">&quot;123&quot;</span>, <span class="attr">role</span>: <span class="string">&quot;admin&quot;</span> &#125;);</span><br><span class="line"><span class="comment">// 在请求头中使用: Authorization: Bearer &lt;token&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 身份验证中间件</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">authMiddleware</span>(<span class="params"><span class="attr">ctx</span>: <span class="title class_">Context</span>, <span class="attr">next</span>: <span class="title class_">Next</span></span>) &#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> authHeader = ctx.<span class="property">request</span>.<span class="property">headers</span>.<span class="title function_">get</span>(<span class="string">&quot;Authorization&quot;</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (!authHeader || !authHeader.<span class="title function_">startsWith</span>(<span class="string">&quot;Bearer &quot;</span>)) &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&quot;缺少有效的授权令牌&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">const</span> token = authHeader.<span class="title function_">replace</span>(<span class="string">&quot;Bearer &quot;</span>, <span class="string">&quot;&quot;</span>);</span><br><span class="line">    <span class="keyword">const</span> payload = <span class="keyword">await</span> <span class="title function_">verifyToken</span>(token);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (!payload) &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&quot;无效的令牌&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 将用户信息附加到上下文</span></span><br><span class="line">    ctx.<span class="property">state</span>.<span class="property">user</span> = payload;</span><br><span class="line">    <span class="keyword">await</span> <span class="title function_">next</span>();</span><br><span class="line">  &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">    ctx.<span class="property">response</span>.<span class="property">status</span> = <span class="number">401</span>;</span><br><span class="line">    ctx.<span class="property">response</span>.<span class="property">body</span> = &#123;</span><br><span class="line">      <span class="attr">success</span>: <span class="literal">false</span>,</span><br><span class="line">      <span class="attr">code</span>: <span class="number">401</span>,</span><br><span class="line">      <span class="attr">message</span>: <span class="string">&quot;未授权访问&quot;</span></span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>JWT最佳实践：</strong></p>
<ul>
<li>设置合理的过期时间，避免令牌永久有效</li>
<li>仅在令牌中存储必要信息，避免存储敏感数据</li>
<li>使用HTTPS传输令牌</li>
<li>实现令牌刷新机制</li>
<li>考虑使用Redis等存储机制来支持令牌吊销</li>
</ul>
<h3 id="实际应用示例"><a href="#实际应用示例" class="headerlink" title="实际应用示例"></a>实际应用示例</h3><h4 id="JSON-Schema用于API验证"><a href="#JSON-Schema用于API验证" class="headerlink" title="JSON Schema用于API验证"></a>JSON Schema用于API验证</h4><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/schemas/user.schema.ts</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> createUserSchema = &#123;</span><br><span class="line">  <span class="attr">type</span>: <span class="string">&quot;object&quot;</span>,</span><br><span class="line">  <span class="attr">properties</span>: &#123;</span><br><span class="line">    <span class="attr">username</span>: &#123; <span class="attr">type</span>: <span class="string">&quot;string&quot;</span>, <span class="attr">minLength</span>: <span class="number">3</span>, <span class="attr">maxLength</span>: <span class="number">20</span> &#125;,</span><br><span class="line">    <span class="attr">email</span>: &#123; <span class="attr">type</span>: <span class="string">&quot;string&quot;</span>, <span class="attr">format</span>: <span class="string">&quot;email&quot;</span> &#125;,</span><br><span class="line">    <span class="attr">password</span>: &#123; <span class="attr">type</span>: <span class="string">&quot;string&quot;</span>, <span class="attr">minLength</span>: <span class="number">8</span> &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">required</span>: [<span class="string">&quot;username&quot;</span>, <span class="string">&quot;email&quot;</span>, <span class="string">&quot;password&quot;</span>],</span><br><span class="line">  <span class="attr">additionalProperties</span>: <span class="literal">false</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// src/middlewares/validate.middleware.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Context</span>, <span class="title class_">Next</span> &#125; <span class="keyword">from</span> <span class="string">&quot;oak&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; validateSchema &#125; <span class="keyword">from</span> <span class="string">&quot;../utils/json-schema.ts&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">validateRequest</span>(<span class="params"><span class="attr">schema</span>: <span class="built_in">object</span></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">async</span> (<span class="attr">ctx</span>: <span class="title class_">Context</span>, <span class="attr">next</span>: <span class="title class_">Next</span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> body = <span class="keyword">await</span> ctx.<span class="property">request</span>.<span class="title function_">body</span>().<span class="property">value</span>;</span><br><span class="line">      <span class="keyword">const</span> &#123; isValid, errors &#125; = <span class="title function_">validateSchema</span>(body, schema);</span><br><span class="line">      </span><br><span class="line">      <span class="keyword">if</span> (!isValid) &#123;</span><br><span class="line">        ctx.<span class="property">response</span>.<span class="property">status</span> = <span class="number">400</span>;</span><br><span class="line">        ctx.<span class="property">response</span>.<span class="property">body</span> = &#123;</span><br><span class="line">          <span class="attr">success</span>: <span class="literal">false</span>,</span><br><span class="line">          <span class="attr">code</span>: <span class="number">400</span>,</span><br><span class="line">          <span class="attr">message</span>: <span class="string">&quot;请求数据验证失败&quot;</span>,</span><br><span class="line">          <span class="attr">errors</span>: errors</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      </span><br><span class="line">      <span class="keyword">await</span> <span class="title function_">next</span>();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">      ctx.<span class="property">response</span>.<span class="property">status</span> = <span class="number">400</span>;</span><br><span class="line">      ctx.<span class="property">response</span>.<span class="property">body</span> = &#123;</span><br><span class="line">        <span class="attr">success</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="attr">code</span>: <span class="number">400</span>,</span><br><span class="line">        <span class="attr">message</span>: <span class="string">&quot;无效的请求数据&quot;</span></span><br><span class="line">      &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 路由中使用验证中间件</span></span><br><span class="line">router.<span class="title function_">post</span>(<span class="string">&quot;/api/users&quot;</span>, <span class="title function_">validateRequest</span>(createUserSchema), userController.<span class="property">createUser</span>);</span><br></pre></td></tr></table></figure>

<h4 id="MD5用于生成唯一标识符"><a href="#MD5用于生成唯一标识符" class="headerlink" title="MD5用于生成唯一标识符"></a>MD5用于生成唯一标识符</h4><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 生成测试ID</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">generateTestId</span>(<span class="params"><span class="attr">userId</span>: <span class="built_in">string</span>, <span class="attr">timestamp</span>: <span class="built_in">number</span></span>): <span class="built_in">string</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">md5</span>(<span class="string">`<span class="subst">$&#123;userId&#125;</span>-<span class="subst">$&#123;timestamp&#125;</span>-<span class="subst">$&#123;<span class="built_in">Math</span>.random()&#125;</span>`</span>).<span class="title function_">substring</span>(<span class="number">0</span>, <span class="number">16</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// MBTI测试提交</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">submitTest</span>(<span class="params"><span class="attr">testData</span>: <span class="title class_">MBTITestSubmission</span></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> now = <span class="keyword">new</span> <span class="title class_">Date</span>();</span><br><span class="line">  <span class="keyword">const</span> testId = <span class="title function_">generateTestId</span>(testData.<span class="property">user_id</span>, now.<span class="title function_">getTime</span>());</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 存储测试数据...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="JSR-Deno包注册表"><a href="#JSR-Deno包注册表" class="headerlink" title="JSR (Deno包注册表)"></a>JSR (Deno包注册表)</h3><p>JSR是官方的Deno包注册表，提供TypeScript和JavaScript包：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 从JSR导入包</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Application</span>, <span class="title class_">Router</span> &#125; <span class="keyword">from</span> <span class="string">&quot;jsr:@oak/oak@^12.6.1&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; assertEquals &#125; <span class="keyword">from</span> <span class="string">&quot;jsr:@std/assert@1&quot;</span>;</span><br></pre></td></tr></table></figure>

<h4 id="在项目中使用JSR"><a href="#在项目中使用JSR" class="headerlink" title="在项目中使用JSR"></a>在项目中使用JSR</h4><ol>
<li>在<code>deno.json</code>中配置imports：</li>
</ol>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;imports&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;@std/assert&quot;</span><span class="punctuation">:</span> <span class="string">&quot;jsr:@std/assert@1&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;oak&quot;</span><span class="punctuation">:</span> <span class="string">&quot;jsr:@oak/oak@^12.6.1&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;fresh&quot;</span><span class="punctuation">:</span> <span class="string">&quot;jsr:@denoland/fresh@^2.0.0&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<ol start="2">
<li>然后在代码中导入：</li>
</ol>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Application</span> &#125; <span class="keyword">from</span> <span class="string">&quot;oak&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; assertEquals &#125; <span class="keyword">from</span> <span class="string">&quot;@std/assert&quot;</span>;</span><br></pre></td></tr></table></figure>

<h3 id="NPM支持"><a href="#NPM支持" class="headerlink" title="NPM支持"></a>NPM支持</h3><p>Deno支持直接使用NPM包，无需转换或额外工具：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 直接从npm导入</span></span><br><span class="line"><span class="keyword">import</span> mongoose <span class="keyword">from</span> <span class="string">&quot;npm:mongoose@^8.0.0&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; z &#125; <span class="keyword">from</span> <span class="string">&quot;npm:zod@^3.22.4&quot;</span>;</span><br></pre></td></tr></table></figure>

<h4 id="在项目中使用NPM包"><a href="#在项目中使用NPM包" class="headerlink" title="在项目中使用NPM包"></a>在项目中使用NPM包</h4><ol>
<li>在<code>deno.json</code>中配置imports：</li>
</ol>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;imports&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;mongoose&quot;</span><span class="punctuation">:</span> <span class="string">&quot;npm:mongoose@^8.0.0&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;zod&quot;</span><span class="punctuation">:</span> <span class="string">&quot;npm:zod@^3.22.4&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;md5&quot;</span><span class="punctuation">:</span> <span class="string">&quot;npm:md5@^2.3.0&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<ol start="2">
<li>然后在代码中导入：</li>
</ol>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> mongoose <span class="keyword">from</span> <span class="string">&quot;mongoose&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; z &#125; <span class="keyword">from</span> <span class="string">&quot;zod&quot;</span>;</span><br></pre></td></tr></table></figure>

<h3 id="其他源导入"><a href="#其他源导入" class="headerlink" title="其他源导入"></a>其他源导入</h3><p>Deno还支持从URL直接导入：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 从URL导入</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Command</span> &#125; <span class="keyword">from</span> <span class="string">&quot;https://deno.land/x/cliffy@v0.25.7/command/mod.ts&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">MySQLConnector</span> &#125; <span class="keyword">from</span> <span class="string">&quot;https://deno.land/x/mysql@v2.12.1/mod.ts&quot;</span>;</span><br></pre></td></tr></table></figure>

<h3 id="包版本管理"><a href="#包版本管理" class="headerlink" title="包版本管理"></a>包版本管理</h3><hr>
<h2 id="📁-项目结构"><a href="#📁-项目结构" class="headerlink" title="📁 项目结构"></a>📁 项目结构</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">/</span><br><span class="line">├── main.ts                # 主入口文件</span><br><span class="line">├── src/</span><br><span class="line">│   ├── routes/            # 路由定义</span><br><span class="line">│   ├── controllers/       # 控制器</span><br><span class="line">│   ├── services/          # 服务层</span><br><span class="line">│   ├── middleware/        # 中间件</span><br><span class="line">│   ├── utils/             # 工具函数</span><br><span class="line">│   ├── scripts/           # 脚本文件</span><br><span class="line">│   └── examples/          # 示例代码</span><br><span class="line">├── deno.json              # Deno项目配置</span><br><span class="line">└── .env                   # 环境变量</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="🔌-API路由"><a href="#🔌-API路由" class="headerlink" title="🔌 API路由"></a>🔌 API路由</h2><p>项目使用Oak HTTP服务器框架定义路由，主要API路由包括：</p>
<h3 id="MBTI测试API"><a href="#MBTI测试API" class="headerlink" title="MBTI测试API"></a>MBTI测试API</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// MBTI测试相关路由</span></span><br><span class="line">router.<span class="title function_">get</span>(<span class="string">&quot;/api/mbti/questions&quot;</span>, mbtiController.<span class="property">getQuestions</span>);</span><br><span class="line">router.<span class="title function_">get</span>(<span class="string">&quot;/api/mbti/types&quot;</span>, mbtiController.<span class="property">getAllTypes</span>);</span><br><span class="line">router.<span class="title function_">get</span>(<span class="string">&quot;/api/mbti/types/:type&quot;</span>, mbtiController.<span class="property">getTypeDetails</span>);</span><br><span class="line">router.<span class="title function_">get</span>(<span class="string">&quot;/api/mbti/roles&quot;</span>, mbtiController.<span class="property">getRoles</span>);</span><br><span class="line">router.<span class="title function_">post</span>(<span class="string">&quot;/api/mbti/test&quot;</span>, mbtiController.<span class="property">submitTest</span>);</span><br><span class="line">router.<span class="title function_">get</span>(<span class="string">&quot;/api/mbti/user/:userId/history&quot;</span>, authMiddleware, mbtiController.<span class="property">getUserTestHistory</span>);</span><br></pre></td></tr></table></figure>

<blockquote>
<p>📝 <strong>注意</strong>：用户历史记录API需要身份验证。</p>
</blockquote>
<hr>
<h2 id="📊-数据模型"><a href="#📊-数据模型" class="headerlink" title="📊 数据模型"></a>📊 数据模型</h2><h3 id="MBTI相关模型"><a href="#MBTI相关模型" class="headerlink" title="MBTI相关模型"></a>MBTI相关模型</h3><details>
<summary><b>MBTIQuestion</b>: MBTI测试问题</summary>

<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> <span class="title class_">MBTIQuestion</span> &#123;</span><br><span class="line">  <span class="attr">id</span>: <span class="built_in">number</span>;</span><br><span class="line">  <span class="attr">question</span>: <span class="built_in">string</span>;</span><br><span class="line">  <span class="attr">options</span>: <span class="title class_">Array</span>&lt;&#123;</span><br><span class="line">    <span class="attr">value</span>: <span class="built_in">string</span>;</span><br><span class="line">    <span class="attr">text</span>: <span class="built_in">string</span>;</span><br><span class="line">  &#125;&gt;;</span><br><span class="line">  <span class="attr">dimension</span>: <span class="built_in">string</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<details>
<summary><b>MBTIType</b>: MBTI人格类型</summary>

<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> <span class="title class_">MBTIType</span> &#123;</span><br><span class="line">  <span class="attr">type</span>: <span class="built_in">string</span>;       <span class="comment">// 如 &quot;INTJ-A&quot;</span></span><br><span class="line">  <span class="attr">name</span>: <span class="built_in">string</span>;       <span class="comment">// 如 &quot;建筑师&quot;</span></span><br><span class="line">  <span class="attr">title</span>: <span class="built_in">string</span>;      <span class="comment">// 如 &quot;建筑师 (自信型)&quot;</span></span><br><span class="line">  <span class="attr">description</span>: <span class="built_in">string</span>;</span><br><span class="line">  <span class="attr">strengths</span>: <span class="built_in">string</span>[];</span><br><span class="line">  <span class="attr">weaknesses</span>: <span class="built_in">string</span>[];</span><br><span class="line">  <span class="attr">roles</span>: <span class="built_in">string</span>;</span><br><span class="line">  <span class="attr">careers</span>: <span class="built_in">string</span>[];</span><br><span class="line">  <span class="attr">famousPeople</span>: <span class="built_in">string</span>[];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<details>
<summary><b>MBTIRole</b>: MBTI角色分类</summary>

<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> <span class="title class_">MBTIRole</span> &#123;</span><br><span class="line">  <span class="attr">role</span>: <span class="built_in">string</span>;      <span class="comment">// 如 &quot;分析师&quot;</span></span><br><span class="line">  <span class="attr">types</span>: <span class="built_in">string</span>[];   <span class="comment">// 如 [&quot;INTJ&quot;, &quot;INTP&quot;, &quot;ENTJ&quot;, &quot;ENTP&quot;]</span></span><br><span class="line">  <span class="attr">description</span>: <span class="built_in">string</span>;</span><br><span class="line">  <span class="attr">traits</span>: <span class="built_in">string</span>[];</span><br><span class="line">  <span class="attr">color</span>: <span class="built_in">string</span>;     <span class="comment">// 如 &quot;#88619A&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<details>
<summary><b>MBTITestResult</b>: 测试结果</summary>

<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> <span class="title class_">MBTITestResult</span> &#123;</span><br><span class="line">  <span class="attr">type</span>: <span class="built_in">string</span>;  <span class="comment">// 如 &quot;INTJ-A&quot;</span></span><br><span class="line">  <span class="attr">scores</span>: &#123;</span><br><span class="line">    <span class="attr">EI_E</span>: <span class="built_in">number</span>, <span class="attr">EI_I</span>: <span class="built_in">number</span>,</span><br><span class="line">    <span class="attr">SN_S</span>: <span class="built_in">number</span>, <span class="attr">SN_N</span>: <span class="built_in">number</span>,</span><br><span class="line">    <span class="attr">TF_T</span>: <span class="built_in">number</span>, <span class="attr">TF_F</span>: <span class="built_in">number</span>,</span><br><span class="line">    <span class="attr">JP_J</span>: <span class="built_in">number</span>, <span class="attr">JP_P</span>: <span class="built_in">number</span>,</span><br><span class="line">    <span class="attr">AT_A</span>: <span class="built_in">number</span>, <span class="attr">AT_T</span>: <span class="built_in">number</span></span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="🧩-MBTI测试实现细节"><a href="#🧩-MBTI测试实现细节" class="headerlink" title="🧩 MBTI测试实现细节"></a>🧩 MBTI测试实现细节</h2><h3 id="1-测试流程"><a href="#1-测试流程" class="headerlink" title="1. 测试流程"></a>1. 测试流程</h3><pre><code class="highlight mermaid">graph LR
    A[获取问题] --&gt; B[提交答案]
    B --&gt; C[计算结果]
    C --&gt; D[保存结果]
    D --&gt; E[查看历史]</code></pre>

<ol>
<li>用户获取测试问题 (<code>GET /api/mbti/questions</code>)</li>
<li>用户提交测试答案 (<code>POST /api/mbti/test</code>)</li>
<li>系统计算测试结果并保存</li>
<li>用户可查看测试历史 (<code>GET /api/mbti/user/:userId/history</code>)</li>
</ol>
<h3 id="2-结果计算逻辑"><a href="#2-结果计算逻辑" class="headerlink" title="2. 结果计算逻辑"></a>2. 结果计算逻辑</h3><details>
<summary>展开查看结果计算代码</summary>

<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="title function_">calculateTestResult</span>(<span class="attr">responses</span>: <span class="title class_">MBTITestResponse</span>[]): <span class="title class_">MBTITestResult</span> &#123;</span><br><span class="line">  <span class="comment">// 初始化分数</span></span><br><span class="line">  <span class="keyword">const</span> scores = &#123;</span><br><span class="line">    <span class="attr">EI_E</span>: <span class="number">0</span>, <span class="attr">EI_I</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="attr">SN_S</span>: <span class="number">0</span>, <span class="attr">SN_N</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="attr">TF_T</span>: <span class="number">0</span>, <span class="attr">TF_F</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="attr">JP_J</span>: <span class="number">0</span>, <span class="attr">JP_P</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="attr">AT_A</span>: <span class="number">0</span>, <span class="attr">AT_T</span>: <span class="number">0</span></span><br><span class="line">  &#125;;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 累计每个维度的分数</span></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">const</span> response <span class="keyword">of</span> responses) &#123;</span><br><span class="line">    <span class="keyword">switch</span> (response.<span class="property">selected_value</span>) &#123;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">&#x27;E&#x27;</span>: scores.<span class="property">EI_E</span>++; <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">&#x27;I&#x27;</span>: scores.<span class="property">EI_I</span>++; <span class="keyword">break</span>;</span><br><span class="line">      <span class="comment">// ...其他维度</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 确定每个维度的主导特质</span></span><br><span class="line">  <span class="keyword">const</span> <span class="variable constant_">E_I</span> = scores.<span class="property">EI_E</span> &gt; scores.<span class="property">EI_I</span> ? <span class="string">&#x27;E&#x27;</span> : <span class="string">&#x27;I&#x27;</span>;</span><br><span class="line">  <span class="keyword">const</span> <span class="variable constant_">S_N</span> = scores.<span class="property">SN_S</span> &gt; scores.<span class="property">SN_N</span> ? <span class="string">&#x27;S&#x27;</span> : <span class="string">&#x27;N&#x27;</span>;</span><br><span class="line">  <span class="keyword">const</span> <span class="variable constant_">T_F</span> = scores.<span class="property">TF_T</span> &gt; scores.<span class="property">TF_F</span> ? <span class="string">&#x27;T&#x27;</span> : <span class="string">&#x27;F&#x27;</span>;</span><br><span class="line">  <span class="keyword">const</span> <span class="variable constant_">J_P</span> = scores.<span class="property">JP_J</span> &gt; scores.<span class="property">JP_P</span> ? <span class="string">&#x27;J&#x27;</span> : <span class="string">&#x27;P&#x27;</span>;</span><br><span class="line">  <span class="keyword">const</span> <span class="variable constant_">A_T</span> = scores.<span class="property">AT_A</span> &gt; scores.<span class="property">AT_T</span> ? <span class="string">&#x27;A&#x27;</span> : <span class="string">&#x27;T&#x27;</span>;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 组合MBTI类型</span></span><br><span class="line">  <span class="keyword">const</span> mbtiType = <span class="string">`<span class="subst">$&#123;E_I&#125;</span><span class="subst">$&#123;S_N&#125;</span><span class="subst">$&#123;T_F&#125;</span><span class="subst">$&#123;J_P&#125;</span>-<span class="subst">$&#123;A_T&#125;</span>`</span>;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    <span class="attr">type</span>: mbtiType,</span><br><span class="line">    scores</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-数据库集合"><a href="#3-数据库集合" class="headerlink" title="3. 数据库集合"></a>3. 数据库集合</h3><p>MBTI测试系统使用了以下MongoDB集合：</p>
<table>
<thead>
<tr>
<th>集合名称</th>
<th>用途</th>
</tr>
</thead>
<tbody><tr>
<td><code>mbti_questions</code></td>
<td>存储测试问题</td>
</tr>
<tr>
<td><code>mbti_types</code></td>
<td>存储MBTI类型描述</td>
</tr>
<tr>
<td><code>mbti_roles</code></td>
<td>存储MBTI角色分类</td>
</tr>
<tr>
<td><code>mbti_test_results</code></td>
<td>存储用户测试记录</td>
</tr>
</tbody></table>
<hr>
<h2 id="🗄️-MongoDB数据库操作"><a href="#🗄️-MongoDB数据库操作" class="headerlink" title="🗄️ MongoDB数据库操作"></a>🗄️ MongoDB数据库操作</h2><p>项目使用自定义的<code>MongoDBService</code>类进行数据库操作，主要方法如下：</p>
<h3 id="连接数据库"><a href="#连接数据库" class="headerlink" title="连接数据库"></a>连接数据库</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 初始化连接</span></span><br><span class="line"><span class="keyword">const</span> mongoDBService = <span class="keyword">new</span> <span class="title class_">MongoDBService</span>(&#123;</span><br><span class="line">  <span class="attr">uri</span>: <span class="string">&quot;mongodb://[username]:[password]@[host]/&quot;</span>,</span><br><span class="line">  <span class="attr">dbName</span>: <span class="string">&quot;database_name&quot;</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 连接数据库</span></span><br><span class="line"><span class="keyword">await</span> mongoDBService.<span class="title function_">connect</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 关闭连接</span></span><br><span class="line"><span class="keyword">await</span> mongoDBService.<span class="title function_">close</span>();</span><br></pre></td></tr></table></figure>

<h3 id="基本CRUD操作"><a href="#基本CRUD操作" class="headerlink" title="基本CRUD操作"></a>基本CRUD操作</h3><details>
<summary>展开查看CRUD操作示例</summary>

<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 查询文档</span></span><br><span class="line"><span class="keyword">const</span> documents = <span class="keyword">await</span> mongoDBService.<span class="title function_">find</span>(<span class="string">&quot;collection_name&quot;</span>, &#123; <span class="attr">field</span>: <span class="string">&quot;value&quot;</span> &#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 根据ID查询</span></span><br><span class="line"><span class="keyword">const</span> <span class="variable language_">document</span> = <span class="keyword">await</span> mongoDBService.<span class="title function_">findById</span>(<span class="string">&quot;collection_name&quot;</span>, <span class="string">&quot;id&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 插入文档</span></span><br><span class="line"><span class="keyword">const</span> result = <span class="keyword">await</span> mongoDBService.<span class="title function_">insertOne</span>(<span class="string">&quot;collection_name&quot;</span>, &#123; <span class="attr">field</span>: <span class="string">&quot;value&quot;</span> &#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 批量插入</span></span><br><span class="line"><span class="keyword">const</span> result = <span class="keyword">await</span> mongoDBService.<span class="title function_">insertMany</span>(<span class="string">&quot;collection_name&quot;</span>, [&#123; <span class="attr">field</span>: <span class="string">&quot;value&quot;</span> &#125;]);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 更新文档</span></span><br><span class="line"><span class="keyword">const</span> result = <span class="keyword">await</span> mongoDBService.<span class="title function_">updateOne</span>(</span><br><span class="line">  <span class="string">&quot;collection_name&quot;</span>, </span><br><span class="line">  &#123; <span class="attr">field</span>: <span class="string">&quot;value&quot;</span> &#125;, </span><br><span class="line">  &#123; <span class="attr">$set</span>: &#123; <span class="attr">field</span>: <span class="string">&quot;new_value&quot;</span> &#125; &#125;</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 根据ID更新</span></span><br><span class="line"><span class="keyword">const</span> result = <span class="keyword">await</span> mongoDBService.<span class="title function_">updateById</span>(<span class="string">&quot;collection_name&quot;</span>, <span class="string">&quot;id&quot;</span>, &#123; <span class="attr">field</span>: <span class="string">&quot;value&quot;</span> &#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 删除文档</span></span><br><span class="line"><span class="keyword">const</span> result = <span class="keyword">await</span> mongoDBService.<span class="title function_">deleteOne</span>(<span class="string">&quot;collection_name&quot;</span>, &#123; <span class="attr">field</span>: <span class="string">&quot;value&quot;</span> &#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 根据ID删除</span></span><br><span class="line"><span class="keyword">const</span> result = <span class="keyword">await</span> mongoDBService.<span class="title function_">deleteById</span>(<span class="string">&quot;collection_name&quot;</span>, <span class="string">&quot;id&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 聚合查询</span></span><br><span class="line"><span class="keyword">const</span> result = <span class="keyword">await</span> mongoDBService.<span class="title function_">aggregate</span>(<span class="string">&quot;collection_name&quot;</span>, [</span><br><span class="line">  &#123; <span class="attr">$match</span>: &#123; <span class="attr">field</span>: <span class="string">&quot;value&quot;</span> &#125; &#125;,</span><br><span class="line">  &#123; <span class="attr">$group</span>: &#123; <span class="attr">_id</span>: <span class="string">&quot;$field&quot;</span>, <span class="attr">count</span>: &#123; <span class="attr">$sum</span>: <span class="number">1</span> &#125; &#125; &#125;</span><br><span class="line">]);</span><br></pre></td></tr></table></figure>

<h3 id="MBTI实际数据库操作示例"><a href="#MBTI实际数据库操作示例" class="headerlink" title="MBTI实际数据库操作示例"></a>MBTI实际数据库操作示例</h3><details>
<summary>查询所有MBTI类型</summary>

<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="title function_">getAllTypes</span>(): <span class="title class_">Promise</span>&lt;<span class="title class_">MBTIType</span>[]&gt; &#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">await</span> <span class="variable language_">this</span>.<span class="property">mongoDBService</span>.<span class="title function_">connect</span>();</span><br><span class="line">    <span class="keyword">const</span> types = <span class="keyword">await</span> <span class="variable language_">this</span>.<span class="property">mongoDBService</span>.<span class="title function_">find</span>(<span class="variable language_">this</span>.<span class="property">typesCollection</span>, &#123;&#125;);</span><br><span class="line">    <span class="keyword">return</span> types <span class="keyword">as</span> <span class="built_in">unknown</span> <span class="keyword">as</span> <span class="title class_">MBTIType</span>[];</span><br><span class="line">  &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">logger</span>.<span class="title function_">error</span>(<span class="string">&quot;获取所有MBTI类型失败:&quot;</span>, error);</span><br><span class="line">    <span class="keyword">throw</span> error;</span><br><span class="line">  &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">    <span class="keyword">await</span> <span class="variable language_">this</span>.<span class="property">mongoDBService</span>.<span class="title function_">close</span>();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</details>

<details>
<summary>保存测试结果</summary>

<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 新用户，创建记录</span></span><br><span class="line"><span class="keyword">const</span> newUserData = &#123;</span><br><span class="line">  <span class="attr">user_id</span>: testData.<span class="property">user_id</span>,</span><br><span class="line">  <span class="attr">nickname</span>: testData.<span class="property">nickname</span> || testData.<span class="property">user_id</span>,</span><br><span class="line">  <span class="attr">tests</span>: [&#123;</span><br><span class="line">    <span class="attr">test_id</span>: testId,</span><br><span class="line">    <span class="attr">test_date</span>: now,</span><br><span class="line">    <span class="attr">completed</span>: isCompleted,</span><br><span class="line">    <span class="attr">responses</span>: testData.<span class="property">responses</span>,</span><br><span class="line">    <span class="attr">result</span>: testResult</span><br><span class="line">  &#125;],</span><br><span class="line">  <span class="attr">test_count</span>: <span class="number">1</span>,</span><br><span class="line">  <span class="attr">latest_type</span>: testResult?.<span class="property">type</span> || <span class="literal">null</span>,</span><br><span class="line">  <span class="attr">created_at</span>: now,</span><br><span class="line">  <span class="attr">updated_at</span>: now</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">await</span> <span class="variable language_">this</span>.<span class="property">mongoDBService</span>.<span class="title function_">insertOne</span>(<span class="variable language_">this</span>.<span class="property">testResultsCollection</span>, newUserData);</span><br></pre></td></tr></table></figure>

<details>
<summary>更新现有记录</summary>

<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 现有用户，更新记录</span></span><br><span class="line"><span class="keyword">const</span> userData = existingUsers[<span class="number">0</span>] <span class="keyword">as</span> <span class="title class_">Record</span>&lt;<span class="built_in">string</span>, <span class="built_in">unknown</span>&gt;;</span><br><span class="line"><span class="keyword">const</span> tests = userData.<span class="property">tests</span> <span class="keyword">as</span> <span class="title class_">Array</span>&lt;<span class="title class_">Record</span>&lt;<span class="built_in">string</span>, <span class="built_in">unknown</span>&gt;&gt; || [];</span><br><span class="line"></span><br><span class="line">tests.<span class="title function_">push</span>(&#123;</span><br><span class="line">  <span class="attr">test_id</span>: testId,</span><br><span class="line">  <span class="attr">test_date</span>: now,</span><br><span class="line">  <span class="attr">completed</span>: isCompleted,</span><br><span class="line">  <span class="attr">responses</span>: testData.<span class="property">responses</span>,</span><br><span class="line">  <span class="attr">result</span>: testResult</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="attr">updateData</span>: <span class="title class_">Record</span>&lt;<span class="built_in">string</span>, <span class="built_in">unknown</span>&gt; = &#123;</span><br><span class="line">  tests,</span><br><span class="line">  <span class="attr">test_count</span>: tests.<span class="property">length</span>,</span><br><span class="line">  <span class="attr">updated_at</span>: now</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 如果测试完成，更新最新类型</span></span><br><span class="line"><span class="keyword">if</span> (isCompleted &amp;&amp; testResult) &#123;</span><br><span class="line">  updateData.<span class="property">latest_type</span> = testResult.<span class="property">type</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">await</span> <span class="variable language_">this</span>.<span class="property">mongoDBService</span>.<span class="title function_">updateOne</span>(</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">testResultsCollection</span>,</span><br><span class="line">  &#123; <span class="attr">user_id</span>: testData.<span class="property">user_id</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">$set</span>: updateData &#125;</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<h3 id="分页查询"><a href="#分页查询" class="headerlink" title="分页查询"></a>分页查询</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> result = <span class="keyword">await</span> mongoDBService.<span class="title function_">paginate</span>(</span><br><span class="line">  <span class="string">&quot;collection_name&quot;</span>,   <span class="comment">// 集合名称</span></span><br><span class="line">  <span class="number">1</span>,                   <span class="comment">// 页码</span></span><br><span class="line">  <span class="number">10</span>,                  <span class="comment">// 每页记录数</span></span><br><span class="line">  &#123; <span class="attr">field</span>: <span class="string">&quot;value&quot;</span> &#125;,  <span class="comment">// 查询条件</span></span><br><span class="line">  &#123; <span class="attr">sort</span>: &#123; <span class="attr">field</span>: <span class="number">1</span> &#125; &#125; <span class="comment">// 排序选项</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<h4 id="返回结果格式"><a href="#返回结果格式" class="headerlink" title="返回结果格式"></a>返回结果格式</h4><table>
<thead>
<tr>
<th>字段</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td><code>data</code></td>
<td>数据数组</td>
</tr>
<tr>
<td><code>total</code></td>
<td>总记录数</td>
</tr>
<tr>
<td><code>page</code></td>
<td>当前页码</td>
</tr>
<tr>
<td><code>limit</code></td>
<td>每页记录数</td>
</tr>
<tr>
<td><code>pageCount</code></td>
<td>总页数</td>
</tr>
</tbody></table>
<hr>
<h2 id="🧰-MongoDB查询语法"><a href="#🧰-MongoDB查询语法" class="headerlink" title="🧰 MongoDB查询语法"></a>🧰 MongoDB查询语法</h2><h3 id="常用操作符"><a href="#常用操作符" class="headerlink" title="常用操作符"></a>常用操作符</h3><details>
<summary>展开查看常用查询操作符</summary>

<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 相等查询</span></span><br><span class="line">&#123; <span class="attr">field</span>: <span class="string">&quot;value&quot;</span> &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 不等查询</span></span><br><span class="line">&#123; <span class="attr">field</span>: &#123; <span class="attr">$ne</span>: <span class="string">&quot;value&quot;</span> &#125; &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 大于/小于</span></span><br><span class="line">&#123; <span class="attr">field</span>: &#123; <span class="attr">$gt</span>: <span class="number">10</span> &#125; &#125;  <span class="comment">// 大于</span></span><br><span class="line">&#123; <span class="attr">field</span>: &#123; <span class="attr">$lt</span>: <span class="number">10</span> &#125; &#125;  <span class="comment">// 小于</span></span><br><span class="line">&#123; <span class="attr">field</span>: &#123; <span class="attr">$gte</span>: <span class="number">10</span> &#125; &#125; <span class="comment">// 大于等于</span></span><br><span class="line">&#123; <span class="attr">field</span>: &#123; <span class="attr">$lte</span>: <span class="number">10</span> &#125; &#125; <span class="comment">// 小于等于</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// IN查询</span></span><br><span class="line">&#123; <span class="attr">field</span>: &#123; <span class="attr">$in</span>: [<span class="string">&quot;value1&quot;</span>, <span class="string">&quot;value2&quot;</span>] &#125; &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 逻辑操作符</span></span><br><span class="line">&#123; <span class="attr">$and</span>: [&#123; <span class="attr">field1</span>: <span class="string">&quot;value1&quot;</span> &#125;, &#123; <span class="attr">field2</span>: <span class="string">&quot;value2&quot;</span> &#125;] &#125;</span><br><span class="line">&#123; <span class="attr">$or</span>: [&#123; <span class="attr">field1</span>: <span class="string">&quot;value1&quot;</span> &#125;, &#123; <span class="attr">field1</span>: <span class="string">&quot;value2&quot;</span> &#125;] &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 正则表达式</span></span><br><span class="line">&#123; <span class="attr">field</span>: &#123; <span class="attr">$regex</span>: <span class="string">&quot;pattern&quot;</span>, <span class="attr">$options</span>: <span class="string">&quot;i&quot;</span> &#125; &#125; <span class="comment">// i表示不区分大小写</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 存在性检查</span></span><br><span class="line">&#123; <span class="attr">field</span>: &#123; <span class="attr">$exists</span>: <span class="literal">true</span> &#125; &#125;</span><br></pre></td></tr></table></figure>

<h3 id="更新操作符"><a href="#更新操作符" class="headerlink" title="更新操作符"></a>更新操作符</h3><details>
<summary>展开查看常用更新操作符</summary>

<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 设置字段值</span></span><br><span class="line">&#123; <span class="attr">$set</span>: &#123; <span class="attr">field</span>: <span class="string">&quot;new_value&quot;</span> &#125; &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 增加数值</span></span><br><span class="line">&#123; <span class="attr">$inc</span>: &#123; <span class="attr">counter</span>: <span class="number">1</span> &#125; &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 添加到数组</span></span><br><span class="line">&#123; <span class="attr">$push</span>: &#123; <span class="attr">array_field</span>: <span class="string">&quot;new_item&quot;</span> &#125; &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 从数组移除</span></span><br><span class="line">&#123; <span class="attr">$pull</span>: &#123; <span class="attr">array_field</span>: <span class="string">&quot;item_to_remove&quot;</span> &#125; &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 添加到集合（不重复）</span></span><br><span class="line">&#123; <span class="attr">$addToSet</span>: &#123; <span class="attr">array_field</span>: <span class="string">&quot;new_unique_item&quot;</span> &#125; &#125;</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="📝-注意事项和最佳实践"><a href="#📝-注意事项和最佳实践" class="headerlink" title="📝 注意事项和最佳实践"></a>📝 注意事项和最佳实践</h2><h3 id="数据库连接管理"><a href="#数据库连接管理" class="headerlink" title="数据库连接管理"></a>数据库连接管理</h3><ul>
<li>✅ 始终在操作结束后关闭数据库连接（使用<code>finally</code>块）</li>
<li>✅ 使用try-catch-finally处理数据库操作可能出现的异常</li>
</ul>
<h3 id="错误处理和日志"><a href="#错误处理和日志" class="headerlink" title="错误处理和日志"></a>错误处理和日志</h3><ul>
<li>✅ 使用统一的Logger类进行日志记录</li>
<li>✅ 所有外部调用（数据库、API）都应有错误处理</li>
</ul>
<h3 id="MongoDB操作"><a href="#MongoDB操作" class="headerlink" title="MongoDB操作"></a>MongoDB操作</h3><ul>
<li>✅ 使用<code>countDocuments</code>而不是已废弃的<code>count</code>方法</li>
<li>✅ 使用<code>find</code>方法时添加合适的投影(projection)以减少数据传输</li>
<li>✅ 对大结果集使用分页查询</li>
</ul>
<h3 id="安全性"><a href="#安全性" class="headerlink" title="安全性"></a>安全性</h3><ul>
<li>🔒 敏感API使用<code>authMiddleware</code>进行保护</li>
<li>🔒 不要在代码中硬编码敏感信息（如数据库密码）</li>
</ul>
<h3 id="性能优化"><a href="#性能优化" class="headerlink" title="性能优化"></a>性能优化</h3><ul>
<li>⚡ 大量文档使用批量操作（insertMany, updateMany）</li>
<li>⚡ 添加适当的索引以加速查询</li>
<li>⚡ 使用投影限制返回字段</li>
</ul>
<h3 id="特定项目注意事项"><a href="#特定项目注意事项" class="headerlink" title="特定项目注意事项"></a>特定项目注意事项</h3><ul>
<li>📋 MBTI测试需要至少16个问题才能完成</li>
<li>📋 每个用户可以有多个测试记录</li>
<li>📋 API响应格式保持一致（包含success, code, data&#x2F;message字段）</li>
</ul>
<hr>
<h3 id="API响应格式设计"><a href="#API响应格式设计" class="headerlink" title="API响应格式设计"></a>API响应格式设计</h3><p>为确保前端能高效处理API响应，所有API应遵循一致的响应格式：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> <span class="title class_">ApiResponse</span>&lt;T&gt; &#123;</span><br><span class="line">  <span class="attr">success</span>: <span class="built_in">boolean</span>;     <span class="comment">// 请求是否成功</span></span><br><span class="line">  <span class="attr">code</span>: <span class="built_in">number</span>;         <span class="comment">// 状态码，与HTTP状态码保持一致</span></span><br><span class="line">  <span class="attr">data</span>?: T;             <span class="comment">// 成功时返回的数据</span></span><br><span class="line">  <span class="attr">message</span>?: <span class="built_in">string</span>;     <span class="comment">// 错误时的消息</span></span><br><span class="line">  <span class="attr">pagination</span>?: &#123;        <span class="comment">// 分页信息（如适用）</span></span><br><span class="line">    <span class="attr">total</span>: <span class="built_in">number</span>;</span><br><span class="line">    <span class="attr">page</span>: <span class="built_in">number</span>;</span><br><span class="line">    <span class="attr">limit</span>: <span class="built_in">number</span>;</span><br><span class="line">    <span class="attr">pageCount</span>: <span class="built_in">number</span>;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="前端实现建议"><a href="#前端实现建议" class="headerlink" title="前端实现建议"></a>前端实现建议</h3><ol>
<li><p><strong>MBTI测试界面设计</strong>:</p>
<ul>
<li>采用分步骤展示问题，减轻用户负担</li>
<li>进度指示器显示完成情况</li>
<li>使用直观的选项设计（如滑块、单选按钮）</li>
<li>结果页面突出显示用户的MBTI类型和特点</li>
</ul>
</li>
<li><p><strong>响应式设计</strong>:</p>
<ul>
<li>确保在移动设备和桌面设备上都有良好的用户体验</li>
<li>针对不同屏幕尺寸优化布局</li>
<li>考虑触摸操作的便利性</li>
</ul>
</li>
<li><p><strong>性能优化</strong>:</p>
<ul>
<li>实施懒加载技术，特别是对MBTI类型详情页面</li>
<li>缓存用户历史测试结果</li>
<li>优化图片和资源加载</li>
</ul>
</li>
<li><p><strong>交互体验优化</strong>:</p>
<ul>
<li>添加适当的动画和过渡效果</li>
<li>实现即时反馈机制</li>
<li>考虑离线支持，允许用户在无网络情况下完成测试</li>
</ul>
</li>
</ol>
<h3 id="用户体验优化建议"><a href="#用户体验优化建议" class="headerlink" title="用户体验优化建议"></a>用户体验优化建议</h3><ul>
<li>📱 <strong>引导式测试流程</strong>: 提供清晰的指引和说明</li>
<li>🎯 <strong>个性化结果展示</strong>: 根据用户的MBTI类型提供个性化的结果页面</li>
<li>🔄 <strong>社交分享功能</strong>: 允许用户分享他们的测试结果到社交媒体</li>
<li>🌓 <strong>主题定制</strong>: 提供浅色&#x2F;深色模式切换</li>
</ul>
<hr>
<h2 id="❓-常见问题排查"><a href="#❓-常见问题排查" class="headerlink" title="❓ 常见问题排查"></a>❓ 常见问题排查</h2><h3 id="MongoDB连接问题"><a href="#MongoDB连接问题" class="headerlink" title="MongoDB连接问题"></a>MongoDB连接问题</h3><ul>
<li>🔍 检查URI和数据库名称配置</li>
<li>🔍 确认MongoDB服务器运行状态</li>
<li>🔍 检查网络连接和防火墙设置</li>
</ul>
<h3 id="API返回空数据"><a href="#API返回空数据" class="headerlink" title="API返回空数据"></a>API返回空数据</h3><ul>
<li>🔍 检查数据库连接</li>
<li>🔍 确认集合中有数据</li>
<li>🔍 验证查询条件是否正确</li>
</ul>
<h3 id="权限问题"><a href="#权限问题" class="headerlink" title="权限问题"></a>权限问题</h3><ul>
<li>🔍 确认用户有正确的数据库权限</li>
<li>🔍 验证授权令牌是否有效</li>
</ul>
<h3 id="部署相关问题"><a href="#部署相关问题" class="headerlink" title="部署相关问题"></a>部署相关问题</h3><ul>
<li>🔍 确保目标环境包含所有必要的环境变量</li>
<li>🔍 检查运行命令是否包含所有必要的权限标志</li>
</ul>
<hr>
<h2 id="🚀-扩展和改进"><a href="#🚀-扩展和改进" class="headerlink" title="🚀 扩展和改进"></a>🚀 扩展和改进</h2><ol>
<li><strong>API文档</strong>: 考虑添加Swagger或类似工具</li>
<li><strong>缓存层</strong>: 为频繁访问的数据添加缓存</li>
<li><strong>监控</strong>: 添加性能监控和健康检查</li>
<li><strong>CI&#x2F;CD</strong>: 设置自动化测试和部署</li>
</ol>
<hr>
<p>建议在<code>deno.json</code>中集中管理所有依赖的版本，便于后续升级和维护：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;imports&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;oak&quot;</span><span class="punctuation">:</span> <span class="string">&quot;jsr:@oak/oak@^12.6.1&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;mongoose&quot;</span><span class="punctuation">:</span> <span class="string">&quot;npm:mongoose@^8.0.0&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;std/&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https://deno.land/std@0.196.0/&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<hr>
<h2 id="🚢-Deno部署指南"><a href="#🚢-Deno部署指南" class="headerlink" title="🚢 Deno部署指南"></a>🚢 Deno部署指南</h2><h3 id="使用Deno-Deploy"><a href="#使用Deno-Deploy" class="headerlink" title="使用Deno Deploy"></a>使用Deno Deploy</h3><p><a target="_blank" rel="noopener external nofollow noreferrer" href="https://deno.com/deploy">Deno Deploy</a>是官方的serverless平台，可以轻松部署Deno应用。</p>
<h4 id="1-使用deployctl工具"><a href="#1-使用deployctl工具" class="headerlink" title="1. 使用deployctl工具"></a>1. 使用deployctl工具</h4><p>首先安装deployctl工具：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">deno install --allow-read --allow-write --allow-env --allow-net --allow-run --no-check -r -f https://deno.land/x/deploy/deployctl.ts</span><br></pre></td></tr></table></figure>

<h4 id="2-部署项目"><a href="#2-部署项目" class="headerlink" title="2. 部署项目"></a>2. 部署项目</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 直接部署</span></span><br><span class="line">deployctl deploy --project=your-project-name main.ts</span><br><span class="line"></span><br><span class="line"><span class="comment"># 指定环境变量</span></span><br><span class="line">deployctl deploy --project=your-project-name --env-file=.<span class="built_in">env</span> main.ts</span><br></pre></td></tr></table></figure>

<h4 id="3-通过deno-json配置"><a href="#3-通过deno-json配置" class="headerlink" title="3. 通过deno.json配置"></a>3. 通过deno.json配置</h4><p>项目的<code>deno.json</code>可以包含部署配置：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;deploy&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;project&quot;</span><span class="punctuation">:</span> <span class="string">&quot;your-project-id&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;exclude&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;**/node_modules&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;include&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;entrypoint&quot;</span><span class="punctuation">:</span> <span class="string">&quot;main.ts&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>然后执行：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">deno task deploy</span><br></pre></td></tr></table></figure>

<h3 id="部署前的准备"><a href="#部署前的准备" class="headerlink" title="部署前的准备"></a>部署前的准备</h3><ol>
<li><p><strong>确保项目结构正确</strong>：</p>
<ul>
<li>入口文件应该是自包含的，或者能够访问所有依赖</li>
<li>确保所有路径正确（相对路径和绝对路径）</li>
</ul>
</li>
<li><p><strong>环境变量处理</strong>：</p>
<ul>
<li>部署环境需要设置所有必需的环境变量</li>
<li>可以在Deno Deploy控制台中配置环境变量</li>
<li>敏感信息不应硬编码或包含在版本控制中</li>
</ul>
</li>
<li><p><strong>文件系统限制</strong>：</p>
<ul>
<li>Deno Deploy不支持本地文件系统写入</li>
<li>所有文件操作应替换为存储服务(如MongoDB)或内存存储</li>
</ul>
</li>
<li><p><strong>网络访问和第三方服务</strong>：</p>
<ul>
<li>确保所有外部服务都能从Deno Deploy访问</li>
<li>使用适当的超时和重试策略处理间歇性连接问题</li>
</ul>
</li>
</ol>
<h3 id="注意事项和限制"><a href="#注意事项和限制" class="headerlink" title="注意事项和限制"></a>注意事项和限制</h3><ol>
<li><p><strong>冷启动</strong>:</p>
<ul>
<li>Serverless环境可能有冷启动延迟</li>
<li>关键服务应优化以快速初始化</li>
</ul>
</li>
<li><p><strong>执行时间限制</strong>:</p>
<ul>
<li>请求处理时间有限制，长时间操作应拆分或异步处理</li>
</ul>
</li>
<li><p><strong>内存限制</strong>:</p>
<ul>
<li>遵循内存最佳实践，避免内存泄漏</li>
<li>大型对象应分块处理或使用流处理</li>
</ul>
</li>
<li><p><strong>依赖项</strong>:</p>
<ul>
<li>确保所有依赖项都与Deno Deploy兼容</li>
<li>某些依赖于Node.js API的npm包可能不兼容</li>
<li>使用Deno标准库或专门的Deno包以获得最佳体验</li>
</ul>
</li>
<li><p><strong>数据库连接</strong>:</p>
<ul>
<li>使用连接池和合适的连接管理策略</li>
<li>防止连接泄漏，确保在请求结束时关闭连接</li>
</ul>
</li>
<li><p><strong>定时任务</strong>:</p>
<ul>
<li>Deno Deploy支持通过Cron触发器运行定时任务</li>
<li>对于复杂的调度需求，可能需要外部服务</li>
</ul>
</li>
</ol>
<h3 id="部署后的监控"><a href="#部署后的监控" class="headerlink" title="部署后的监控"></a>部署后的监控</h3><ul>
<li>使用Deno Deploy提供的日志和指标监控应用性能</li>
<li>考虑添加自定义日志记录以跟踪关键操作</li>
<li>实现健康检查端点以监控服务状态</li>
</ul>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 健康检查端点示例</span></span><br><span class="line">router.<span class="title function_">get</span>(<span class="string">&quot;/health&quot;</span>, <span class="function">(<span class="params">ctx</span>) =&gt;</span> &#123;</span><br><span class="line">  ctx.<span class="property">response</span>.<span class="property">status</span> = <span class="number">200</span>;</span><br><span class="line">  ctx.<span class="property">response</span>.<span class="property">body</span> = &#123;</span><br><span class="line">    <span class="attr">status</span>: <span class="string">&quot;ok&quot;</span>,</span><br><span class="line">    <span class="attr">timestamp</span>: <span class="keyword">new</span> <span class="title class_">Date</span>().<span class="title function_">toISOString</span>(),</span><br><span class="line">    <span class="attr">version</span>: <span class="string">&quot;1.0.0&quot;</span></span><br><span class="line">  &#125;;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="📐-代码规范"><a href="#📐-代码规范" class="headerlink" title="📐 代码规范"></a>📐 代码规范</h2><ul>
<li>📄 使用TSDoc风格的注释</li>
<li>🔄 保持一致的错误处理和日志记录模式</li>
<li>🧩 遵循模块化设计原则</li>
</ul>
<hr>
<h2 id="📚-资源链接"><a href="#📚-资源链接" class="headerlink" title="📚 资源链接"></a>📚 资源链接</h2><ul>
<li><a target="_blank" rel="noopener external nofollow noreferrer" href="https://deno.land/manual">Deno官方文档</a></li>
<li><a target="_blank" rel="noopener external nofollow noreferrer" href="https://deno.land/x/oak">Oak HTTP服务器框架文档</a></li>
<li><a target="_blank" rel="noopener external nofollow noreferrer" href="https://www.mongodb.com/docs/">MongoDB文档</a></li>
<li><a target="_blank" rel="noopener external nofollow noreferrer" href="https://mongoosejs.com/docs/">Mongoose文档</a></li>
<li><a target="_blank" rel="noopener external nofollow noreferrer" href="https://www.myersbriggs.org/">MBTI官方网站</a></li>
<li><a target="_blank" rel="noopener external nofollow noreferrer" href="https://www.16personalities.com/">16Personalities</a></li>
</ul>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="https://aoayaoa.github.io">aoaYaoa</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="https://aoayaoa.github.io/2025/04/15/deno%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/">https://aoayaoa.github.io/2025/04/15/deno%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="external nofollow noreferrer" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来源 <a href="https://aoayaoa.github.io" target="_blank">aoaYaoa</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Deno/">Deno</a></div><div class="post-share"><div class="social-share" data-image="/img/deno.jpeg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/2025/03/15/react/" title="react总结"><img class="cover" src="/img/react19.jpeg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="info"><div class="info-1"><div class="info-item-1">上一篇</div><div class="info-item-2">react总结</div></div><div class="info-2"><div class="info-item-1">React 18&#x2F;19 学习总结目录 React 基础概念 常见用法与最佳实践 Hook 详解与最佳实践 易错点与陷阱 项目实践注意事项 性能优化技巧 React 18 核心特性 React 19 新特性与展望 额外资源   React 基础概念组件与JSXReact 的核心理念是将 UI 分解成独立、可复用的组件。每个组件都是一个自包含的模块，负责渲染 UI 的一部分。  关键概念：组件是 React 应用的构建块，可以使用函数组件或类组件创建。   1234567891011// 函数组件function Welcome(props) &#123;  return...</div></div></div></a><a class="pagination-related" href="/2025/04/25/Go%E8%AF%AD%E8%A8%80%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/" title="Go语言学习总结"><img class="cover" src="/img/go.jpeg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="info text-right"><div class="info-1"><div class="info-item-1">下一篇</div><div class="info-item-2">Go语言学习总结</div></div><div class="info-2"><div class="info-item-1">Go语言学习总结目录 一、Go语言基础 1. 安装与环境配置 2. Go语言核心概念 包与模块 基本数据类型 数据类型使用场景 复数类型详解 变量与常量 流程控制   3. 函数与方法 4. 结构体与接口 5. 并发编程 6. 通道详解 7. Context上下文   二、项目架构与设计模式 1. 分层架构 2. 仓储模式 3. 服务层 4. 配置管理 5. 中间件设计 6. 日志工具   三、Web应用开发 1. 路由设置 2. 控制器实现 3. 主程序入口   四、最佳实践与编码规范 1. 错误处理 2. 并发控制 3. 单元测试 4. 性能优化 5....</div></div></div></a></nav><hr class="custom-hr"/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div id="twikoo-wrap"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="/img/avatar.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">aoaYaoa</div><div class="author-info-description">个人博客，记录成长点滴...</div><div class="site-data"><a href="/archives/"><div class="headline">文章</div><div class="length-num">13</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">15</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">1</div></a></div><a id="card-info-btn" target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/aoaYaoa"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons"><a class="social-icon" href="https://github.com/aoaYaoa" rel="external nofollow noreferrer" target="_blank" title="GitHub"><i class="fab fa-github" style="color: #181717;"></i></a><a class="social-icon" href="https://twitter.com/yourname" rel="external nofollow noreferrer" target="_blank" title="Twitter"><i class="fab fa-twitter" style="color: #1DA1F2;"></i></a><a class="social-icon" href="mailto:skyeeq9@gmail.com" rel="external nofollow noreferrer" target="_blank" title="Email"><i class="fas fa-envelope" style="color: #EA4335;"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">算了，不知道写什么，就这样吧！</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Deno%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95-%F0%9F%93%98"><span class="toc-number">1.</span> <span class="toc-text">Deno学习记录 📘</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%F0%9F%93%8B-%E7%9B%AE%E5%BD%95"><span class="toc-number">1.1.</span> <span class="toc-text">📋 目录</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%80%E3%80%81Deno%E5%9F%BA%E7%A1%80%E6%8A%80%E6%9C%AF"><span class="toc-number">1.1.1.</span> <span class="toc-text">一、Deno基础技术</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8C%E3%80%81%E9%A1%B9%E7%9B%AE%E5%85%B7%E4%BD%93%E5%AE%9E%E7%8E%B0"><span class="toc-number">1.1.2.</span> <span class="toc-text">二、项目具体实现</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%89%E3%80%81%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5%E5%92%8C%E6%89%A9%E5%B1%95"><span class="toc-number">1.1.3.</span> <span class="toc-text">三、最佳实践和扩展</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%F0%9F%9A%80-%E9%A1%B9%E7%9B%AE%E6%A6%82%E8%BF%B0"><span class="toc-number">1.2.</span> <span class="toc-text">🚀 项目概述</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%F0%9F%92%BB-%E6%8A%80%E6%9C%AF%E6%A0%88"><span class="toc-number">1.3.</span> <span class="toc-text">💻 技术栈</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%F0%9F%9B%A0%EF%B8%8F-%E7%8E%AF%E5%A2%83%E5%87%86%E5%A4%87"><span class="toc-number">1.4.</span> <span class="toc-text">🛠️ 环境准备</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E5%AE%89%E8%A3%85Deno"><span class="toc-number">1.4.1.</span> <span class="toc-text">1. 安装Deno</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E5%AE%89%E8%A3%85MongoDB"><span class="toc-number">1.4.2.</span> <span class="toc-text">2. 安装MongoDB</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-%E6%9C%AC%E5%9C%B0%E5%AE%89%E8%A3%85MongoDB"><span class="toc-number">1.4.2.1.</span> <span class="toc-text">2.1 本地安装MongoDB</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-%E4%BD%BF%E7%94%A8Docker%E8%BF%90%E8%A1%8CMongoDB"><span class="toc-number">1.4.2.2.</span> <span class="toc-text">2.2 使用Docker运行MongoDB</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%F0%9F%A6%95-Deno%E5%9F%BA%E7%A1%80%E7%94%A8%E6%B3%95"><span class="toc-number">1.5.</span> <span class="toc-text">🦕 Deno基础用法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E2%9A%A1-%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4"><span class="toc-number">1.6.</span> <span class="toc-text">⚡ 常用命令</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E6%93%8D%E4%BD%9C"><span class="toc-number">1.6.1.</span> <span class="toc-text">文件操作</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AF%BB%E5%8F%96%E6%96%87%E4%BB%B6"><span class="toc-number">1.6.1.1.</span> <span class="toc-text">读取文件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%86%99%E5%85%A5%E6%96%87%E4%BB%B6"><span class="toc-number">1.6.1.2.</span> <span class="toc-text">写入文件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E6%93%8D%E4%BD%9C%E5%B7%A5%E5%85%B7%E5%87%BD%E6%95%B0"><span class="toc-number">1.6.1.3.</span> <span class="toc-text">文件操作工具函数</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%84%E7%90%86%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90"><span class="toc-number">1.6.2.</span> <span class="toc-text">处理静态资源</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8Web%E6%A0%87%E5%87%86API"><span class="toc-number">1.6.3.</span> <span class="toc-text">使用Web标准API</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8Web-Worker"><span class="toc-number">1.6.4.</span> <span class="toc-text">使用Web Worker</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%89%A7%E8%A1%8CShell%E5%91%BD%E4%BB%A4"><span class="toc-number">1.6.5.</span> <span class="toc-text">执行Shell命令</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8WebSocket"><span class="toc-number">1.6.6.</span> <span class="toc-text">使用WebSocket</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%F0%9F%94%90-%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F"><span class="toc-number">1.7.</span> <span class="toc-text">🔐 环境变量</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%F0%9F%9B%A1%EF%B8%8F-%E6%9D%83%E9%99%90%E7%AE%A1%E7%90%86"><span class="toc-number">1.8.</span> <span class="toc-text">🛡️ 权限管理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%F0%9F%93%A6-%E7%AC%AC%E4%B8%89%E6%96%B9%E5%BA%93%E5%92%8C%E4%BE%9D%E8%B5%96%E7%AE%A1%E7%90%86"><span class="toc-number">1.9.</span> <span class="toc-text">📦 第三方库和依赖管理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E7%AC%AC%E4%B8%89%E6%96%B9%E5%BA%93"><span class="toc-number">1.9.1.</span> <span class="toc-text">常用第三方库</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E9%AA%8C%E8%AF%81%E4%B8%8E%E5%AE%89%E5%85%A8%E7%9B%B8%E5%85%B3%E5%BA%93"><span class="toc-number">1.9.2.</span> <span class="toc-text">数据验证与安全相关库</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-AJV-%E5%92%8C-JSON-Schema"><span class="toc-number">1.9.2.1.</span> <span class="toc-text">1. AJV 和 JSON Schema</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-MD5"><span class="toc-number">1.9.2.2.</span> <span class="toc-text">2. MD5</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-JWT-JSON-Web-Token"><span class="toc-number">1.9.2.3.</span> <span class="toc-text">3. JWT (JSON Web Token)</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9E%E9%99%85%E5%BA%94%E7%94%A8%E7%A4%BA%E4%BE%8B"><span class="toc-number">1.9.3.</span> <span class="toc-text">实际应用示例</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#JSON-Schema%E7%94%A8%E4%BA%8EAPI%E9%AA%8C%E8%AF%81"><span class="toc-number">1.9.3.1.</span> <span class="toc-text">JSON Schema用于API验证</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#MD5%E7%94%A8%E4%BA%8E%E7%94%9F%E6%88%90%E5%94%AF%E4%B8%80%E6%A0%87%E8%AF%86%E7%AC%A6"><span class="toc-number">1.9.3.2.</span> <span class="toc-text">MD5用于生成唯一标识符</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#JSR-Deno%E5%8C%85%E6%B3%A8%E5%86%8C%E8%A1%A8"><span class="toc-number">1.9.4.</span> <span class="toc-text">JSR (Deno包注册表)</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9C%A8%E9%A1%B9%E7%9B%AE%E4%B8%AD%E4%BD%BF%E7%94%A8JSR"><span class="toc-number">1.9.4.1.</span> <span class="toc-text">在项目中使用JSR</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#NPM%E6%94%AF%E6%8C%81"><span class="toc-number">1.9.5.</span> <span class="toc-text">NPM支持</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9C%A8%E9%A1%B9%E7%9B%AE%E4%B8%AD%E4%BD%BF%E7%94%A8NPM%E5%8C%85"><span class="toc-number">1.9.5.1.</span> <span class="toc-text">在项目中使用NPM包</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%B6%E4%BB%96%E6%BA%90%E5%AF%BC%E5%85%A5"><span class="toc-number">1.9.6.</span> <span class="toc-text">其他源导入</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8C%85%E7%89%88%E6%9C%AC%E7%AE%A1%E7%90%86"><span class="toc-number">1.9.7.</span> <span class="toc-text">包版本管理</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%F0%9F%93%81-%E9%A1%B9%E7%9B%AE%E7%BB%93%E6%9E%84"><span class="toc-number">1.10.</span> <span class="toc-text">📁 项目结构</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%F0%9F%94%8C-API%E8%B7%AF%E7%94%B1"><span class="toc-number">1.11.</span> <span class="toc-text">🔌 API路由</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#MBTI%E6%B5%8B%E8%AF%95API"><span class="toc-number">1.11.1.</span> <span class="toc-text">MBTI测试API</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%F0%9F%93%8A-%E6%95%B0%E6%8D%AE%E6%A8%A1%E5%9E%8B"><span class="toc-number">1.12.</span> <span class="toc-text">📊 数据模型</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#MBTI%E7%9B%B8%E5%85%B3%E6%A8%A1%E5%9E%8B"><span class="toc-number">1.12.1.</span> <span class="toc-text">MBTI相关模型</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%F0%9F%A7%A9-MBTI%E6%B5%8B%E8%AF%95%E5%AE%9E%E7%8E%B0%E7%BB%86%E8%8A%82"><span class="toc-number">1.13.</span> <span class="toc-text">🧩 MBTI测试实现细节</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E6%B5%8B%E8%AF%95%E6%B5%81%E7%A8%8B"><span class="toc-number">1.13.1.</span> <span class="toc-text">1. 测试流程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E7%BB%93%E6%9E%9C%E8%AE%A1%E7%AE%97%E9%80%BB%E8%BE%91"><span class="toc-number">1.13.2.</span> <span class="toc-text">2. 结果计算逻辑</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E6%95%B0%E6%8D%AE%E5%BA%93%E9%9B%86%E5%90%88"><span class="toc-number">1.13.3.</span> <span class="toc-text">3. 数据库集合</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%F0%9F%97%84%EF%B8%8F-MongoDB%E6%95%B0%E6%8D%AE%E5%BA%93%E6%93%8D%E4%BD%9C"><span class="toc-number">1.14.</span> <span class="toc-text">🗄️ MongoDB数据库操作</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%9E%E6%8E%A5%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-number">1.14.1.</span> <span class="toc-text">连接数据库</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%BA%E6%9C%ACCRUD%E6%93%8D%E4%BD%9C"><span class="toc-number">1.14.2.</span> <span class="toc-text">基本CRUD操作</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#MBTI%E5%AE%9E%E9%99%85%E6%95%B0%E6%8D%AE%E5%BA%93%E6%93%8D%E4%BD%9C%E7%A4%BA%E4%BE%8B"><span class="toc-number">1.14.3.</span> <span class="toc-text">MBTI实际数据库操作示例</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%86%E9%A1%B5%E6%9F%A5%E8%AF%A2"><span class="toc-number">1.14.4.</span> <span class="toc-text">分页查询</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%BF%94%E5%9B%9E%E7%BB%93%E6%9E%9C%E6%A0%BC%E5%BC%8F"><span class="toc-number">1.14.4.1.</span> <span class="toc-text">返回结果格式</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%F0%9F%A7%B0-MongoDB%E6%9F%A5%E8%AF%A2%E8%AF%AD%E6%B3%95"><span class="toc-number">1.15.</span> <span class="toc-text">🧰 MongoDB查询语法</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E6%93%8D%E4%BD%9C%E7%AC%A6"><span class="toc-number">1.15.1.</span> <span class="toc-text">常用操作符</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9B%B4%E6%96%B0%E6%93%8D%E4%BD%9C%E7%AC%A6"><span class="toc-number">1.15.2.</span> <span class="toc-text">更新操作符</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%F0%9F%93%9D-%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9%E5%92%8C%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5"><span class="toc-number">1.16.</span> <span class="toc-text">📝 注意事项和最佳实践</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E8%BF%9E%E6%8E%A5%E7%AE%A1%E7%90%86"><span class="toc-number">1.16.1.</span> <span class="toc-text">数据库连接管理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86%E5%92%8C%E6%97%A5%E5%BF%97"><span class="toc-number">1.16.2.</span> <span class="toc-text">错误处理和日志</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#MongoDB%E6%93%8D%E4%BD%9C"><span class="toc-number">1.16.3.</span> <span class="toc-text">MongoDB操作</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E5%85%A8%E6%80%A7"><span class="toc-number">1.16.4.</span> <span class="toc-text">安全性</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96"><span class="toc-number">1.16.5.</span> <span class="toc-text">性能优化</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%89%B9%E5%AE%9A%E9%A1%B9%E7%9B%AE%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9"><span class="toc-number">1.16.6.</span> <span class="toc-text">特定项目注意事项</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#API%E5%93%8D%E5%BA%94%E6%A0%BC%E5%BC%8F%E8%AE%BE%E8%AE%A1"><span class="toc-number">1.16.7.</span> <span class="toc-text">API响应格式设计</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%89%8D%E7%AB%AF%E5%AE%9E%E7%8E%B0%E5%BB%BA%E8%AE%AE"><span class="toc-number">1.16.8.</span> <span class="toc-text">前端实现建议</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%94%A8%E6%88%B7%E4%BD%93%E9%AA%8C%E4%BC%98%E5%8C%96%E5%BB%BA%E8%AE%AE"><span class="toc-number">1.16.9.</span> <span class="toc-text">用户体验优化建议</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E2%9D%93-%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98%E6%8E%92%E6%9F%A5"><span class="toc-number">1.17.</span> <span class="toc-text">❓ 常见问题排查</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#MongoDB%E8%BF%9E%E6%8E%A5%E9%97%AE%E9%A2%98"><span class="toc-number">1.17.1.</span> <span class="toc-text">MongoDB连接问题</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#API%E8%BF%94%E5%9B%9E%E7%A9%BA%E6%95%B0%E6%8D%AE"><span class="toc-number">1.17.2.</span> <span class="toc-text">API返回空数据</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9D%83%E9%99%90%E9%97%AE%E9%A2%98"><span class="toc-number">1.17.3.</span> <span class="toc-text">权限问题</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%83%A8%E7%BD%B2%E7%9B%B8%E5%85%B3%E9%97%AE%E9%A2%98"><span class="toc-number">1.17.4.</span> <span class="toc-text">部署相关问题</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%F0%9F%9A%80-%E6%89%A9%E5%B1%95%E5%92%8C%E6%94%B9%E8%BF%9B"><span class="toc-number">1.18.</span> <span class="toc-text">🚀 扩展和改进</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%F0%9F%9A%A2-Deno%E9%83%A8%E7%BD%B2%E6%8C%87%E5%8D%97"><span class="toc-number">1.19.</span> <span class="toc-text">🚢 Deno部署指南</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8Deno-Deploy"><span class="toc-number">1.19.1.</span> <span class="toc-text">使用Deno Deploy</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E4%BD%BF%E7%94%A8deployctl%E5%B7%A5%E5%85%B7"><span class="toc-number">1.19.1.1.</span> <span class="toc-text">1. 使用deployctl工具</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E9%83%A8%E7%BD%B2%E9%A1%B9%E7%9B%AE"><span class="toc-number">1.19.1.2.</span> <span class="toc-text">2. 部署项目</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-%E9%80%9A%E8%BF%87deno-json%E9%85%8D%E7%BD%AE"><span class="toc-number">1.19.1.3.</span> <span class="toc-text">3. 通过deno.json配置</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%83%A8%E7%BD%B2%E5%89%8D%E7%9A%84%E5%87%86%E5%A4%87"><span class="toc-number">1.19.2.</span> <span class="toc-text">部署前的准备</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9%E5%92%8C%E9%99%90%E5%88%B6"><span class="toc-number">1.19.3.</span> <span class="toc-text">注意事项和限制</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%83%A8%E7%BD%B2%E5%90%8E%E7%9A%84%E7%9B%91%E6%8E%A7"><span class="toc-number">1.19.4.</span> <span class="toc-text">部署后的监控</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%F0%9F%93%90-%E4%BB%A3%E7%A0%81%E8%A7%84%E8%8C%83"><span class="toc-number">1.20.</span> <span class="toc-text">📐 代码规范</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%F0%9F%93%9A-%E8%B5%84%E6%BA%90%E9%93%BE%E6%8E%A5"><span class="toc-number">1.21.</span> <span class="toc-text">📚 资源链接</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2025/07/31/babylonjs/" title="BabylonJS"><img src="/img/babylonjs.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="BabylonJS"/></a><div class="content"><a class="title" href="/2025/07/31/babylonjs/" title="BabylonJS">BabylonJS</a><time datetime="2025-07-30T16:00:00.000Z" title="发表于 2025-07-31 00:00:00">2025-07-31</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/07/31/cesium/" title="Cesium 开发文档"><img src="/img/cesium.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Cesium 开发文档"/></a><div class="content"><a class="title" href="/2025/07/31/cesium/" title="Cesium 开发文档">Cesium 开发文档</a><time datetime="2025-07-30T16:00:00.000Z" title="发表于 2025-07-31 00:00:00">2025-07-31</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/07/31/mars3d/" title="mars3D 开发文档"><img src="/img/mars3d.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="mars3D 开发文档"/></a><div class="content"><a class="title" href="/2025/07/31/mars3d/" title="mars3D 开发文档">mars3D 开发文档</a><time datetime="2025-07-30T16:00:00.000Z" title="发表于 2025-07-31 00:00:00">2025-07-31</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/04/25/Go%E8%AF%AD%E8%A8%80%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/" title="Go语言学习总结"><img src="/img/go.jpeg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Go语言学习总结"/></a><div class="content"><a class="title" href="/2025/04/25/Go%E8%AF%AD%E8%A8%80%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/" title="Go语言学习总结">Go语言学习总结</a><time datetime="2025-04-24T16:00:00.000Z" title="发表于 2025-04-25 00:00:00">2025-04-25</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/04/15/deno%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/" title="Deno学习记录"><img src="/img/deno.jpeg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Deno学习记录"/></a><div class="content"><a class="title" href="/2025/04/15/deno%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/" title="Deno学习记录">Deno学习记录</a><time datetime="2025-04-14T16:00:00.000Z" title="发表于 2025-04-15 00:00:00">2025-04-15</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2019 - 2025 By aoaYaoa</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener external nofollow noreferrer" href="https://hexo.io">Hexo 7.3.0</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly 5.3.4</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="日间和夜间模式切换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="前往评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js"></script><div class="js-pjax"><script>(() => {
  const isShuoshuo = GLOBAL_CONFIG_SITE.pageType === 'shuoshuo'
  const option = null

  const getCount = () => {
    const countELement = document.getElementById('twikoo-count')
    if(!countELement) return
    twikoo.getCommentsCount({
      envId: 'https://twikoogo.netlify.app/.netlify/functions/twikoo',
      region: '',
      urls: [window.location.pathname],
      includeReply: false
    }).then(res => {
      countELement.textContent = res[0].count
    }).catch(err => {
      console.error(err)
    })
  }

  const init = (el = document, path = location.pathname) => {
    twikoo.init({
      el: el.querySelector('#twikoo-wrap'),
      envId: 'https://twikoogo.netlify.app/.netlify/functions/twikoo',
      region: '',
      onCommentLoaded: () => {
        btf.loadLightbox(document.querySelectorAll('#twikoo .tk-content img:not(.tk-owo-emotion)'))
      },
      ...option,
      path: isShuoshuo ? path : (option && option.path) || path
    })

    

    isShuoshuo && (window.shuoshuoComment.destroyTwikoo = () => {
      if (el.children.length) {
        el.innerHTML = ''
        el.classList.add('no-comment')
      }
    })
  }

  const loadTwikoo = (el, path) => {
    if (typeof twikoo === 'object') setTimeout(() => init(el, path), 0)
    else btf.getScript('https://cdn.jsdelivr.net/npm/twikoo/dist/twikoo.all.min.js').then(() => init(el, path))
  }

  if (isShuoshuo) {
    'Twikoo' === 'Twikoo'
      ? window.shuoshuoComment = { loadComment: loadTwikoo }
      : window.loadOtherComment = loadTwikoo
    return
  }

  if ('Twikoo' === 'Twikoo' || !false) {
    if (false) btf.loadComment(document.getElementById('twikoo-wrap'), loadTwikoo)
    else loadTwikoo()
  } else {
    window.loadOtherComment = loadTwikoo
  }
})()</script></div><div class="aplayer no-destroy" data-id="13528716738" data-server="netease" data-type="playlist" data-fixed="true" data-autoplay="true"> </div><canvas class="fireworks" mobile="false"></canvas><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/fireworks.min.js"></script><script id="click-show-text" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/click-show-text.min.js" data-mobile="false" data-text="富强,民主,文明,和谐,自由,平等,公正,法治,爱国,敬业,诚信,友善" data-fontsize="15px" data-random="true" async="async"></script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/metingjs/dist/Meting.min.js"></script><script>(() => {
  const destroyAplayer = () => {
    if (window.aplayers) {
      for (let i = 0; i < window.aplayers.length; i++) {
        if (!window.aplayers[i].options.fixed) {
          window.aplayers[i].destroy()
        }
      }
    }
  }

  const runMetingJS = () => {
    typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()
  }

  btf.addGlobalFn('pjaxSend', destroyAplayer, 'destroyAplayer')
  btf.addGlobalFn('pjaxComplete', loadMeting, 'runMetingJS')
})()</script><script src="https://cdn.jsdelivr.net/npm/pjax/pjax.min.js"></script><script>(() => {
  const pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]

  window.pjax = new Pjax({
    elements: 'a:not([target="_blank"])',
    selectors: pjaxSelectors,
    cacheBust: false,
    analytics: false,
    scrollRestoration: false
  })

  const triggerPjaxFn = (val) => {
    if (!val) return
    Object.values(val).forEach(fn => fn())
  }

  document.addEventListener('pjax:send', () => {
    // removeEventListener
    btf.removeGlobalFnEvent('pjaxSendOnce')
    btf.removeGlobalFnEvent('themeChange')

    // reset readmode
    const $bodyClassList = document.body.classList
    if ($bodyClassList.contains('read-mode')) $bodyClassList.remove('read-mode')

    triggerPjaxFn(window.globalFn.pjaxSend)
  })

  document.addEventListener('pjax:complete', () => {
    btf.removeGlobalFnEvent('pjaxCompleteOnce')
    document.querySelectorAll('script[data-pjax]').forEach(item => {
      const newScript = document.createElement('script')
      const content = item.text || item.textContent || item.innerHTML || ""
      Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
      newScript.appendChild(document.createTextNode(content))
      item.parentNode.replaceChild(newScript, item)
    })

    triggerPjaxFn(window.globalFn.pjaxComplete)
  })

  document.addEventListener('pjax:error', e => {
    if (e.request.status === 404) {
      const usePjax = true
      true 
        ? (usePjax ? pjax.loadUrl('/404.html') : window.location.href = '/404.html')
        : window.location.href = e.request.responseURL
    }
  })
})()</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="text-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章..." type="text"/></div></div><hr/><div id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js"></script></div></div></body></html>