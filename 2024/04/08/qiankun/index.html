<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>Qiankun 微前端的使用 | aoaYaoa</title><meta name="author" content="aoaYaoa"><meta name="copyright" content="aoaYaoa"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="Qiankun 微前端企业级实践指南目录 基础配置 通信方案 路由管理 样式隔离 性能优化 问题解决方案 最佳实践 子应用间跳转与传值 常见问题解决方案 总结与展望 子应用优化策略   一、基础配置1.1 主应用初始化12345678910111213141516171819202122232425&#x2F;&#x2F; main-app.jsimport &#123; registerMicroApps, sta">
<meta property="og:type" content="article">
<meta property="og:title" content="Qiankun 微前端的使用">
<meta property="og:url" content="https://aoayaoa.github.io/2024/04/08/qiankun/index.html">
<meta property="og:site_name" content="aoaYaoa">
<meta property="og:description" content="Qiankun 微前端企业级实践指南目录 基础配置 通信方案 路由管理 样式隔离 性能优化 问题解决方案 最佳实践 子应用间跳转与传值 常见问题解决方案 总结与展望 子应用优化策略   一、基础配置1.1 主应用初始化12345678910111213141516171819202122232425&#x2F;&#x2F; main-app.jsimport &#123; registerMicroApps, sta">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://aoayaoa.github.io/img/qiankun.jpg">
<meta property="article:published_time" content="2024-04-07T16:00:00.000Z">
<meta property="article:modified_time" content="2025-03-07T03:59:53.389Z">
<meta property="article:author" content="aoaYaoa">
<meta property="article:tag" content="入门">
<meta property="article:tag" content="Hexo">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://aoayaoa.github.io/img/qiankun.jpg"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Qiankun 微前端的使用",
  "url": "https://aoayaoa.github.io/2024/04/08/qiankun/",
  "image": "https://aoayaoa.github.io/img/qiankun.jpg",
  "datePublished": "2024-04-07T16:00:00.000Z",
  "dateModified": "2025-03-07T03:59:53.389Z",
  "author": [
    {
      "@type": "Person",
      "name": "aoaYaoa",
      "url": "https://aoayaoa.github.io/"
    }
  ]
}</script><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://aoayaoa.github.io/2024/04/08/qiankun/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!true && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', 'undefined')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', 'undefined')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"top_n_per_article":1,"unescape":false,"languages":{"hits_empty":"未找到符合您查询的内容：${query}","hits_stats":"共找到 ${hits} 篇文章"}},
  translate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":false},
  copy: {
    success: '复制成功',
    error: '复制失败',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"limitCount":150,"languages":{"author":"作者: aoaYaoa","link":"链接: ","source":"来源: aoaYaoa","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},
  lightbox: 'null',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: true,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Qiankun 微前端的使用',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><link rel="stylesheet" href="/css/base.css"><script src="/js/resources.js"></script><link rel="alternate" href="/atom.xml" title="aoaYaoa" type="application/atom+xml">
</head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="/img/avatar.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">10</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">10</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">1</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-book-open"></i><span> 文章</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-calendar-alt"></i><span> 日常</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/shuoshuo/"><i class="fa-fw fas fa-comment-dots"></i><span> 说说</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/resources/"><i class="fa-fw fas fa-compass"></i><span> 资源</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-user"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg fixed" id="page-header" style="background-image: url(/img/qiankun.jpg);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><img class="site-icon" src="/img/avatar.jpg" alt="Logo"><span class="site-name">aoaYaoa</span></a><a class="nav-page-title" href="/"><span class="site-name">Qiankun 微前端的使用</span></a></span><div id="menus"><div id="search-button"><span class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></span></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-book-open"></i><span> 文章</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-calendar-alt"></i><span> 日常</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/shuoshuo/"><i class="fa-fw fas fa-comment-dots"></i><span> 说说</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/resources/"><i class="fa-fw fas fa-compass"></i><span> 资源</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-user"></i><span> 关于</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">Qiankun 微前端的使用</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2024-04-07T16:00:00.000Z" title="发表于 2024-04-08 00:00:00">2024-04-08</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2025-03-07T03:59:53.389Z" title="更新于 2025-03-07 11:59:53">2025-03-07</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E6%95%99%E7%A8%8B/">教程</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">总字数:</span><span class="word-count">3.6k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>17分钟</span></span><span class="post-meta-separator">|</span><span id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">浏览量:</span><span id="twikoo_visitors"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><h1 id="Qiankun-微前端企业级实践指南"><a href="#Qiankun-微前端企业级实践指南" class="headerlink" title="Qiankun 微前端企业级实践指南"></a>Qiankun 微前端企业级实践指南</h1><h2 id="目录"><a href="#目录" class="headerlink" title="目录"></a>目录</h2><ol>
<li><a href="#%E4%B8%80%E5%9F%BA%E7%A1%80%E9%85%8D%E7%BD%AE">基础配置</a></li>
<li><a href="#%E4%BA%8C%E9%80%9A%E4%BF%A1%E6%96%B9%E6%A1%88">通信方案</a></li>
<li><a href="#%E4%B8%89%E8%B7%AF%E7%94%B1%E7%AE%A1%E7%90%86">路由管理</a></li>
<li><a href="#%E5%9B%9B%E6%A0%B7%E5%BC%8F%E9%9A%94%E7%A6%BB">样式隔离</a></li>
<li><a href="#%E4%BA%94%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96">性能优化</a></li>
<li><a href="#%E5%85%AD%E9%97%AE%E9%A2%98%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88">问题解决方案</a></li>
<li><a href="#%E4%B8%83%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5">最佳实践</a></li>
<li><a href="#%E5%85%AB%E5%AD%90%E5%BA%94%E7%94%A8%E9%97%B4%E8%B7%B3%E8%BD%AC%E4%B8%8E%E4%BC%A0%E5%80%BC">子应用间跳转与传值</a></li>
<li><a href="#%E4%B9%9D%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88">常见问题解决方案</a></li>
<li><a href="#%E5%8D%81%E6%80%BB%E7%BB%93%E4%B8%8E%E5%B1%95%E6%9C%9B">总结与展望</a></li>
<li><a href="#%E5%8D%81%E4%B8%80%E5%AD%90%E5%BA%94%E7%94%A8%E4%BC%98%E5%8C%96%E7%AD%96%E7%95%A5">子应用优化策略</a></li>
</ol>
<p><a id="一基础配置"></a></p>
<h2 id="一、基础配置"><a href="#一、基础配置" class="headerlink" title="一、基础配置"></a>一、基础配置</h2><h3 id="1-1-主应用初始化"><a href="#1-1-主应用初始化" class="headerlink" title="1.1 主应用初始化"></a>1.1 主应用初始化</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// main-app.js</span></span><br><span class="line"><span class="keyword">import</span> &#123; registerMicroApps, start &#125; <span class="keyword">from</span> <span class="string">&#x27;qiankun&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> apps = [</span><br><span class="line">&#123;</span><br><span class="line"><span class="attr">name</span>: <span class="string">&#x27;sub-app&#x27;</span>,</span><br><span class="line"><span class="attr">entry</span>: process.<span class="property">env</span>.<span class="property">NODE_ENV</span> === <span class="string">&#x27;development&#x27;</span></span><br><span class="line">? <span class="string">&#x27;//localhost:7100&#x27;</span></span><br><span class="line">: <span class="string">&#x27;/sub-app/&#x27;</span>,</span><br><span class="line"><span class="attr">container</span>: <span class="string">&#x27;#subContainer&#x27;</span>,</span><br><span class="line"><span class="attr">activeRule</span>: <span class="string">&#x27;/sub&#x27;</span>,</span><br><span class="line"><span class="attr">props</span>: &#123;</span><br><span class="line"><span class="attr">basePath</span>: <span class="string">&#x27;/main-app/sub&#x27;</span>,</span><br><span class="line"><span class="attr">mainToken</span>: <span class="variable language_">localStorage</span>.<span class="title function_">getItem</span>(<span class="string">&#x27;token&#x27;</span>)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">];</span><br><span class="line"><span class="title function_">registerMicroApps</span>(apps);</span><br><span class="line"><span class="title function_">start</span>(&#123;</span><br><span class="line"><span class="attr">sandbox</span>: &#123;</span><br><span class="line"><span class="attr">strictStyleIsolation</span>: <span class="literal">true</span>,</span><br><span class="line"><span class="attr">experimentalStyleIsolation</span>: <span class="literal">true</span>,</span><br><span class="line"><span class="attr">speedy</span>: <span class="literal">false</span></span><br><span class="line">&#125;,</span><br><span class="line"><span class="attr">prefetch</span>: <span class="string">&#x27;all&#x27;</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="1-2-子应用接入规范"><a href="#1-2-子应用接入规范" class="headerlink" title="1.2 子应用接入规范"></a>1.2 子应用接入规范</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// sub-app.js</span></span><br><span class="line"><span class="keyword">let</span> vueInstance = <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">bootstrap</span>(<span class="params"></span>) &#123;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;[SubApp] Bootstrap&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">mount</span>(<span class="params">props</span>) &#123;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;[SubApp] Mount&#x27;</span>, props);</span><br><span class="line">vueInstance = <span class="title function_">createApp</span>(&#123;</span><br><span class="line"><span class="attr">router</span>: <span class="title function_">createRouter</span>(&#123;</span><br><span class="line"><span class="attr">history</span>: <span class="title function_">createWebHistory</span>(props.<span class="property">basePath</span>),</span><br><span class="line"><span class="attr">routes</span>: [</span><br><span class="line">&#123; <span class="attr">path</span>: <span class="string">&#x27;/page1&#x27;</span>, <span class="attr">component</span>: <span class="title class_">Page1</span> &#125;,</span><br><span class="line">&#123; <span class="attr">path</span>: <span class="string">&#x27;/page2&#x27;</span>, <span class="attr">component</span>: <span class="title class_">Page2</span> &#125;</span><br><span class="line">]</span><br><span class="line">&#125;)</span><br><span class="line">&#125;).<span class="title function_">mount</span>(props.<span class="property">container</span>.<span class="title function_">querySelector</span>(<span class="string">&#x27;#app&#x27;</span>));</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">unmount</span>(<span class="params"></span>) &#123;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;[SubApp] Unmount&#x27;</span>);</span><br><span class="line">vueInstance.$destroy();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><a id="二通信方案"></a></p>
<h2 id="二、通信方案"><a href="#二、通信方案" class="headerlink" title="二、通信方案"></a>二、通信方案</h2><h3 id="2-1-全局状态管理"><a href="#2-1-全局状态管理" class="headerlink" title="2.1 全局状态管理"></a>2.1 全局状态管理</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 主应用状态初始化</span></span><br><span class="line"><span class="keyword">const</span> actions = <span class="title function_">initGlobalState</span>(&#123;</span><br><span class="line"><span class="attr">user</span>: <span class="title class_">JSON</span>.<span class="title function_">parse</span>(<span class="variable language_">localStorage</span>.<span class="title function_">getItem</span>(<span class="string">&#x27;user&#x27;</span>)),</span><br><span class="line"><span class="attr">token</span>: &#123;</span><br><span class="line"><span class="attr">value</span>: <span class="variable language_">localStorage</span>.<span class="title function_">getItem</span>(<span class="string">&#x27;token&#x27;</span>),</span><br><span class="line"><span class="attr">expire</span>: <span class="title class_">Date</span>.<span class="title function_">now</span>() + <span class="number">3600000</span></span><br><span class="line">&#125;,</span><br><span class="line"><span class="attr">systemTime</span>: <span class="title class_">Date</span>.<span class="title function_">now</span>()</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// 子应用状态同步</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">mount</span>(<span class="params">props</span>) &#123;</span><br><span class="line"><span class="comment">// 初始化同步</span></span><br><span class="line"><span class="variable language_">localStorage</span>.<span class="title function_">setItem</span>(<span class="string">&#x27;token&#x27;</span>, props.<span class="title function_">getGlobalState</span>().<span class="property">token</span>.<span class="property">value</span>);</span><br><span class="line"><span class="comment">// 动态更新</span></span><br><span class="line">props.<span class="title function_">onGlobalStateChange</span>(<span class="function">(<span class="params">state, prev</span>) =&gt;</span> &#123;</span><br><span class="line"><span class="keyword">if</span> (state.<span class="property">token</span>.<span class="property">expire</span> !== prev.<span class="property">token</span>.<span class="property">expire</span>) &#123;</span><br><span class="line"><span class="variable language_">localStorage</span>.<span class="title function_">setItem</span>(<span class="string">&#x27;token_expire&#x27;</span>, state.<span class="property">token</span>.<span class="property">expire</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;, <span class="literal">true</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="2-2-跨应用事件总线"><a href="#2-2-跨应用事件总线" class="headerlink" title="2.2 跨应用事件总线"></a>2.2 跨应用事件总线</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// event-bus.js</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CrossAppEvent</span> &#123;</span><br><span class="line"><span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line"><span class="variable language_">this</span>.<span class="property">events</span> = <span class="keyword">new</span> <span class="title class_">Map</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">on</span>(<span class="params">eventName, callback</span>) &#123;</span><br><span class="line"><span class="keyword">const</span> handlers = <span class="variable language_">this</span>.<span class="property">events</span>.<span class="title function_">get</span>(eventName) || [];</span><br><span class="line">handlers.<span class="title function_">push</span>(callback);</span><br><span class="line"><span class="variable language_">this</span>.<span class="property">events</span>.<span class="title function_">set</span>(eventName, handlers);</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">emit</span>(<span class="params">eventName, payload</span>) &#123;</span><br><span class="line"><span class="keyword">const</span> handlers = <span class="variable language_">this</span>.<span class="property">events</span>.<span class="title function_">get</span>(eventName) || [];</span><br><span class="line">handlers.<span class="title function_">forEach</span>(<span class="function"><span class="params">handler</span> =&gt;</span> <span class="title function_">handler</span>(payload));</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 主应用初始化</span></span><br><span class="line"><span class="keyword">const</span> eventBus = <span class="keyword">new</span> <span class="title class_">CrossAppEvent</span>();</span><br><span class="line"><span class="comment">// 子应用A发送事件</span></span><br><span class="line">eventBus.<span class="title function_">emit</span>(<span class="string">&#x27;ORDER_CREATED&#x27;</span>, &#123; <span class="attr">orderId</span>: <span class="number">12345</span> &#125;);</span><br><span class="line"><span class="comment">// 子应用B监听事件</span></span><br><span class="line">eventBus.<span class="title function_">on</span>(<span class="string">&#x27;ORDER_CREATED&#x27;</span>, <span class="function">(<span class="params">payload</span>) =&gt;</span> &#123;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;收到订单创建事件:&#x27;</span>, payload);</span><br><span class="line"><span class="title function_">refreshOrderList</span>();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p><a id="三路由管理"></a></p>
<h2 id="三、路由管理"><a href="#三、路由管理" class="headerlink" title="三、路由管理"></a>三、路由管理</h2><h3 id="3-1-路由配置规范"><a href="#3-1-路由配置规范" class="headerlink" title="3.1 路由配置规范"></a>3.1 路由配置规范</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 子应用路由守卫</span></span><br><span class="line">router.<span class="title function_">beforeEach</span>(<span class="function">(<span class="params">to, <span class="keyword">from</span>, next</span>) =&gt;</span> &#123;</span><br><span class="line"><span class="keyword">if</span> (<span class="variable language_">window</span>.<span class="property">__POWERED_BY_QIANKUN__</span>) &#123;</span><br><span class="line"><span class="comment">// 验证路由合法性</span></span><br><span class="line"><span class="keyword">const</span> validPaths = [<span class="string">&#x27;/page1&#x27;</span>, <span class="string">&#x27;/page2&#x27;</span>, <span class="string">&#x27;/detail&#x27;</span>];</span><br><span class="line"><span class="keyword">const</span> isValid = validPaths.<span class="title function_">some</span>(<span class="function"><span class="params">path</span> =&gt;</span> to.<span class="property">path</span>.<span class="title function_">startsWith</span>(path));</span><br><span class="line"><span class="comment">// 验证Token有效性</span></span><br><span class="line"><span class="keyword">const</span> isAuthenticated = <span class="title function_">checkToken</span>(<span class="variable language_">localStorage</span>.<span class="title function_">getItem</span>(<span class="string">&#x27;token&#x27;</span>));</span><br><span class="line"><span class="keyword">if</span> (!isValid || !isAuthenticated) &#123;</span><br><span class="line"><span class="title function_">next</span>(<span class="string">&#x27;/error&#x27;</span>);</span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">next</span>();</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 主应用路由跳转封装</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">microAppNavigate</span> = (<span class="params">appName, path</span>) =&gt; &#123;</span><br><span class="line"><span class="keyword">const</span> appConfig = qiankunApps.<span class="title function_">find</span>(<span class="function"><span class="params">app</span> =&gt;</span> app.<span class="property">name</span> === appName);</span><br><span class="line"><span class="keyword">if</span> (appConfig) &#123;</span><br><span class="line">router.<span class="title function_">push</span>(<span class="string">`<span class="subst">$&#123;appConfig.activeRule&#125;</span><span class="subst">$&#123;path&#125;</span>`</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">`未找到应用 <span class="subst">$&#123;appName&#125;</span> 的配置`</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// 使用示例</span></span><br><span class="line"><span class="title function_">microAppNavigate</span>(<span class="string">&#x27;sub-app&#x27;</span>, <span class="string">&#x27;/page1&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p><a id="四样式隔离"></a></p>
<h2 id="四、样式隔离"><a href="#四、样式隔离" class="headerlink" title="四、样式隔离"></a>四、样式隔离</h2><h3 id="4-1-组件库解决方案"><a href="#4-1-组件库解决方案" class="headerlink" title="4.1 组件库解决方案"></a>4.1 组件库解决方案</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- Element UI 组件 --&gt;</span><br><span class="line">&lt;el-date-picker</span><br><span class="line">:popper-append-to-body=&quot;false&quot;</span><br><span class="line">popper-class=&quot;micro-app-picker&quot;</span><br><span class="line">/&gt;</span><br><span class="line">&lt;!-- Ant Design 组件 --&gt;</span><br><span class="line">&lt;a-select</span><br><span class="line">:getPopupContainer=&quot;trigger =&gt; trigger.parentElement&quot;</span><br><span class="line">popupClassName=&quot;micro-app-select&quot;</span><br><span class="line">/&gt;</span><br></pre></td></tr></table></figure>

<h3 id="4-2-全局样式策略"><a href="#4-2-全局样式策略" class="headerlink" title="4.2 全局样式策略"></a>4.2 全局样式策略</h3><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* 微应用容器样式隔离 */</span></span><br><span class="line"><span class="selector-id">#sub-container</span> &#123;</span><br><span class="line"><span class="attribute">all</span>: initial; <span class="comment">/* 重置继承样式 */</span></span><br><span class="line"><span class="comment">/* 限制样式作用域 */</span></span><br><span class="line">* &#123;</span><br><span class="line"><span class="attribute">box-sizing</span>: border-box;</span><br><span class="line"><span class="attribute">font-family</span>: inherit;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* 弹出层样式重置 */</span></span><br><span class="line"><span class="selector-class">.micro-app-picker</span> &#123;</span><br><span class="line"><span class="attribute">z-index</span>: <span class="number">1000</span> <span class="meta">!important</span>;</span><br><span class="line"><span class="attribute">position</span>: absolute <span class="meta">!important</span>;</span><br><span class="line"><span class="selector-class">.el-picker__popper</span> &#123;</span><br><span class="line"><span class="attribute">transform</span>: none <span class="meta">!important</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><a id="五性能优化"></a></p>
<h2 id="五、性能优化"><a href="#五、性能优化" class="headerlink" title="五、性能优化"></a>五、性能优化</h2><h3 id="5-1-资源加载策略"><a href="#5-1-资源加载策略" class="headerlink" title="5.1 资源加载策略"></a>5.1 资源加载策略</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 按需加载配置</span></span><br><span class="line"><span class="title function_">start</span>(&#123;</span><br><span class="line"><span class="attr">prefetch</span>: <span class="function">(<span class="params">apps</span>) =&gt;</span> &#123;</span><br><span class="line"><span class="keyword">const</span> hotApps = [<span class="string">&#x27;dashboard&#x27;</span>, <span class="string">&#x27;monitor&#x27;</span>];</span><br><span class="line"><span class="keyword">return</span> apps.<span class="title function_">filter</span>(<span class="function"><span class="params">app</span> =&gt;</span> hotApps.<span class="title function_">includes</span>(app.<span class="property">name</span>));</span><br><span class="line">&#125;,</span><br><span class="line"><span class="attr">sandbox</span>: &#123;</span><br><span class="line"><span class="attr">experimentalStyleIsolation</span>: <span class="literal">true</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="5-2-内存优化方案"><a href="#5-2-内存优化方案" class="headerlink" title="5.2 内存优化方案"></a>5.2 内存优化方案</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 子应用卸载处理</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">unmount</span>(<span class="params"></span>) &#123;</span><br><span class="line"><span class="comment">// 清理事件监听</span></span><br><span class="line">eventBus.<span class="title function_">offAll</span>();</span><br><span class="line"><span class="comment">// 释放内存</span></span><br><span class="line">vueInstance.$destroy();</span><br><span class="line">vueInstance = <span class="literal">null</span>;</span><br><span class="line"><span class="comment">// 清理全局状态</span></span><br><span class="line">actions.<span class="title function_">offGlobalStateChange</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><a id="六问题解决方案"></a></p>
<h2 id="六、问题解决方案"><a href="#六、问题解决方案" class="headerlink" title="六、问题解决方案"></a>六、问题解决方案</h2><h3 id="6-1-常见问题速查表"><a href="#6-1-常见问题速查表" class="headerlink" title="6.1 常见问题速查表"></a>6.1 常见问题速查表</h3><table>
<thead>
<tr>
<th>问题现象</th>
<th>解决方案</th>
<th>相关文件</th>
</tr>
</thead>
<tbody><tr>
<td>样式污染</td>
<td>严格样式隔离 + 组件级配置</td>
<td><code>src/styles/global.css</code></td>
</tr>
<tr>
<td>路由跳转失效</td>
<td>动态basePath + 路由守卫增强</td>
<td><code>src/router/index.js</code></td>
</tr>
<tr>
<td>Token不同步</td>
<td>全局状态管理 + 定时刷新</td>
<td><code>src/utils/auth.js</code></td>
</tr>
<tr>
<td>内存泄漏</td>
<td>严格卸载处理 + 内存分析工具</td>
<td><code>src/main.js</code></td>
</tr>
</tbody></table>
<h3 id="6-2-错误监控方案"><a href="#6-2-错误监控方案" class="headerlink" title="6.2 错误监控方案"></a>6.2 错误监控方案</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 全局错误处理</span></span><br><span class="line"><span class="variable language_">window</span>.<span class="title function_">addEventListener</span>(<span class="string">&#x27;error&#x27;</span>, <span class="function">(<span class="params">event</span>) =&gt;</span> &#123;</span><br><span class="line"><span class="title function_">trackError</span>(&#123;</span><br><span class="line"><span class="attr">type</span>: <span class="string">&#x27;RUNTIME_ERROR&#x27;</span>,</span><br><span class="line"><span class="attr">message</span>: event.<span class="property">message</span>,</span><br><span class="line"><span class="attr">stack</span>: event.<span class="property">error</span>.<span class="property">stack</span>,</span><br><span class="line"><span class="attr">timestamp</span>: <span class="title class_">Date</span>.<span class="title function_">now</span>()</span><br><span class="line">&#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Qiankun错误捕获</span></span><br><span class="line"><span class="title function_">start</span>(&#123;</span><br><span class="line"><span class="attr">onError</span>: <span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;微应用加载失败:&#x27;</span>, err);</span><br><span class="line"><span class="title function_">showErrorNotification</span>(&#123;</span><br><span class="line"><span class="attr">title</span>: <span class="string">&#x27;系统加载失败&#x27;</span>,</span><br><span class="line"><span class="attr">content</span>: <span class="string">&#x27;请检查网络连接后重试&#x27;</span></span><br><span class="line">&#125;);</span><br><span class="line">&#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p><a id="七最佳实践"></a></p>
<h2 id="七、最佳实践"><a href="#七、最佳实践" class="headerlink" title="七、最佳实践"></a>七、最佳实践</h2><h3 id="7-1-架构规范"><a href="#7-1-架构规范" class="headerlink" title="7.1 架构规范"></a>7.1 架构规范</h3><pre><code class="highlight mermaid">graph TD
A[主应用] --&gt; B(用户中心)
A --&gt; C(订单系统)
A --&gt; D(监控平台)
B --&gt; E(权限管理)
C --&gt; F(支付模块)
D --&gt; G(日志分析)
F --&gt; H(第三方支付)
G --&gt; I(数据分析)</code></pre>

<h3 id="7-2-性能指标"><a href="#7-2-性能指标" class="headerlink" title="7.2 性能指标"></a>7.2 性能指标</h3><table>
<thead>
<tr>
<th>指标</th>
<th>标准值</th>
<th>监控工具</th>
<th>报警阈值</th>
</tr>
</thead>
<tbody><tr>
<td>加载时间</td>
<td>&lt;1.5s</td>
<td>Lighthouse</td>
<td>&gt;3s</td>
</tr>
<tr>
<td>内存占用</td>
<td>&lt;200MB</td>
<td>Chrome DevTools</td>
<td>&gt;300MB</td>
</tr>
<tr>
<td>FCP</td>
<td>&lt;1.2s</td>
<td>Web Vitals</td>
<td>&gt;2s</td>
</tr>
<tr>
<td>API成功率</td>
<td>&gt;99.9%</td>
<td>Prometheus</td>
<td>&lt;99%</td>
</tr>
</tbody></table>
<h3 id="7-3-未来演进"><a href="#7-3-未来演进" class="headerlink" title="7.3 未来演进"></a>7.3 未来演进</h3><ol>
<li><strong>动态模块加载</strong></li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 动态加载示例</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">loadModule</span> = <span class="keyword">async</span> (<span class="params">moduleName</span>) =&gt; &#123;</span><br><span class="line"><span class="keyword">const</span> &#123; bootstrap, mount, unmount &#125; = <span class="keyword">await</span> <span class="keyword">import</span>(<span class="string">`./modules/<span class="subst">$&#123;moduleName&#125;</span>`</span>);</span><br><span class="line"><span class="keyword">return</span> &#123; bootstrap, mount, unmount &#125;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="title function_">registerMicroApps</span>([</span><br><span class="line">&#123;</span><br><span class="line"><span class="attr">name</span>: <span class="string">&#x27;dynamic-module&#x27;</span>,</span><br><span class="line"><span class="attr">entry</span>: <span class="function">() =&gt;</span> <span class="title function_">loadModule</span>(<span class="string">&#x27;analytics&#x27;</span>),</span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line">]);</span><br></pre></td></tr></table></figure>

<ol start="2">
<li><strong>微前端DevTools</strong></li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 开发工具集成</span></span><br><span class="line"><span class="keyword">if</span> (process.<span class="property">env</span>.<span class="property">NODE_ENV</span> === <span class="string">&#x27;development&#x27;</span>) &#123;</span><br><span class="line"><span class="keyword">import</span>(<span class="string">&#x27;qiankun-devtools&#x27;</span>).<span class="title function_">then</span>(<span class="function">(<span class="params">&#123; init &#125;</span>) =&gt;</span> &#123;</span><br><span class="line"><span class="title function_">init</span>(&#123;</span><br><span class="line"><span class="attr">traceDeps</span>: <span class="literal">true</span>,</span><br><span class="line"><span class="attr">logComm</span>: <span class="literal">true</span>,</span><br><span class="line"><span class="attr">perfMonitor</span>: <span class="literal">true</span></span><br><span class="line">&#125;);</span><br><span class="line">&#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><a id="八子应用间跳转与传值"></a></p>
<h2 id="八、子应用间跳转与传值"><a href="#八、子应用间跳转与传值" class="headerlink" title="八、子应用间跳转与传值"></a>八、子应用间跳转与传值</h2><h3 id="8-1-子应用间跳转方案"><a href="#8-1-子应用间跳转方案" class="headerlink" title="8.1 子应用间跳转方案"></a>8.1 子应用间跳转方案</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 主应用中定义统一跳转服务</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">AppNavigationService</span> &#123;</span><br><span class="line"><span class="title function_">constructor</span>(<span class="params">apps, router</span>) &#123;</span><br><span class="line"><span class="variable language_">this</span>.<span class="property">apps</span> = apps;</span><br><span class="line"><span class="variable language_">this</span>.<span class="property">router</span> = router;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 跳转到指定应用的指定路径</span></span><br><span class="line"><span class="title function_">navigateTo</span>(<span class="params">appName, path, query = &#123;&#125;</span>) &#123;</span><br><span class="line"><span class="keyword">const</span> app = <span class="variable language_">this</span>.<span class="property">apps</span>.<span class="title function_">find</span>(<span class="function"><span class="params">a</span> =&gt;</span> a.<span class="property">name</span> === appName);</span><br><span class="line"><span class="keyword">if</span> (!app) &#123;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">`应用 <span class="subst">$&#123;appName&#125;</span> 不存在`</span>);</span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 构建完整路径</span></span><br><span class="line"><span class="keyword">const</span> queryString = <span class="title class_">Object</span>.<span class="title function_">keys</span>(query).<span class="property">length</span></span><br><span class="line">? <span class="string">`?<span class="subst">$&#123;<span class="keyword">new</span> URLSearchParams(query)&#125;</span>`</span></span><br><span class="line">: <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> fullPath = <span class="string">`<span class="subst">$&#123;app.activeRule&#125;</span><span class="subst">$&#123;path&#125;</span><span class="subst">$&#123;queryString&#125;</span>`</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">this</span>.<span class="property">router</span>.<span class="title function_">push</span>(fullPath);</span><br><span class="line"><span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 实例化导航服务</span></span><br><span class="line"><span class="keyword">const</span> navigationService = <span class="keyword">new</span> <span class="title class_">AppNavigationService</span>(apps, router);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 子应用中注入导航服务</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">mount</span>(<span class="params">props</span>) &#123;</span><br><span class="line">props.<span class="property">navigationService</span> = navigationService;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 子应用中使用</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">jumpToAnotherApp</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">props.<span class="property">navigationService</span>.<span class="title function_">navigateTo</span>(<span class="string">&#x27;another-app&#x27;</span>, <span class="string">&#x27;/dashboard&#x27;</span>, &#123; <span class="attr">id</span>: <span class="number">123</span> &#125;);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h3 id="8-2-子应用间数据传递"><a href="#8-2-子应用间数据传递" class="headerlink" title="8.2 子应用间数据传递"></a>8.2 子应用间数据传递</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 方案一：通过全局状态</span></span><br><span class="line"><span class="comment">// 子应用A中设置数据</span></span><br><span class="line">props.<span class="title function_">setGlobalState</span>(&#123;</span><br><span class="line"><span class="attr">transferData</span>: &#123;</span><br><span class="line"><span class="attr">type</span>: <span class="string">&#x27;ORDER_DATA&#x27;</span>,</span><br><span class="line"><span class="attr">payload</span>: &#123; <span class="attr">orderId</span>: <span class="number">12345</span> &#125;,</span><br><span class="line"><span class="attr">targetApp</span>: <span class="string">&#x27;another-app&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 子应用B中接收数据</span></span><br><span class="line">props.<span class="title function_">onGlobalStateChange</span>(<span class="function">(<span class="params">state</span>) =&gt;</span> &#123;</span><br><span class="line"><span class="keyword">if</span> (state.<span class="property">transferData</span> &amp;&amp; state.<span class="property">transferData</span>.<span class="property">targetApp</span> === <span class="string">&#x27;another-app&#x27;</span>) &#123;</span><br><span class="line"><span class="title function_">handleReceivedData</span>(state.<span class="property">transferData</span>.<span class="property">payload</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;, <span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 方案二：通过URL参数</span></span><br><span class="line"><span class="comment">// 子应用A跳转时携带数据</span></span><br><span class="line">props.<span class="property">navigationService</span>.<span class="title function_">navigateTo</span>(<span class="string">&#x27;another-app&#x27;</span>, <span class="string">&#x27;/detail&#x27;</span>, &#123;</span><br><span class="line"><span class="attr">orderId</span>: <span class="number">12345</span>,</span><br><span class="line"><span class="attr">timestamp</span>: <span class="title class_">Date</span>.<span class="title function_">now</span>()</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 子应用B接收URL参数</span></span><br><span class="line"><span class="keyword">const</span> route = <span class="title function_">useRoute</span>();</span><br><span class="line"><span class="keyword">const</span> orderId = route.<span class="property">query</span>.<span class="property">orderId</span>;</span><br></pre></td></tr></table></figure>

<h3 id="8-3-数据持久化策略"><a href="#8-3-数据持久化策略" class="headerlink" title="8.3 数据持久化策略"></a>8.3 数据持久化策略</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 使用localStorage与sessionStorage</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">saveAppState</span> = (<span class="params">appName, state</span>) =&gt; &#123;</span><br><span class="line"><span class="keyword">const</span> key = <span class="string">`MICRO_APP_<span class="subst">$&#123;appName&#125;</span>_STATE`</span>;</span><br><span class="line"><span class="variable language_">localStorage</span>.<span class="title function_">setItem</span>(key, <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(&#123;</span><br><span class="line"><span class="attr">data</span>: state,</span><br><span class="line"><span class="attr">timestamp</span>: <span class="title class_">Date</span>.<span class="title function_">now</span>()</span><br><span class="line">&#125;));</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">getAppState</span> = (<span class="params">appName</span>) =&gt; &#123;</span><br><span class="line"><span class="keyword">const</span> key = <span class="string">`MICRO_APP_<span class="subst">$&#123;appName&#125;</span>_STATE`</span>;</span><br><span class="line"><span class="keyword">const</span> stateStr = <span class="variable language_">localStorage</span>.<span class="title function_">getItem</span>(key);</span><br><span class="line"><span class="keyword">if</span> (!stateStr) <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line"><span class="keyword">const</span> state = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(stateStr);</span><br><span class="line"><span class="comment">// 检查数据是否过期（30分钟）</span></span><br><span class="line"><span class="keyword">if</span> (<span class="title class_">Date</span>.<span class="title function_">now</span>() - state.<span class="property">timestamp</span> &gt; <span class="number">30</span> * <span class="number">60</span> * <span class="number">1000</span>) &#123;</span><br><span class="line"><span class="variable language_">localStorage</span>.<span class="title function_">removeItem</span>(key);</span><br><span class="line"><span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> state.<span class="property">data</span>;</span><br><span class="line">&#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p><a id="九常见问题解决方案"></a></p>
<h2 id="九、常见问题解决方案"><a href="#九、常见问题解决方案" class="headerlink" title="九、常见问题解决方案"></a>九、常见问题解决方案</h2><h3 id="9-1-子应用加载主应用路由的问题"><a href="#9-1-子应用加载主应用路由的问题" class="headerlink" title="9.1 子应用加载主应用路由的问题"></a>9.1 子应用加载主应用路由的问题</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 问题：子应用错误加载了主应用的路由组件</span></span><br><span class="line"><span class="comment">// 原因：路由前缀配置不正确，导致路径匹配混乱</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 解决方案一：严格的路由守卫</span></span><br><span class="line">router.<span class="title function_">beforeEach</span>(<span class="function">(<span class="params">to, <span class="keyword">from</span>, next</span>) =&gt;</span> &#123;</span><br><span class="line"><span class="comment">// 检测是否在qiankun环境中</span></span><br><span class="line"><span class="keyword">if</span> (<span class="variable language_">window</span>.<span class="property">__POWERED_BY_QIANKUN__</span>) &#123;</span><br><span class="line"><span class="comment">// 检测当前路径是否合法</span></span><br><span class="line"><span class="keyword">const</span> appPrefix = <span class="string">&#x27;/sub-app&#x27;</span>; <span class="comment">// 子应用路径前缀</span></span><br><span class="line"><span class="keyword">if</span> (!to.<span class="property">path</span>.<span class="title function_">startsWith</span>(appPrefix)) &#123;</span><br><span class="line"><span class="comment">// 路径不合法，重定向到子应用首页</span></span><br><span class="line"><span class="title function_">next</span>(<span class="string">`<span class="subst">$&#123;appPrefix&#125;</span>/home`</span>);</span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">next</span>();</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 解决方案二：修正路由base配置</span></span><br><span class="line"><span class="keyword">const</span> router = <span class="title function_">createRouter</span>(&#123;</span><br><span class="line"><span class="attr">history</span>: <span class="title function_">createWebHistory</span>(</span><br><span class="line"><span class="variable language_">window</span>.<span class="property">__POWERED_BY_QIANKUN__</span></span><br><span class="line">? <span class="variable language_">window</span>.<span class="property">__INJECTED_PUBLIC_PATH_BY_QIANKUN__</span> <span class="comment">// 使用qiankun注入的路径</span></span><br><span class="line">: <span class="string">&#x27;/&#x27;</span></span><br><span class="line">),</span><br><span class="line"><span class="attr">routes</span>: [...]</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="9-2-Token时间不统一问题"><a href="#9-2-Token时间不统一问题" class="headerlink" title="9.2 Token时间不统一问题"></a>9.2 Token时间不统一问题</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 问题：多个子应用的token过期时间不一致</span></span><br><span class="line"><span class="comment">// 解决方案：主应用维护统一的token刷新机制</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 主应用中定义token管理服务</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">TokenService</span> &#123;</span><br><span class="line"><span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line"><span class="variable language_">this</span>.<span class="property">tokenInfo</span> = &#123;</span><br><span class="line"><span class="attr">value</span>: <span class="variable language_">localStorage</span>.<span class="title function_">getItem</span>(<span class="string">&#x27;token&#x27;</span>),</span><br><span class="line"><span class="attr">expire</span>: <span class="built_in">parseInt</span>(<span class="variable language_">localStorage</span>.<span class="title function_">getItem</span>(<span class="string">&#x27;token_expire&#x27;</span>) || <span class="string">&#x27;0&#x27;</span>)</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 定时检查token是否即将过期</span></span><br><span class="line"><span class="built_in">setInterval</span>(<span class="function">() =&gt;</span> <span class="variable language_">this</span>.<span class="title function_">checkTokenExpiration</span>(), <span class="number">60000</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 检查token是否过期</span></span><br><span class="line"><span class="title function_">checkTokenExpiration</span>(<span class="params"></span>) &#123;</span><br><span class="line"><span class="keyword">const</span> now = <span class="title class_">Date</span>.<span class="title function_">now</span>();</span><br><span class="line"><span class="keyword">const</span> timeToExpire = <span class="variable language_">this</span>.<span class="property">tokenInfo</span>.<span class="property">expire</span> - now;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 如果token将在15分钟内过期，刷新token</span></span><br><span class="line"><span class="keyword">if</span> (timeToExpire &gt; <span class="number">0</span> &amp;&amp; timeToExpire &lt; <span class="number">15</span> * <span class="number">60</span> * <span class="number">1000</span>) &#123;</span><br><span class="line"><span class="variable language_">this</span>.<span class="title function_">refreshToken</span>();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 刷新token</span></span><br><span class="line"><span class="keyword">async</span> <span class="title function_">refreshToken</span>(<span class="params"></span>) &#123;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line"><span class="keyword">const</span> response = <span class="keyword">await</span> <span class="title function_">fetch</span>(<span class="string">&#x27;/api/refresh-token&#x27;</span>, &#123;</span><br><span class="line"><span class="attr">method</span>: <span class="string">&#x27;POST&#x27;</span>,</span><br><span class="line"><span class="attr">headers</span>: &#123;</span><br><span class="line"><span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;application/json&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;Authorization&#x27;</span>: <span class="string">`Bearer <span class="subst">$&#123;<span class="variable language_">this</span>.tokenInfo.value&#125;</span>`</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> data = <span class="keyword">await</span> response.<span class="title function_">json</span>();</span><br><span class="line"><span class="keyword">if</span> (data.<span class="property">success</span>) &#123;</span><br><span class="line"><span class="variable language_">this</span>.<span class="title function_">updateToken</span>(data.<span class="property">token</span>, data.<span class="property">expire</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;刷新token失败:&#x27;</span>, error);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 更新token</span></span><br><span class="line"><span class="title function_">updateToken</span>(<span class="params">token, expire</span>) &#123;</span><br><span class="line"><span class="variable language_">this</span>.<span class="property">tokenInfo</span> = &#123; <span class="attr">value</span>: token, expire &#125;;</span><br><span class="line"><span class="variable language_">localStorage</span>.<span class="title function_">setItem</span>(<span class="string">&#x27;token&#x27;</span>, token);</span><br><span class="line"><span class="variable language_">localStorage</span>.<span class="title function_">setItem</span>(<span class="string">&#x27;token_expire&#x27;</span>, expire.<span class="title function_">toString</span>());</span><br><span class="line"></span><br><span class="line"><span class="comment">// 通知所有应用token已更新</span></span><br><span class="line">actions.<span class="title function_">setGlobalState</span>(&#123;</span><br><span class="line"><span class="attr">tokenUpdated</span>: &#123;</span><br><span class="line"><span class="attr">value</span>: token,</span><br><span class="line"><span class="attr">expire</span>: expire,</span><br><span class="line"><span class="attr">timestamp</span>: <span class="title class_">Date</span>.<span class="title function_">now</span>()</span><br><span class="line">&#125;</span><br><span class="line">&#125;);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 初始化token服务</span></span><br><span class="line"><span class="keyword">const</span> tokenService = <span class="keyword">new</span> <span class="title class_">TokenService</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 子应用中监听token更新</span></span><br><span class="line">props.<span class="title function_">onGlobalStateChange</span>(<span class="function">(<span class="params">state</span>) =&gt;</span> &#123;</span><br><span class="line"><span class="keyword">if</span> (state.<span class="property">tokenUpdated</span> &amp;&amp; state.<span class="property">tokenUpdated</span>.<span class="property">timestamp</span>) &#123;</span><br><span class="line"><span class="variable language_">localStorage</span>.<span class="title function_">setItem</span>(<span class="string">&#x27;token&#x27;</span>, state.<span class="property">tokenUpdated</span>.<span class="property">value</span>);</span><br><span class="line"><span class="variable language_">localStorage</span>.<span class="title function_">setItem</span>(<span class="string">&#x27;token_expire&#x27;</span>, state.<span class="property">tokenUpdated</span>.<span class="property">expire</span>.<span class="title function_">toString</span>());</span><br><span class="line">&#125;</span><br><span class="line">&#125;, <span class="literal">true</span>);</span><br></pre></td></tr></table></figure>

<p><a id="十总结与展望"></a></p>
<h2 id="十、总结与展望"><a href="#十、总结与展望" class="headerlink" title="十、总结与展望"></a>十、总结与展望</h2><h3 id="10-1-Qiankun技术优势"><a href="#10-1-Qiankun技术优势" class="headerlink" title="10.1 Qiankun技术优势"></a>10.1 Qiankun技术优势</h3><ol>
<li><strong>技术栈无关</strong> - 支持不同前端框架混合使用</li>
<li><strong>独立开发部署</strong> - 子应用可独立维护迭代</li>
<li><strong>沙箱隔离</strong> - 确保应用间不会互相干扰</li>
<li><strong>资源预加载</strong> - 提升多应用加载性能</li>
</ol>
<h3 id="10-2-架构最佳实践"><a href="#10-2-架构最佳实践" class="headerlink" title="10.2 架构最佳实践"></a>10.2 架构最佳实践</h3><ol>
<li><strong>标准化路由配置</strong> - 统一应用间路由规则</li>
<li><strong>统一认证授权</strong> - 一处登录，处处生效</li>
<li><strong>性能优先策略</strong> - 按需加载、预加载结合</li>
<li><strong>完善的监控体系</strong> - 及时发现并解决问题</li>
</ol>
<h3 id="10-3-未来发展方向"><a href="#10-3-未来发展方向" class="headerlink" title="10.3 未来发展方向"></a>10.3 未来发展方向</h3><ol>
<li><strong>微模块化</strong> - 进一步细化应用颗粒度</li>
<li><strong>AI辅助加载</strong> - 基于用户行为智能预测需要加载的应用</li>
<li><strong>更强大的隔离</strong> - 隔离更彻底的同时保持更高效的性能</li>
</ol>
<p><a id="十一子应用优化策略"></a></p>
<h2 id="十一、子应用优化策略（增强版）"><a href="#十一、子应用优化策略（增强版）" class="headerlink" title="十一、子应用优化策略（增强版）"></a>十一、子应用优化策略（增强版）</h2><h3 id="11-1-智能预加载策略"><a href="#11-1-智能预加载策略" class="headerlink" title="11.1 智能预加载策略"></a>11.1 智能预加载策略</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 主应用智能预加载控制器</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">PreloadController</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">usageStats</span> = <span class="keyword">new</span> <span class="title class_">Map</span>();</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">observer</span> = <span class="keyword">new</span> <span class="title class_">IntersectionObserver</span>(<span class="variable language_">this</span>.<span class="property">handleIntersection</span>.<span class="title function_">bind</span>(<span class="variable language_">this</span>));</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 记录应用使用频率</span></span><br><span class="line">  <span class="title function_">trackAppUsage</span>(<span class="params">appName</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> count = <span class="variable language_">this</span>.<span class="property">usageStats</span>.<span class="title function_">get</span>(appName) || <span class="number">0</span>;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">usageStats</span>.<span class="title function_">set</span>(appName, count + <span class="number">1</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 基于可视区域预加载</span></span><br><span class="line">  <span class="title function_">handleIntersection</span>(<span class="params">entries</span>) &#123;</span><br><span class="line">    entries.<span class="title function_">forEach</span>(<span class="function"><span class="params">entry</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (entry.<span class="property">isIntersecting</span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> appName = entry.<span class="property">target</span>.<span class="property">dataset</span>.<span class="property">appName</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">preloadApp</span>(appName);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 智能预加载算法</span></span><br><span class="line">  <span class="keyword">async</span> <span class="title function_">preloadApp</span>(<span class="params">appName</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> appConfig = qiankunApps.<span class="title function_">find</span>(<span class="function"><span class="params">app</span> =&gt;</span> app.<span class="property">name</span> === appName);</span><br><span class="line">    <span class="keyword">if</span> (!appConfig || appConfig.<span class="property">preloaded</span>) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 根据使用频率决定预加载优先级</span></span><br><span class="line">    <span class="keyword">const</span> priority = <span class="variable language_">this</span>.<span class="property">usageStats</span>.<span class="title function_">get</span>(appName) &gt; <span class="number">5</span> ? <span class="string">&#x27;high&#x27;</span> : <span class="string">&#x27;low&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 使用 requestIdleCallback 优化性能</span></span><br><span class="line">    <span class="keyword">if</span> (priority === <span class="string">&#x27;high&#x27;</span>) &#123;</span><br><span class="line">      <span class="keyword">await</span> <span class="title function_">loadMicroApp</span>(appConfig);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="title function_">requestIdleCallback</span>(<span class="function">() =&gt;</span> <span class="title function_">loadMicroApp</span>(appConfig));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    appConfig.<span class="property">preloaded</span> = <span class="literal">true</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 注册可观察元素</span></span><br><span class="line">  <span class="title function_">registerTrigger</span>(<span class="params">element</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">observer</span>.<span class="title function_">observe</span>(element);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用示例</span></span><br><span class="line"><span class="keyword">const</span> preloader = <span class="keyword">new</span> <span class="title class_">PreloadController</span>();</span><br><span class="line"><span class="variable language_">document</span>.<span class="title function_">querySelectorAll</span>(<span class="string">&#x27;[data-app-trigger]&#x27;</span>).<span class="title function_">forEach</span>(<span class="function"><span class="params">el</span> =&gt;</span> &#123;</span><br><span class="line">  preloader.<span class="title function_">registerTrigger</span>(el);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="11-2-高级加载状态管理（支持SLA监控）"><a href="#11-2-高级加载状态管理（支持SLA监控）" class="headerlink" title="11.2 高级加载状态管理（支持SLA监控）"></a>11.2 高级加载状态管理（支持SLA监控）</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 增强版加载状态管理器</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">AdvancedLoadingManager</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">states</span> = <span class="keyword">new</span> <span class="title class_">Map</span>();</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">slaThresholds</span> = &#123;</span><br><span class="line">      <span class="attr">loadTime</span>: <span class="number">3000</span>,  <span class="comment">// 3秒加载阈值</span></span><br><span class="line">      <span class="attr">successRate</span>: <span class="number">0.95</span> <span class="comment">// 95%成功率</span></span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 记录加载指标</span></span><br><span class="line">  <span class="title function_">recordMetric</span>(<span class="params">appName, metric</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> appState = <span class="variable language_">this</span>.<span class="property">states</span>.<span class="title function_">get</span>(appName) || &#123;</span><br><span class="line">      <span class="attr">loadCount</span>: <span class="number">0</span>,</span><br><span class="line">      <span class="attr">successCount</span>: <span class="number">0</span>,</span><br><span class="line">      <span class="attr">totalLoadTime</span>: <span class="number">0</span>,</span><br><span class="line">      <span class="attr">errors</span>: []</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    appState.<span class="property">loadCount</span>++;</span><br><span class="line">    appState.<span class="property">totalLoadTime</span> += metric.<span class="property">duration</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (metric.<span class="property">success</span>) &#123;</span><br><span class="line">      appState.<span class="property">successCount</span>++;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      appState.<span class="property">errors</span>.<span class="title function_">push</span>(&#123;</span><br><span class="line">        <span class="attr">timestamp</span>: <span class="title class_">Date</span>.<span class="title function_">now</span>(),</span><br><span class="line">        <span class="attr">error</span>: metric.<span class="property">error</span></span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">states</span>.<span class="title function_">set</span>(appName, appState);</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">checkSLA</span>(appName);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 检查SLA合规性</span></span><br><span class="line">  <span class="title function_">checkSLA</span>(<span class="params">appName</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> state = <span class="variable language_">this</span>.<span class="property">states</span>.<span class="title function_">get</span>(appName);</span><br><span class="line">    <span class="keyword">const</span> avgLoadTime = state.<span class="property">totalLoadTime</span> / state.<span class="property">loadCount</span>;</span><br><span class="line">    <span class="keyword">const</span> successRate = state.<span class="property">successCount</span> / state.<span class="property">loadCount</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (avgLoadTime &gt; <span class="variable language_">this</span>.<span class="property">slaThresholds</span>.<span class="property">loadTime</span>) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">warn</span>(<span class="string">`[SLA告警] <span class="subst">$&#123;appName&#125;</span> 平均加载时间 <span class="subst">$&#123;avgLoadTime&#125;</span>ms`</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (successRate &lt; <span class="variable language_">this</span>.<span class="property">slaThresholds</span>.<span class="property">successRate</span>) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">`[SLA违规] <span class="subst">$&#123;appName&#125;</span> 成功率 <span class="subst">$&#123;successRate * <span class="number">100</span>&#125;</span>%`</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 生成性能报告</span></span><br><span class="line">  <span class="title function_">generateReport</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">Array</span>.<span class="title function_">from</span>(<span class="variable language_">this</span>.<span class="property">states</span>.<span class="title function_">entries</span>()).<span class="title function_">map</span>(<span class="function">(<span class="params">[name, state]</span>) =&gt;</span> (&#123;</span><br><span class="line">      <span class="attr">app</span>: name,</span><br><span class="line">      <span class="attr">avgLoadTime</span>: state.<span class="property">totalLoadTime</span> / state.<span class="property">loadCount</span>,</span><br><span class="line">      <span class="attr">successRate</span>: state.<span class="property">successCount</span> / state.<span class="property">loadCount</span>,</span><br><span class="line">      <span class="attr">errorCount</span>: state.<span class="property">errors</span>.<span class="property">length</span></span><br><span class="line">    &#125;));</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 集成到微应用配置</span></span><br><span class="line"><span class="keyword">const</span> loadingManager = <span class="keyword">new</span> <span class="title class_">AdvancedLoadingManager</span>();</span><br><span class="line"></span><br><span class="line"><span class="title function_">registerMicroApps</span>(apps.<span class="title function_">map</span>(<span class="function"><span class="params">app</span> =&gt;</span> (&#123;</span><br><span class="line">  ...app,</span><br><span class="line">  <span class="title function_">loader</span>(<span class="params">loading</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> startTime = <span class="title class_">Date</span>.<span class="title function_">now</span>();</span><br><span class="line">    <span class="keyword">let</span> metric = &#123; <span class="attr">duration</span>: <span class="number">0</span>, <span class="attr">success</span>: <span class="literal">false</span> &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!loading) &#123;</span><br><span class="line">      metric.<span class="property">duration</span> = <span class="title class_">Date</span>.<span class="title function_">now</span>() - startTime;</span><br><span class="line">      metric.<span class="property">success</span> = <span class="literal">true</span>;</span><br><span class="line">      loadingManager.<span class="title function_">recordMetric</span>(app.<span class="property">name</span>, metric);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> <span class="title function_">errorHandler</span> = (<span class="params">err</span>) =&gt; &#123;</span><br><span class="line">        metric.<span class="property">duration</span> = <span class="title class_">Date</span>.<span class="title function_">now</span>() - startTime;</span><br><span class="line">        metric.<span class="property">error</span> = err;</span><br><span class="line">        loadingManager.<span class="title function_">recordMetric</span>(app.<span class="property">name</span>, metric);</span><br><span class="line">      &#125;;</span><br><span class="line">      <span class="variable language_">window</span>.<span class="title function_">addEventListener</span>(<span class="string">&#x27;error&#x27;</span>, errorHandler);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)));</span><br></pre></td></tr></table></figure>

<h3 id="11-3-动态资源调配（根据网络状况）"><a href="#11-3-动态资源调配（根据网络状况）" class="headerlink" title="11.3 动态资源调配（根据网络状况）"></a>11.3 动态资源调配（根据网络状况）</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 网络感知型资源加载</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">NetworkAwareLoader</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">connection</span> = navigator.<span class="property">connection</span> || &#123;</span><br><span class="line">      <span class="attr">effectiveType</span>: <span class="string">&#x27;4g&#x27;</span>,</span><br><span class="line">      <span class="attr">saveData</span>: <span class="literal">false</span></span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">presets</span> = &#123;</span><br><span class="line">      <span class="string">&#x27;4g&#x27;</span>: &#123; <span class="attr">prefetch</span>: <span class="string">&#x27;all&#x27;</span>, <span class="attr">sandbox</span>: <span class="literal">true</span> &#125;,</span><br><span class="line">      <span class="string">&#x27;3g&#x27;</span>: &#123; <span class="attr">prefetch</span>: <span class="string">&#x27;current&#x27;</span>, <span class="attr">sandbox</span>: <span class="literal">false</span> &#125;,</span><br><span class="line">      <span class="string">&#x27;2g&#x27;</span>: &#123; <span class="attr">prefetch</span>: <span class="string">&#x27;none&#x27;</span>, <span class="attr">sandbox</span>: <span class="literal">false</span> &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 初始化加载策略</span></span><br><span class="line">  <span class="title function_">init</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">updateStrategy</span>();</span><br><span class="line">    navigator.<span class="property">connection</span>?.<span class="title function_">addEventListener</span>(<span class="string">&#x27;change&#x27;</span>, <span class="variable language_">this</span>.<span class="property">updateStrategy</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 更新加载策略</span></span><br><span class="line">  updateStrategy = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; effectiveType, saveData &#125; = <span class="variable language_">this</span>.<span class="property">connection</span>;</span><br><span class="line">    <span class="keyword">const</span> strategy = saveData ? <span class="variable language_">this</span>.<span class="property">presets</span>[<span class="string">&#x27;2g&#x27;</span>] : <span class="variable language_">this</span>.<span class="property">presets</span>[effectiveType];</span><br><span class="line"></span><br><span class="line">    <span class="title function_">start</span>(&#123;</span><br><span class="line">      <span class="attr">prefetch</span>: strategy.<span class="property">prefetch</span>,</span><br><span class="line">      <span class="attr">sandbox</span>: &#123;</span><br><span class="line">        <span class="attr">strictStyleIsolation</span>: strategy.<span class="property">sandbox</span>,</span><br><span class="line">        <span class="attr">experimentalStyleIsolation</span>: strategy.<span class="property">sandbox</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 动态调整资源质量</span></span><br><span class="line">  <span class="title function_">adjustResourceQuality</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> imgQuality = <span class="variable language_">this</span>.<span class="property">connection</span>.<span class="property">saveData</span> ? <span class="string">&#x27;low&#x27;</span> : <span class="string">&#x27;high&#x27;</span>;</span><br><span class="line">    <span class="variable language_">document</span>.<span class="property">documentElement</span>.<span class="property">style</span>.<span class="title function_">setProperty</span>(</span><br><span class="line">      <span class="string">&#x27;--image-quality&#x27;</span>,</span><br><span class="line">      <span class="string">`url(?quality=<span class="subst">$&#123;imgQuality&#125;</span>)`</span></span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用示例</span></span><br><span class="line"><span class="keyword">const</span> networkLoader = <span class="keyword">new</span> <span class="title class_">NetworkAwareLoader</span>();</span><br><span class="line">networkLoader.<span class="title function_">init</span>();</span><br></pre></td></tr></table></figure>

<h3 id="11-4-安全增强策略"><a href="#11-4-安全增强策略" class="headerlink" title="11.4 安全增强策略"></a>11.4 安全增强策略</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 子应用安全沙箱增强</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">createSecureSandbox</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> proxy = <span class="keyword">new</span> <span class="title class_">Proxy</span>(<span class="variable language_">window</span>, &#123;</span><br><span class="line">    <span class="title function_">get</span>(<span class="params">target, prop</span>) &#123;</span><br><span class="line">      <span class="comment">// 拦截危险API</span></span><br><span class="line">      <span class="keyword">if</span> ([<span class="string">&#x27;localStorage&#x27;</span>, <span class="string">&#x27;eval&#x27;</span>, <span class="string">&#x27;Function&#x27;</span>].<span class="title function_">includes</span>(prop)) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">warn</span>(<span class="string">`禁止访问 <span class="subst">$&#123;prop&#125;</span>`</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">undefined</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> target[prop];</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="title function_">set</span>(<span class="params">target, prop, value</span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (prop === <span class="string">&#x27;document&#x27;</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;禁止修改document对象&#x27;</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      target[prop] = value;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    <span class="keyword">async</span> <span class="title function_">bootstrap</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;安全沙箱启动&#x27;</span>);</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="keyword">async</span> <span class="title function_">mount</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="variable language_">window</span>.<span class="property">__SANDBOX_PROXY__</span> = proxy;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="keyword">async</span> <span class="title function_">unmount</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="keyword">delete</span> <span class="variable language_">window</span>.<span class="property">__SANDBOX_PROXY__</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 集成到启动配置</span></span><br><span class="line"><span class="title function_">start</span>(&#123;</span><br><span class="line">  <span class="attr">sandbox</span>: <span class="title function_">createSecureSandbox</span>()</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="11-5-性能追踪与可视化"><a href="#11-5-性能追踪与可视化" class="headerlink" title="11.5 性能追踪与可视化"></a>11.5 性能追踪与可视化</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 性能追踪装饰器</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">tracePerformance</span>(<span class="params">target, name, descriptor</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> original = descriptor.<span class="property">value</span>;</span><br><span class="line"></span><br><span class="line">  descriptor.<span class="property">value</span> = <span class="keyword">async</span> <span class="keyword">function</span>(<span class="params">...args</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> start = performance.<span class="title function_">now</span>();</span><br><span class="line">    <span class="keyword">const</span> result = <span class="keyword">await</span> original.<span class="title function_">apply</span>(<span class="variable language_">this</span>, args);</span><br><span class="line">    <span class="keyword">const</span> duration = performance.<span class="title function_">now</span>() - start;</span><br><span class="line"></span><br><span class="line">    performanceTrack.<span class="title function_">addEntry</span>(&#123;</span><br><span class="line">      name,</span><br><span class="line">      duration,</span><br><span class="line">      <span class="attr">timestamp</span>: <span class="title class_">Date</span>.<span class="title function_">now</span>(),</span><br><span class="line">      <span class="attr">args</span>: args.<span class="property">length</span> &gt; <span class="number">0</span> ? args : <span class="literal">undefined</span></span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> descriptor;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 在关键生命周期使用</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">AppController</span> &#123;</span><br><span class="line">  @tracePerformance</span><br><span class="line">  <span class="keyword">async</span> <span class="title function_">loadApp</span>(<span class="params">config</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">loadMicroApp</span>(config);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  @tracePerformance</span><br><span class="line">  <span class="keyword">async</span> <span class="title function_">unloadApp</span>(<span class="params">name</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> app = <span class="variable language_">this</span>.<span class="property">apps</span>.<span class="title function_">get</span>(name);</span><br><span class="line">    <span class="keyword">return</span> app.<span class="title function_">unmount</span>();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 性能数据可视化</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">renderPerformanceDashboard</span> = (<span class="params">data</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> metrics = &#123;</span><br><span class="line">    <span class="attr">loadTime</span>: data.<span class="title function_">filter</span>(<span class="function"><span class="params">d</span> =&gt;</span> d.<span class="property">name</span> === <span class="string">&#x27;loadApp&#x27;</span>),</span><br><span class="line">    <span class="attr">unloadTime</span>: data.<span class="title function_">filter</span>(<span class="function"><span class="params">d</span> =&gt;</span> d.<span class="property">name</span> === <span class="string">&#x27;unloadApp&#x27;</span>)</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 使用图表库渲染可视化视图</span></span><br><span class="line">  <span class="keyword">new</span> <span class="title class_">Chart</span>(<span class="string">&#x27;#load-times&#x27;</span>, &#123;</span><br><span class="line">    <span class="attr">type</span>: <span class="string">&#x27;line&#x27;</span>,</span><br><span class="line">    <span class="attr">data</span>: &#123;</span><br><span class="line">      <span class="attr">labels</span>: metrics.<span class="property">loadTime</span>.<span class="title function_">map</span>(<span class="function"><span class="params">d</span> =&gt;</span> <span class="keyword">new</span> <span class="title class_">Date</span>(d.<span class="property">timestamp</span>).<span class="title function_">toLocaleTimeString</span>()),</span><br><span class="line">      <span class="attr">datasets</span>: [&#123;</span><br><span class="line">        <span class="attr">label</span>: <span class="string">&#x27;应用加载时间 (ms)&#x27;</span>,</span><br><span class="line">        <span class="attr">data</span>: metrics.<span class="property">loadTime</span>.<span class="title function_">map</span>(<span class="function"><span class="params">d</span> =&gt;</span> d.<span class="property">duration</span>),</span><br><span class="line">        <span class="attr">borderColor</span>: <span class="string">&#x27;#4CAF50&#x27;</span></span><br><span class="line">      &#125;]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<hr>
<blockquote>
<p>本次优化重点增强以下方面：</p>
<ol>
<li><strong>智能预加载</strong> - 基于用户行为和可视区域预测加载</li>
<li><strong>SLA监控</strong> - 实时跟踪性能指标并预警</li>
<li><strong>网络适配</strong> - 根据网络状况动态调整策略</li>
<li><strong>安全增强</strong> - 严格限制敏感API访问</li>
<li><strong>性能可视化</strong> - 提供直观的性能分析视图</li>
</ol>
</blockquote>
<p>[🔗 性能监控示例] | [📊 可视化模板] | [🛡️ 安全审计指南]</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="https://aoayaoa.github.io">aoaYaoa</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="https://aoayaoa.github.io/2024/04/08/qiankun/">https://aoayaoa.github.io/2024/04/08/qiankun/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="external nofollow noreferrer" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来源 <a href="https://aoayaoa.github.io" target="_blank">aoaYaoa</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E5%85%A5%E9%97%A8/">入门</a><a class="post-meta__tags" href="/tags/Hexo/">Hexo</a></div><div class="post-share"><div class="social-share" data-image="/img/qiankun.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/2024/02/01/vite/" title="vite"><img class="cover" src="https://tiven.cn/static/img/vite-03-xbVS9jZm.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="info"><div class="info-1"><div class="info-item-1">上一篇</div><div class="info-item-2">vite</div></div><div class="info-2"><div class="info-item-1">Vite 完全指南：从入门到精通目录第一部分：基础入门 认识 Vite  1.1 什么是 Vite 1.2 核心优势 1.3 基本原理 1.4 应用场景   快速开始  2.1 环境准备 2.2 创建项目 2.3 项目结构 2.4 基本命令 2.5 开发调试    第二部分：核心概念 构建基础  3.1 开发服务器 3.2 构建过程 3.3 依赖预构建 3.4 HMR 机制   资源处理  4.1 静态资源 4.2 样式处理 4.3 JavaScript&#x2F;TypeScript 4.4 JSON 和 Web Workers 4.5...</div></div></div></a><a class="pagination-related" href="/2024/07/07/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/" title="性能优化"><img class="cover" src="/img/youhua.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="info text-right"><div class="info-1"><div class="info-item-1">下一篇</div><div class="info-item-2">性能优化</div></div><div class="info-2"><div class="info-item-1">Web 性能优化完全指南目录 1. 加载性能优化 2. 渲染性能优化 3. 资源优化 4. 网络层优化 5. 缓存策略 6. 框架级优化 7. 移动端专项优化 8. 性能监控与分析 9. 进阶优化策略 10. 工具链推荐   1. 加载性能优化1.1 关键渲染路径优化1.1.1 CSS优化1234567891011121314// 1. 内联关键CSS&lt;style&gt;  /* 首屏关键样式 */  .header &#123; ... &#125;  .hero-section &#123; ... &#125;&lt;/style&gt;// 2....</div></div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/2024/12/13/Promise/" title="深入理解Promise"><img class="cover" src="/img/promise.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2024-12-13</div><div class="info-item-2">深入理解Promise</div></div><div class="info-2"><div class="info-item-1">深入理解 JavaScript Promise：从入门到精通前言Promise 是 JavaScript 中处理异步操作的核心机制，它的出现让我们告别了回调地狱，使异步代码更加清晰和易于维护。本文将深入探讨 Promise 的方方面面，从基础概念到高级应用，帮助你全面掌握这一重要特性。 目录 1. Promise 基础 2. Promise 状态 3. Promise 方法 4. 错误处理 5. Promise 链式调用 6. Promise 静态方法 7. async&#x2F;await 8. 实际应用场景 9. 最佳实践 10. 常见问题和陷阱 11. 更多实际应用场景 12....</div></div></div></a><a class="pagination-related" href="/2024/02/01/vite/" title="vite"><img class="cover" src="https://tiven.cn/static/img/vite-03-xbVS9jZm.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2024-02-01</div><div class="info-item-2">vite</div></div><div class="info-2"><div class="info-item-1">Vite 完全指南：从入门到精通目录第一部分：基础入门 认识 Vite  1.1 什么是 Vite 1.2 核心优势 1.3 基本原理 1.4 应用场景   快速开始  2.1 环境准备 2.2 创建项目 2.3 项目结构 2.4 基本命令 2.5 开发调试    第二部分：核心概念 构建基础  3.1 开发服务器 3.2 构建过程 3.3 依赖预构建 3.4 HMR 机制   资源处理  4.1 静态资源 4.2 样式处理 4.3 JavaScript&#x2F;TypeScript 4.4 JSON 和 Web Workers 4.5...</div></div></div></a><a class="pagination-related" href="/2023/05/26/webpack/" title="webpack"><img class="cover" src="https://img0.baidu.com/it/u=3179744413,569264497&fm=253&fmt=auto&app=138&f=PNG?w=1285&h=500" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2023-05-26</div><div class="info-item-2">webpack</div></div><div class="info-2"><div class="info-item-1">Webpack 完全指南：从入门到精通目录 1. 基础概念 2. 核心功能 3. 打包原理 4. 配置详解 5. Loader 体系 6. Plugin 体系 7. 性能优化 8. 实战应用 9. 高级特性 10. 最佳实践  1. 基础概念1.1 什么是 Webpack？ Webpack 是一个现代 JavaScript 应用程序的静态模块打包工具。它将项目中的所有资源视为模块，通过依赖关系图构建应用。 1.2 核心概念1.2.1 入口(Entry)123456789101112// 单入口module.exports = &#123;  entry:...</div></div></div></a></div></div><hr class="custom-hr"/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div id="twikoo-wrap"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="/img/avatar.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">aoaYaoa</div><div class="author-info-description">个人博客，记录成长点滴...</div><div class="site-data"><a href="/archives/"><div class="headline">文章</div><div class="length-num">10</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">10</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">1</div></a></div><a id="card-info-btn" target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/aoaYaoa"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons"><a class="social-icon" href="https://github.com/aoaYaoa" rel="external nofollow noreferrer" target="_blank" title="GitHub"><i class="fab fa-github" style="color: #181717;"></i></a><a class="social-icon" href="https://twitter.com/yourname" rel="external nofollow noreferrer" target="_blank" title="Twitter"><i class="fab fa-twitter" style="color: #1DA1F2;"></i></a><a class="social-icon" href="mailto:skyeeq9@gmail.com" rel="external nofollow noreferrer" target="_blank" title="Email"><i class="fas fa-envelope" style="color: #EA4335;"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">算了，不知道写什么，就这样吧！</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Qiankun-%E5%BE%AE%E5%89%8D%E7%AB%AF%E4%BC%81%E4%B8%9A%E7%BA%A7%E5%AE%9E%E8%B7%B5%E6%8C%87%E5%8D%97"><span class="toc-number">1.</span> <span class="toc-text">Qiankun 微前端企业级实践指南</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%9B%AE%E5%BD%95"><span class="toc-number">1.1.</span> <span class="toc-text">目录</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80%E3%80%81%E5%9F%BA%E7%A1%80%E9%85%8D%E7%BD%AE"><span class="toc-number">1.2.</span> <span class="toc-text">一、基础配置</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-1-%E4%B8%BB%E5%BA%94%E7%94%A8%E5%88%9D%E5%A7%8B%E5%8C%96"><span class="toc-number">1.2.1.</span> <span class="toc-text">1.1 主应用初始化</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-%E5%AD%90%E5%BA%94%E7%94%A8%E6%8E%A5%E5%85%A5%E8%A7%84%E8%8C%83"><span class="toc-number">1.2.2.</span> <span class="toc-text">1.2 子应用接入规范</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8C%E3%80%81%E9%80%9A%E4%BF%A1%E6%96%B9%E6%A1%88"><span class="toc-number">1.3.</span> <span class="toc-text">二、通信方案</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-%E5%85%A8%E5%B1%80%E7%8A%B6%E6%80%81%E7%AE%A1%E7%90%86"><span class="toc-number">1.3.1.</span> <span class="toc-text">2.1 全局状态管理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-%E8%B7%A8%E5%BA%94%E7%94%A8%E4%BA%8B%E4%BB%B6%E6%80%BB%E7%BA%BF"><span class="toc-number">1.3.2.</span> <span class="toc-text">2.2 跨应用事件总线</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%89%E3%80%81%E8%B7%AF%E7%94%B1%E7%AE%A1%E7%90%86"><span class="toc-number">1.4.</span> <span class="toc-text">三、路由管理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-%E8%B7%AF%E7%94%B1%E9%85%8D%E7%BD%AE%E8%A7%84%E8%8C%83"><span class="toc-number">1.4.1.</span> <span class="toc-text">3.1 路由配置规范</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9B%9B%E3%80%81%E6%A0%B7%E5%BC%8F%E9%9A%94%E7%A6%BB"><span class="toc-number">1.5.</span> <span class="toc-text">四、样式隔离</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-1-%E7%BB%84%E4%BB%B6%E5%BA%93%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88"><span class="toc-number">1.5.1.</span> <span class="toc-text">4.1 组件库解决方案</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-%E5%85%A8%E5%B1%80%E6%A0%B7%E5%BC%8F%E7%AD%96%E7%95%A5"><span class="toc-number">1.5.2.</span> <span class="toc-text">4.2 全局样式策略</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%94%E3%80%81%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96"><span class="toc-number">1.6.</span> <span class="toc-text">五、性能优化</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#5-1-%E8%B5%84%E6%BA%90%E5%8A%A0%E8%BD%BD%E7%AD%96%E7%95%A5"><span class="toc-number">1.6.1.</span> <span class="toc-text">5.1 资源加载策略</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-2-%E5%86%85%E5%AD%98%E4%BC%98%E5%8C%96%E6%96%B9%E6%A1%88"><span class="toc-number">1.6.2.</span> <span class="toc-text">5.2 内存优化方案</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%AD%E3%80%81%E9%97%AE%E9%A2%98%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88"><span class="toc-number">1.7.</span> <span class="toc-text">六、问题解决方案</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#6-1-%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98%E9%80%9F%E6%9F%A5%E8%A1%A8"><span class="toc-number">1.7.1.</span> <span class="toc-text">6.1 常见问题速查表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-2-%E9%94%99%E8%AF%AF%E7%9B%91%E6%8E%A7%E6%96%B9%E6%A1%88"><span class="toc-number">1.7.2.</span> <span class="toc-text">6.2 错误监控方案</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%83%E3%80%81%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5"><span class="toc-number">1.8.</span> <span class="toc-text">七、最佳实践</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#7-1-%E6%9E%B6%E6%9E%84%E8%A7%84%E8%8C%83"><span class="toc-number">1.8.1.</span> <span class="toc-text">7.1 架构规范</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-2-%E6%80%A7%E8%83%BD%E6%8C%87%E6%A0%87"><span class="toc-number">1.8.2.</span> <span class="toc-text">7.2 性能指标</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-3-%E6%9C%AA%E6%9D%A5%E6%BC%94%E8%BF%9B"><span class="toc-number">1.8.3.</span> <span class="toc-text">7.3 未来演进</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%AB%E3%80%81%E5%AD%90%E5%BA%94%E7%94%A8%E9%97%B4%E8%B7%B3%E8%BD%AC%E4%B8%8E%E4%BC%A0%E5%80%BC"><span class="toc-number">1.9.</span> <span class="toc-text">八、子应用间跳转与传值</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#8-1-%E5%AD%90%E5%BA%94%E7%94%A8%E9%97%B4%E8%B7%B3%E8%BD%AC%E6%96%B9%E6%A1%88"><span class="toc-number">1.9.1.</span> <span class="toc-text">8.1 子应用间跳转方案</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-2-%E5%AD%90%E5%BA%94%E7%94%A8%E9%97%B4%E6%95%B0%E6%8D%AE%E4%BC%A0%E9%80%92"><span class="toc-number">1.9.2.</span> <span class="toc-text">8.2 子应用间数据传递</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-3-%E6%95%B0%E6%8D%AE%E6%8C%81%E4%B9%85%E5%8C%96%E7%AD%96%E7%95%A5"><span class="toc-number">1.9.3.</span> <span class="toc-text">8.3 数据持久化策略</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B9%9D%E3%80%81%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88"><span class="toc-number">1.10.</span> <span class="toc-text">九、常见问题解决方案</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#9-1-%E5%AD%90%E5%BA%94%E7%94%A8%E5%8A%A0%E8%BD%BD%E4%B8%BB%E5%BA%94%E7%94%A8%E8%B7%AF%E7%94%B1%E7%9A%84%E9%97%AE%E9%A2%98"><span class="toc-number">1.10.1.</span> <span class="toc-text">9.1 子应用加载主应用路由的问题</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-2-Token%E6%97%B6%E9%97%B4%E4%B8%8D%E7%BB%9F%E4%B8%80%E9%97%AE%E9%A2%98"><span class="toc-number">1.10.2.</span> <span class="toc-text">9.2 Token时间不统一问题</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8D%81%E3%80%81%E6%80%BB%E7%BB%93%E4%B8%8E%E5%B1%95%E6%9C%9B"><span class="toc-number">1.11.</span> <span class="toc-text">十、总结与展望</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#10-1-Qiankun%E6%8A%80%E6%9C%AF%E4%BC%98%E5%8A%BF"><span class="toc-number">1.11.1.</span> <span class="toc-text">10.1 Qiankun技术优势</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#10-2-%E6%9E%B6%E6%9E%84%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5"><span class="toc-number">1.11.2.</span> <span class="toc-text">10.2 架构最佳实践</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#10-3-%E6%9C%AA%E6%9D%A5%E5%8F%91%E5%B1%95%E6%96%B9%E5%90%91"><span class="toc-number">1.11.3.</span> <span class="toc-text">10.3 未来发展方向</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8D%81%E4%B8%80%E3%80%81%E5%AD%90%E5%BA%94%E7%94%A8%E4%BC%98%E5%8C%96%E7%AD%96%E7%95%A5%EF%BC%88%E5%A2%9E%E5%BC%BA%E7%89%88%EF%BC%89"><span class="toc-number">1.12.</span> <span class="toc-text">十一、子应用优化策略（增强版）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#11-1-%E6%99%BA%E8%83%BD%E9%A2%84%E5%8A%A0%E8%BD%BD%E7%AD%96%E7%95%A5"><span class="toc-number">1.12.1.</span> <span class="toc-text">11.1 智能预加载策略</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#11-2-%E9%AB%98%E7%BA%A7%E5%8A%A0%E8%BD%BD%E7%8A%B6%E6%80%81%E7%AE%A1%E7%90%86%EF%BC%88%E6%94%AF%E6%8C%81SLA%E7%9B%91%E6%8E%A7%EF%BC%89"><span class="toc-number">1.12.2.</span> <span class="toc-text">11.2 高级加载状态管理（支持SLA监控）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#11-3-%E5%8A%A8%E6%80%81%E8%B5%84%E6%BA%90%E8%B0%83%E9%85%8D%EF%BC%88%E6%A0%B9%E6%8D%AE%E7%BD%91%E7%BB%9C%E7%8A%B6%E5%86%B5%EF%BC%89"><span class="toc-number">1.12.3.</span> <span class="toc-text">11.3 动态资源调配（根据网络状况）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#11-4-%E5%AE%89%E5%85%A8%E5%A2%9E%E5%BC%BA%E7%AD%96%E7%95%A5"><span class="toc-number">1.12.4.</span> <span class="toc-text">11.4 安全增强策略</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#11-5-%E6%80%A7%E8%83%BD%E8%BF%BD%E8%B8%AA%E4%B8%8E%E5%8F%AF%E8%A7%86%E5%8C%96"><span class="toc-number">1.12.5.</span> <span class="toc-text">11.5 性能追踪与可视化</span></a></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2025/04/25/Go%E8%AF%AD%E8%A8%80%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/" title="Go语言学习总结"><img src="/img/go.jpeg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Go语言学习总结"/></a><div class="content"><a class="title" href="/2025/04/25/Go%E8%AF%AD%E8%A8%80%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/" title="Go语言学习总结">Go语言学习总结</a><time datetime="2025-04-24T16:00:00.000Z" title="发表于 2025-04-25 00:00:00">2025-04-25</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/04/15/deno%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/" title="Deno学习记录"><img src="/img/deno.jpeg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Deno学习记录"/></a><div class="content"><a class="title" href="/2025/04/15/deno%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/" title="Deno学习记录">Deno学习记录</a><time datetime="2025-04-14T16:00:00.000Z" title="发表于 2025-04-15 00:00:00">2025-04-15</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/03/15/react/" title="react总结"><img src="/img/react19.jpeg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="react总结"/></a><div class="content"><a class="title" href="/2025/03/15/react/" title="react总结">react总结</a><time datetime="2025-03-14T16:00:00.000Z" title="发表于 2025-03-15 00:00:00">2025-03-15</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/01/07/nginx/" title="nginx 学习配置记录"><img src="/img/nginx.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="nginx 学习配置记录"/></a><div class="content"><a class="title" href="/2025/01/07/nginx/" title="nginx 学习配置记录">nginx 学习配置记录</a><time datetime="2025-01-06T16:00:00.000Z" title="发表于 2025-01-07 00:00:00">2025-01-07</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/12/13/Promise/" title="深入理解Promise"><img src="/img/promise.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="深入理解Promise"/></a><div class="content"><a class="title" href="/2024/12/13/Promise/" title="深入理解Promise">深入理解Promise</a><time datetime="2024-12-12T16:00:00.000Z" title="发表于 2024-12-13 00:00:00">2024-12-13</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2019 - 2025 By aoaYaoa</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener external nofollow noreferrer" href="https://hexo.io">Hexo 7.3.0</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly 5.3.4</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="日间和夜间模式切换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="前往评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js"></script><div class="js-pjax"><script>(() => {
  const isShuoshuo = GLOBAL_CONFIG_SITE.pageType === 'shuoshuo'
  const option = null

  const getCount = () => {
    const countELement = document.getElementById('twikoo-count')
    if(!countELement) return
    twikoo.getCommentsCount({
      envId: 'https://twikoogo.netlify.app/.netlify/functions/twikoo',
      region: '',
      urls: [window.location.pathname],
      includeReply: false
    }).then(res => {
      countELement.textContent = res[0].count
    }).catch(err => {
      console.error(err)
    })
  }

  const init = (el = document, path = location.pathname) => {
    twikoo.init({
      el: el.querySelector('#twikoo-wrap'),
      envId: 'https://twikoogo.netlify.app/.netlify/functions/twikoo',
      region: '',
      onCommentLoaded: () => {
        btf.loadLightbox(document.querySelectorAll('#twikoo .tk-content img:not(.tk-owo-emotion)'))
      },
      ...option,
      path: isShuoshuo ? path : (option && option.path) || path
    })

    

    isShuoshuo && (window.shuoshuoComment.destroyTwikoo = () => {
      if (el.children.length) {
        el.innerHTML = ''
        el.classList.add('no-comment')
      }
    })
  }

  const loadTwikoo = (el, path) => {
    if (typeof twikoo === 'object') setTimeout(() => init(el, path), 0)
    else btf.getScript('https://cdn.jsdelivr.net/npm/twikoo/dist/twikoo.all.min.js').then(() => init(el, path))
  }

  if (isShuoshuo) {
    'Twikoo' === 'Twikoo'
      ? window.shuoshuoComment = { loadComment: loadTwikoo }
      : window.loadOtherComment = loadTwikoo
    return
  }

  if ('Twikoo' === 'Twikoo' || !false) {
    if (false) btf.loadComment(document.getElementById('twikoo-wrap'), loadTwikoo)
    else loadTwikoo()
  } else {
    window.loadOtherComment = loadTwikoo
  }
})()</script></div><div class="aplayer no-destroy" data-id="13528716738" data-server="netease" data-type="playlist" data-fixed="true" data-autoplay="true"> </div><canvas class="fireworks" mobile="false"></canvas><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/fireworks.min.js"></script><script id="click-show-text" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/click-show-text.min.js" data-mobile="false" data-text="富强,民主,文明,和谐,自由,平等,公正,法治,爱国,敬业,诚信,友善" data-fontsize="15px" data-random="true" async="async"></script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/metingjs/dist/Meting.min.js"></script><script>(() => {
  const destroyAplayer = () => {
    if (window.aplayers) {
      for (let i = 0; i < window.aplayers.length; i++) {
        if (!window.aplayers[i].options.fixed) {
          window.aplayers[i].destroy()
        }
      }
    }
  }

  const runMetingJS = () => {
    typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()
  }

  btf.addGlobalFn('pjaxSend', destroyAplayer, 'destroyAplayer')
  btf.addGlobalFn('pjaxComplete', loadMeting, 'runMetingJS')
})()</script><script src="https://cdn.jsdelivr.net/npm/pjax/pjax.min.js"></script><script>(() => {
  const pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]

  window.pjax = new Pjax({
    elements: 'a:not([target="_blank"])',
    selectors: pjaxSelectors,
    cacheBust: false,
    analytics: false,
    scrollRestoration: false
  })

  const triggerPjaxFn = (val) => {
    if (!val) return
    Object.values(val).forEach(fn => fn())
  }

  document.addEventListener('pjax:send', () => {
    // removeEventListener
    btf.removeGlobalFnEvent('pjaxSendOnce')
    btf.removeGlobalFnEvent('themeChange')

    // reset readmode
    const $bodyClassList = document.body.classList
    if ($bodyClassList.contains('read-mode')) $bodyClassList.remove('read-mode')

    triggerPjaxFn(window.globalFn.pjaxSend)
  })

  document.addEventListener('pjax:complete', () => {
    btf.removeGlobalFnEvent('pjaxCompleteOnce')
    document.querySelectorAll('script[data-pjax]').forEach(item => {
      const newScript = document.createElement('script')
      const content = item.text || item.textContent || item.innerHTML || ""
      Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
      newScript.appendChild(document.createTextNode(content))
      item.parentNode.replaceChild(newScript, item)
    })

    triggerPjaxFn(window.globalFn.pjaxComplete)
  })

  document.addEventListener('pjax:error', e => {
    if (e.request.status === 404) {
      const usePjax = true
      true 
        ? (usePjax ? pjax.loadUrl('/404.html') : window.location.href = '/404.html')
        : window.location.href = e.request.responseURL
    }
  })
})()</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="text-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章..." type="text"/></div></div><hr/><div id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js"></script></div></div></body></html>